

=======================================================
FILE: .eslintrc.js
=======================================================

// https://docs.expo.dev/guides/using-eslint/
module.exports = {
    extends: 'expo',
    ignorePatterns: ['/dist/*'],
};


=======================================================
FILE: .vscode\extensions.json
=======================================================

{ "recommendations": ["expo.vscode-expo-tools"] }


=======================================================
FILE: .vscode\settings.json
=======================================================

{
  "editor.codeActionsOnSave": {
    "source.fixAll": "explicit",
    "source.organizeImports": "explicit",
    "source.sortMembers": "explicit"
  }
}


=======================================================
FILE: app\(tabs)\explore.tsx
=======================================================

import { useTheme } from '@/context/ThemeContext';
import { BlurView } from 'expo-blur';
import * as Haptics from 'expo-haptics';
import { LinearGradient } from 'expo-linear-gradient';
import { useRouter } from 'expo-router';
import { StatusBar } from 'expo-status-bar';
import React, { useCallback, useEffect, useMemo, useState } from 'react';
import { FlatList, RefreshControl, ScrollView, StyleSheet, Text, TouchableOpacity, View } from 'react-native';
import Animated, { FadeInDown } from 'react-native-reanimated';
import { useSafeAreaInsets } from 'react-native-safe-area-context';
import { ScalePressable } from '../../components/ScalePressable';
import { SkeletonLoader } from '../../components/SkeletonLoader';
import { AttendanceService, DailyAttendance } from '../../services/attendance';
import { AuthService } from '../../services/auth';

export default function DateWiseScreen() {
  const [days, setDays] = useState<DailyAttendance[]>([]);
  const [loading, setLoading] = useState(true);
  const [refreshing, setRefreshing] = useState(false);
  const [selectedMonth, setSelectedMonth] = useState<string>('All');
  const router = useRouter();
  const insets = useSafeAreaInsets();
  const { colors, isDark } = useTheme();

  const fetchData = useCallback(async () => {
    try {
      const isLoggedIn = await AuthService.isLoggedIn();
      if (!isLoggedIn) {
        router.replace('/login');
        return;
      }

      const data = await AttendanceService.getDateWiseAttendance();
      // Sort in descending order (newest first)
      const sortedDays = data.days.sort((a, b) => {
        const [dayA, monthA, yearA] = a.date.split('-').map(Number);
        const [dayB, monthB, yearB] = b.date.split('-').map(Number);
        const dateA = new Date(yearA, monthA - 1, dayA);
        const dateB = new Date(yearB, monthB - 1, dayB);
        return dateB.getTime() - dateA.getTime();
      });
      setDays(sortedDays);
    } catch {
    } finally {
      setLoading(false);
      setRefreshing(false);
    }
  }, [router]);

  useEffect(() => {
    fetchData();
  }, [fetchData]);

  const onRefresh = useCallback(() => {
    setRefreshing(true);
    fetchData();
  }, [fetchData]);

  // Extract unique months from the data
  const months = useMemo(() => {
    const monthSet = new Set<string>();
    days.forEach(day => {
      // Normalize split to handle -, /, ., or spaces
      const parts = day.date.split(/[-./\s]/);
      if (parts.length >= 3) {
        const monthNum = parseInt(parts[1], 10);
        const year = parts[2];
        const monthNames = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
        const monthName = monthNames[monthNum - 1] || 'Unknown';
        monthSet.add(`${monthName} ${year}`);
      }
    });
    return ['All', ...Array.from(monthSet)];
  }, [days]);

  // Filter days by selected month
  const filteredDays = useMemo(() => {
    if (selectedMonth === 'All') return days;

    return days.filter(day => {
      const parts = day.date.split(/[-./\s]/);
      if (parts.length >= 3) {
        const monthNum = parseInt(parts[1], 10);
        const year = parts[2];
        const monthNames = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
        const monthName = monthNames[monthNum - 1] || 'Unknown';
        return selectedMonth === `${monthName} ${year}`;
      }
      return false;
    });
  }, [days, selectedMonth]);

  if (loading) {
    return (
      <View style={[styles.container, { paddingTop: insets.top, backgroundColor: colors.background }]}>
        <LinearGradient
          colors={isDark ? [colors.background, '#1a1a1a'] : [colors.primary + '10', colors.background]}
          start={{ x: 0, y: 0 }}
          end={{ x: 1, y: 1 }}
          style={StyleSheet.absoluteFill}
        />

        <View style={{ padding: 16 }}>
          {/* Header */}
          <View style={styles.header}>
            <SkeletonLoader width={180} height={22} borderRadius={6} />
            <SkeletonLoader width={60} height={14} borderRadius={4} />
          </View>

          {/* Month Filter Chips */}
          <ScrollView horizontal showsHorizontalScrollIndicator={false} style={styles.filterContainer}>
            {[1, 2, 3, 4].map(i => (
              <SkeletonLoader key={i} width={80} height={36} borderRadius={20} style={{ marginRight: 12 }} />
            ))}
          </ScrollView>

          {/* Period Legend Card */}
          <View style={[styles.legendCard, { backgroundColor: colors.card }]}>
            <SkeletonLoader width={60} height={14} borderRadius={4} style={{ marginBottom: 12 }} />
            <View style={styles.legendRow}>
              {[1, 2, 3, 4, 5, 6].map(i => (
                <SkeletonLoader key={i} width={40} height={32} borderRadius={8} />
              ))}
            </View>
          </View>

          {/* Day Cards */}
          {[1, 2, 3, 4, 5].map(i => (
            <View key={i} style={[styles.dayCard, { shadowColor: isDark ? '#000' : '#888', backgroundColor: 'transparent', overflow: 'hidden' }]}>
              <BlurView
                intensity={isDark ? 40 : 80}
                tint={isDark ? 'dark' : 'light'}
                style={[StyleSheet.absoluteFill, { backgroundColor: isDark ? 'rgba(40,40,40,0.5)' : 'rgba(255,255,255,0.7)' }]}
              />
              {/* Accent Bar */}
              <View style={[styles.dayAccent, { backgroundColor: isDark ? 'rgba(255,255,255,0.15)' : 'rgba(0,0,0,0.08)' }]} />
              <View style={styles.dayContent}>
                {/* Date + Day header */}
                <View style={styles.dayHeader}>
                  <View>
                    <SkeletonLoader width={90} height={16} borderRadius={4} />
                    <SkeletonLoader width={60} height={14} borderRadius={4} style={{ marginTop: 4 }} />
                  </View>
                  <View style={{ flexDirection: 'row', gap: 6 }}>
                    <SkeletonLoader width={44} height={24} borderRadius={8} />
                    <SkeletonLoader width={44} height={24} borderRadius={8} />
                  </View>
                </View>
                {/* Period Cells */}
                <View style={styles.periodsRow}>
                  {[1, 2, 3, 4, 5, 6].map(j => (
                    <SkeletonLoader key={j} width={44} height={36} borderRadius={8} />
                  ))}
                </View>
              </View>
            </View>
          ))}
        </View>
      </View>
    );
  }

  const renderPeriodCell = (status: string, index: number) => {
    let bgColor = isDark ? '#3a3a5e' : '#E5E5EA';
    let textColor = colors.textSecondary;
    let borderColor = 'transparent';

    if (status === 'P') {
      bgColor = colors.success + '20'; // Glassy success
      textColor = colors.success;
      borderColor = colors.success + '40';
    } else if (status === 'A') {
      bgColor = colors.error + '20'; // Glassy error
      textColor = colors.error;
      borderColor = colors.error + '40';
    }

    return (
      <View key={index} style={[styles.periodCell, { backgroundColor: bgColor, borderWidth: 1, borderColor }]}>
        <Text style={[styles.periodText, { color: textColor }]}>{status === 'null' ? '‚ÅÉ' : status}</Text>
      </View>
    );
  };

  const renderDayItem = ({ item, index }: { item: DailyAttendance; index: number }) => {
    const absentCount = item.periods.filter(p => p === 'A').length;
    const presentCount = item.periods.filter(p => p === 'P').length;
    // const isGood = absentCount === 0;

    return (
      <Animated.View
        entering={FadeInDown.delay(index * 50).springify()}
      >
        <ScalePressable
          style={[styles.dayCard, { shadowColor: isDark ? '#000' : '#888', backgroundColor: 'transparent' }]}
        >
          <BlurView
            intensity={isDark ? 40 : 80}
            tint={isDark ? 'dark' : 'light'}
            style={[StyleSheet.absoluteFill, { backgroundColor: isDark ? 'rgba(40,40,40,0.5)' : 'rgba(255,255,255,0.7)' }]}
          />
          <View style={[styles.dayAccent, { backgroundColor: absentCount === 0 ? colors.success : colors.error }]} />
          <View style={styles.dayContent}>
            <View style={styles.dayHeader}>
              <View>
                <Text style={[styles.dateText, { color: colors.text }]}>{item.date}</Text>
                <Text style={[styles.dayText, { color: colors.textSecondary }]}>{item.day}</Text>
              </View>
              <View style={{ flexDirection: 'row', gap: 6 }}>
                {presentCount > 0 && (
                  <View style={[styles.statusBadge, { backgroundColor: colors.success + '20', borderColor: colors.success + '30', borderWidth: 1 }]}>
                    <Text style={{ color: colors.success, fontSize: 12, fontWeight: 'bold' }}>P: {presentCount}</Text>
                  </View>
                )}
                {absentCount > 0 && (
                  <View style={[styles.statusBadge, { backgroundColor: colors.error + '20', borderColor: colors.error + '30', borderWidth: 1 }]}>
                    <Text style={{ color: colors.error, fontSize: 12, fontWeight: 'bold' }}>A: {absentCount}</Text>
                  </View>
                )}
                {presentCount === 0 && absentCount === 0 && (
                  <View style={[styles.statusBadge, { backgroundColor: colors.textSecondary + '20' }]}>
                    <Text style={{ color: colors.textSecondary, fontSize: 12, fontWeight: 'bold' }}>-</Text>
                  </View>
                )}
              </View>
            </View>
            <View style={styles.periodsRow}>
              {item.periods.map((status, idx) => renderPeriodCell(status, idx))}
            </View>
          </View>
        </ScalePressable>
      </Animated.View>
    );
  };

  return (
    <View style={[styles.container, { paddingTop: insets.top, backgroundColor: colors.background }]}>
      <StatusBar style={isDark ? "light" : "dark"} />
      <LinearGradient
        colors={isDark ? [colors.background, '#1a1a1a'] : [colors.primary + '10', colors.background]}
        start={{ x: 0, y: 0 }}
        end={{ x: 1, y: 1 }}
        style={StyleSheet.absoluteFill}
      />

      <FlatList
        data={filteredDays}
        keyExtractor={(item, index) => `${item.date}-${index}`}
        renderItem={renderDayItem}
        contentContainerStyle={styles.listContent}
        refreshControl={<RefreshControl refreshing={refreshing} onRefresh={onRefresh} tintColor={colors.text} />}
        ListHeaderComponent={() => (
          <View>
            {/* Title */}
            <View style={styles.header}>
              <Text style={[styles.headerTitle, { color: colors.text }]}>Date-wise Attendance</Text>
              <Text style={[styles.headerCount, { color: colors.textSecondary }]}>{filteredDays.length} days</Text>
            </View>

            {/* Month Filter */}
            <ScrollView
              horizontal
              showsHorizontalScrollIndicator={false}
              style={styles.filterContainer}
              contentContainerStyle={styles.filterScroll}
            >
              {months.map((month) => (
                <TouchableOpacity
                  key={month}
                  style={[
                    styles.filterChip,
                    {
                      backgroundColor: selectedMonth === month ? colors.primary : (isDark ? 'rgba(255,255,255,0.1)' : 'rgba(0,0,0,0.05)'),
                      borderWidth: 1,
                      borderColor: selectedMonth === month ? colors.primary : (isDark ? 'rgba(255,255,255,0.1)' : 'rgba(0,0,0,0.05)')
                    }
                  ]}
                  onPress={() => {
                    setSelectedMonth(month);
                    Haptics.selectionAsync();
                  }}
                >
                  <Text style={[
                    styles.filterChipText,
                    { color: colors.textSecondary },
                    selectedMonth === month && { color: '#fff' }
                  ]}>
                    {month}
                  </Text>
                </TouchableOpacity>
              ))}
            </ScrollView>

            {/* Period Legend */}
            <View style={[styles.legendCard, { backgroundColor: colors.card }]}>
              <Text style={[styles.legendTitle, { color: colors.textSecondary }]}>Periods</Text>
              <View style={styles.legendRow}>
                {['P1', 'P2', 'P3', 'P4', 'P5', 'P6'].map((p, i) => (
                  <View key={i} style={[styles.legendItem, { backgroundColor: isDark ? '#3a3a5e' : '#E5E5EA' }]}>
                    <Text style={[styles.legendText, { color: colors.text }]}>{p}</Text>
                  </View>
                ))}
              </View>
            </View>
          </View>
        )}
        ListEmptyComponent={() => (
          <View style={styles.emptyContainer}>
            <Text style={[styles.emptyText, { color: colors.textSecondary }]}>No attendance records found</Text>
          </View>
        )}
      />
    </View>
  );
}

const styles = StyleSheet.create({
  container: {
    flex: 1,
  },
  centerContainer: {
    flex: 1,
    justifyContent: 'center',
    alignItems: 'center',
  },
  listContent: {
    padding: 16,
    paddingBottom: 100,
  },
  header: {
    flexDirection: 'row',
    justifyContent: 'space-between',
    alignItems: 'center',
    marginBottom: 20,
    paddingHorizontal: 16, // Added padding since removed from styles.header in previous version? No, keeping consistent
  },
  headerTitle: {
    fontSize: 22,
    fontWeight: 'bold',
  },
  headerCount: {
    fontSize: 14,
  },
  filterContainer: {
    marginBottom: 20,
  },
  filterScroll: {
    paddingRight: 16,
  },
  filterChip: {
    paddingHorizontal: 16,
    paddingVertical: 10,
    borderRadius: 20,
    marginRight: 12,
    shadowColor: "#000",
    shadowOffset: { width: 0, height: 2 },
    shadowOpacity: 0.1,
    shadowRadius: 4,
    elevation: 2,
  },
  filterChipText: {
    fontSize: 14,
    fontWeight: '500',
  },
  legendCard: {
    borderRadius: 16,
    padding: 16,
    marginBottom: 20,
  },
  legendTitle: {
    fontSize: 14,
    marginBottom: 12,
  },
  legendRow: {
    flexDirection: 'row',
    justifyContent: 'space-around',
  },
  legendItem: {
    width: 40,
    height: 32,
    borderRadius: 8,
    justifyContent: 'center',
    alignItems: 'center',
  },
  legendText: {
    fontSize: 12,
    fontWeight: '600',
  },
  dayCard: {
    borderRadius: 24,
    flexDirection: 'row',
    marginBottom: 16,
    overflow: 'hidden',
    shadowOffset: { width: 0, height: 4 },
    shadowOpacity: 0.1,
    shadowRadius: 12,
    elevation: 4,
  },
  dayAccent: {
    width: 5,
  },
  dayContent: {
    flex: 1,
    padding: 16,
    // Add padding right to avoid content hitting edge
    paddingRight: 16
  },
  dayHeader: {
    flexDirection: 'row',
    justifyContent: 'space-between',
    alignItems: 'center',
    marginBottom: 12,
  },
  dateText: {
    fontSize: 16,
    fontWeight: 'bold',
  },
  dayText: {
    fontSize: 14,
  },
  periodsRow: {
    flexDirection: 'row',
    justifyContent: 'space-between',
    marginBottom: 4, // Reduced bottom margin
  },
  periodCell: {
    width: 44,
    height: 36,
    borderRadius: 8,
    justifyContent: 'center',
    alignItems: 'center',
  },
  periodText: {
    fontSize: 14,
    fontWeight: 'bold',
  },
  statusBadge: {
    paddingHorizontal: 8,
    paddingVertical: 4,
    borderRadius: 8,
  },
  statsRow: {
    alignItems: 'flex-end',
  },
  statText: {
    fontSize: 12,
  },
  emptyContainer: {
    padding: 40,
    alignItems: 'center',
  },
  emptyText: {
    fontSize: 16,
  },
});


=======================================================
FILE: app\(tabs)\index.tsx
=======================================================

import { useResults } from '@/context/ResultsContext';
import { useTheme } from '@/context/ThemeContext';
import { Ionicons } from '@expo/vector-icons';
import { BlurView } from 'expo-blur';
import * as Haptics from 'expo-haptics';
import { LinearGradient } from 'expo-linear-gradient';
import { useRouter } from 'expo-router';
import React, { useCallback, useEffect, useState } from 'react';
import { FlatList, Image, Modal, RefreshControl, StyleSheet, Text, TouchableOpacity, View } from 'react-native';
import Animated, { Easing, FadeInDown, useAnimatedStyle, useSharedValue, withRepeat, withSequence, withTiming } from 'react-native-reanimated';
import { useSafeAreaInsets } from 'react-native-safe-area-context';
import { AnimatedNumber } from '../../components/AnimatedNumber';
import { ScalePressable } from '../../components/ScalePressable';
import { SkeletonLoader } from '../../components/SkeletonLoader';
import { AttendanceResponse, AttendanceService, MonthlyAttendance } from '../../services/attendance';
import { AuthService, StudentProfile } from '../../services/auth';

// --- Premium Sync Component ---
const SyncedCard = ({ title, subtitle, icon, loading, loadingText, loadingSubtitle, onPress, isDark, colors, color, subtitleValue }: any) => {
  const rotation = useSharedValue(0);
  const opacity = useSharedValue(1);

  useEffect(() => {
    if (loading) {
      rotation.value = withRepeat(withTiming(360, { duration: 2000, easing: Easing.linear }), -1);
      // Breathing animation: Scale up and down
      opacity.value = withRepeat(
        withSequence(
          withTiming(0.6, { duration: 1000 }),
          withTiming(1, { duration: 1000 })
        ),
        -1,
        true // Reverse
      );
    } else {
      rotation.value = 0; // Reset
      opacity.value = 1;
    }
  }, [loading, rotation, opacity]);

  const animatedIconStyle = useAnimatedStyle(() => {
    return {
      transform: [{ rotate: `${rotation.value}deg` }, { scale: opacity.value === 1 ? 1 : (opacity.value + 0.2) }], // Scale with opacity for breathing efffect
      opacity: opacity.value,
    };
  });

  const animatedTextStyle = useAnimatedStyle(() => {
    return {
      opacity: opacity.value,
    };
  });

  return (
    <ScalePressable
      style={[styles.gridItem, { opacity: loading ? 0.8 : 1 }]} // Slightly higher opacity for premium glass feel
      onPress={onPress}
      disabled={loading}
    >
      <BlurView intensity={isDark ? 40 : 80} tint={isDark ? 'dark' : 'light'} style={[styles.gridCard, { backgroundColor: isDark ? 'rgba(40,40,40,0.5)' : 'rgba(255,255,255,0.6)', borderColor: colors.cardBorder, borderWidth: 1 }]}>
        <View style={[styles.gridIcon, { backgroundColor: color + '20' }]}>
          {loading ? (
            <Animated.View style={animatedIconStyle}>
              <Ionicons name="sync" size={24} color={color} />
            </Animated.View>
          ) : (
            <Ionicons name={icon} size={24} color={color} />
          )}
        </View>
        <View>
          {loading ? (
            <Animated.View style={animatedTextStyle}>
              <Text style={[styles.gridTitle, { color: colors.text }]}>{loadingText}</Text>
              <Text style={[styles.gridSubtitle, { color: colors.textSecondary }]}>{loadingSubtitle}</Text>
            </Animated.View>
          ) : (
            <View>
              <Text style={[styles.gridTitle, { color: colors.text }]}>{title}</Text>
              <Text style={[styles.gridSubtitle, { color: colors.textSecondary }]}>
                {subtitleValue || subtitle}
              </Text>
            </View>
          )}
        </View>
      </BlurView>
    </ScalePressable>
  );
};

export default function HomeScreen() {
  const [attendanceData, setAttendanceData] = useState<AttendanceResponse | null>(null);
  const [profile, setProfile] = useState<StudentProfile | null>(null);
  const [loading, setLoading] = useState(true);
  const [refreshing, setRefreshing] = useState(false);
  const [isOffline, setIsOffline] = useState(false);
  const [showInfoModal, setShowInfoModal] = useState(false);
  const [showPhotoModal, setShowPhotoModal] = useState(false);

  /* New State for Fee Loading */
  const [feeLoading, setFeeLoading] = useState(false);


  const router = useRouter();
  const insets = useSafeAreaInsets();
  const { colors, isDark } = useTheme();
  // @ts-ignore - Consume initFetch and loading state
  const { showResults, initFetch, loading: resultsLoading } = useResults();

  const fetchData = useCallback(async () => {
    try {
      const isLoggedIn = await AuthService.isLoggedIn();
      if (!isLoggedIn) {
        router.replace('/login');
        return;
      }

      const userProfile = await AuthService.getProfile();
      setProfile(userProfile);

      const data = await AttendanceService.getAttendance();
      if (data) {
        setAttendanceData(data);
        setIsOffline(!!data.isOffline);
      }

      // Trigger Results Fetch in Background
      initFetch();

      // Trigger Fees Fetch
      fetchFees();

    } catch {
      // Fetch error handled silently
    } finally {
      setLoading(false);
      setRefreshing(false);
    }
  }, [router, initFetch]); // Added initFetch dependency

  const fetchFees = async () => {
    setFeeLoading(true);
    try {
      // Dynamic import to avoid circular dependencies if any
      const { FeeService } = await import('../../services/FeeService');

      // Get current academic year first
      const years = await FeeService.getAcademicYears();
      const currentYear = years.length > 0 ? years[0] : '2025-26';

      await FeeService.getReceipts(currentYear);

    } catch {
      // Fee fetch error handled silently
    } finally {
      setFeeLoading(false);
    }
  };

  useEffect(() => {
    fetchData();
  }, [fetchData]);

  const onRefresh = useCallback(() => {
    setRefreshing(true);
    fetchData();
  }, [fetchData]);

  // ... (Keep existing cleanup and headerComponent code until statsRow) ... 

  const mounted = React.useRef(true);
  useEffect(() => {
    return () => { mounted.current = false; };
  }, []);

  const headerComponent = (
    <Animated.View entering={FadeInDown.duration(800).springify()}>
      {/* Header */}
      <View style={styles.header}>
        <View style={{ flex: 1, marginRight: 12, flexShrink: 1 }}>
          <Text style={[styles.welcomeText, { color: colors.textSecondary }]}>Welcome back,</Text>
          <Text style={[styles.nameText, { color: colors.text }]} numberOfLines={1} adjustsFontSizeToFit>
            {profile?.name?.split(' ')[0] || 'Student'}
          </Text>
          {isOffline && (
            <View style={[styles.offlineBadge, { backgroundColor: colors.warning + '20' }]}>
              <Ionicons name="cloud-offline" size={12} color={colors.warning} style={{ marginRight: 4 }} />
              <Text style={{ color: colors.warning, fontSize: 10, fontWeight: '600' }}>OFFLINE MODE</Text>
            </View>
          )}
        </View>
        <View style={{ flexDirection: 'row', alignItems: 'center', flexShrink: 0 }}>
          <ScalePressable
            onPress={() => router.push('/notifications')}
            style={[styles.iconBtn, { borderColor: colors.cardBorder, backgroundColor: colors.card, marginRight: 8 }]}
          >
            <Ionicons name="notifications-outline" size={22} color={colors.text} />
          </ScalePressable>
          <ScalePressable
            onPress={() => router.push('/settings' as any)}
            style={[styles.iconBtn, { borderColor: colors.cardBorder, backgroundColor: colors.card }]}
          >
            <Ionicons name="settings-outline" size={22} color={colors.text} />
          </ScalePressable>
        </View>
      </View>

      {/* Profile Card with Glassmorphism */}
      <Animated.View entering={FadeInDown.delay(100).duration(800).springify()}>
        <BlurView intensity={isDark ? 50 : 80} tint={isDark ? 'dark' : 'light'} style={[styles.profileCard, { borderColor: colors.cardBorder, borderWidth: 1, backgroundColor: isDark ? 'rgba(30,30,30,0.5)' : 'rgba(255,255,255,0.7)' }]}>
          <ScalePressable
            style={{ flexDirection: 'row', flex: 1, alignItems: 'center' }}
            onPress={() => router.push('/student-profile' as any)}
          >
            <View>
              <Image
                source={{ uri: profile?.profileImage || 'https://via.placeholder.com/60' }}
                style={[styles.profileImage, { backgroundColor: colors.badge, borderColor: colors.success }]}
              />
              {/* Show hint if no image OR if image is the default placeholder */}
              {(!profile?.profileImage || profile.profileImage.includes('default.png')) && (
                <TouchableOpacity
                  style={{
                    position: 'absolute',
                    bottom: -4,
                    right: -4,
                    backgroundColor: '#f59e0b', // Amber
                    borderRadius: 12,
                    borderWidth: 2,
                    borderColor: colors.card,
                    padding: 4,
                    zIndex: 20,
                    elevation: 5,
                  }}
                  hitSlop={{ top: 15, bottom: 15, left: 15, right: 15 }}
                  onPress={(e) => {
                    e.stopPropagation();
                    setShowPhotoModal(true);
                  }}
                >
                  <Ionicons name="information" size={16} color="#fff" />
                </TouchableOpacity>
              )}
            </View>
            <View style={styles.profileInfo}>
              <Text style={[styles.profileName, { color: colors.text }]}>{profile?.name || 'Student'}</Text>
              <Text style={[styles.profileDept, { color: colors.textSecondary }]}>{profile?.department || 'Department'}</Text>
              <View style={styles.badgesRow}>
                <View style={[styles.badge, { backgroundColor: colors.badge }]}>
                  <Text style={[styles.badgeText, { color: colors.badgeText }]}>Year {profile?.year || '-'}</Text>
                </View>
                <View style={[styles.badge, { backgroundColor: colors.badge }]}>
                  <Text style={[styles.badgeText, { color: colors.badgeText }]}>ID: {profile?.rollNo}</Text>
                </View>
              </View>
            </View>
          </ScalePressable>
        </BlurView>
      </Animated.View>

      {/* Stats Row with Glassmorphism */}
      <Animated.View
        entering={FadeInDown.delay(200).duration(800).springify()}
        style={styles.statsRow}
      >
        <View style={{ flex: 1 }}>
          <BlurView intensity={isDark ? 40 : 80} tint={isDark ? 'dark' : 'light'} style={[styles.statCard, { backgroundColor: isDark ? 'rgba(40,40,40,0.5)' : 'rgba(255,255,255,0.6)', borderColor: colors.cardBorder, borderWidth: 1 }]}>
            <View style={styles.statHeader}>
              <Ionicons name="checkmark-circle" size={16} color={colors.success} style={{ marginRight: 6 }} />
              <Text style={[styles.statLabel, { color: colors.textSecondary }]}>OVERALL</Text>
            </View>
            <View>
              <AnimatedNumber
                value={attendanceData?.overallPercentage || 0}
                style={[styles.statValue, { color: (attendanceData?.overallPercentage || 0) >= 75 ? colors.success : colors.error }]}
                suffix="%"
              />
              <Text style={[styles.statSubtext, { color: colors.textSecondary }]}>
                {attendanceData?.semesterTotal ? `${attendanceData.semesterTotal.attended} / ${attendanceData.semesterTotal.total} classes` : 'Total Attendance'}
              </Text>
            </View>
          </BlurView>
        </View>

        <View style={{ flex: 1 }}>
          <BlurView intensity={isDark ? 40 : 80} tint={isDark ? 'dark' : 'light'} style={[styles.statCard, { backgroundColor: isDark ? 'rgba(40,40,40,0.5)' : 'rgba(255,255,255,0.6)', borderColor: colors.cardBorder, borderWidth: 1 }]}>
            <View style={styles.statHeader}>
              <Ionicons
                name={(attendanceData?.overallPercentage || 0) >= 75 ? "trending-up" : "warning"}
                size={16}
                color={(attendanceData?.overallPercentage || 0) >= 75 ? colors.success : colors.warning}
                style={{ marginRight: 6 }}
              />
              <Text style={[styles.statLabel, { color: colors.textSecondary }]}>PREDICTION (75%)</Text>
            </View>
            {(() => {
              const attended = attendanceData?.semesterTotal?.attended || 0;
              const total = attendanceData?.semesterTotal?.total || 0;
              const percentage = attendanceData?.overallPercentage || 0;
              const targetDecimal = 0.75;

              // Always calculate skips, but floor at 0 if below target
              let canSkip = 0;
              if (percentage >= 75) {
                canSkip = Math.floor((attended - targetDecimal * total) / targetDecimal);
              }

              return (
                <View>
                  <AnimatedNumber
                    value={canSkip}
                    style={[styles.statValue, { color: canSkip > 0 ? colors.success : colors.textSecondary, fontSize: 32 }]}
                  />
                  <Text style={[styles.statSubtext, { color: colors.textSecondary }]}>classes you can skip</Text>
                </View>
              );
            })()}
          </BlurView>
        </View>
      </Animated.View>

      {/* Quick Actions Grid */}
      <Animated.View entering={FadeInDown.delay(300).duration(800).springify()} style={{ marginBottom: 24 }}>
        <View style={styles.gridContainer}>
          {/* Exam Results Card */}
          <SyncedCard
            title="Exam Results"
            subtitle="Grades & CGPA"
            icon="school-outline"
            loading={resultsLoading}
            loadingText="Syncing..." // Premium Text
            loadingSubtitle="Checking portal..."
            onPress={() => showResults()}
            isDark={isDark}
            colors={colors}
            color={colors.primary}
          />

          {/* Fee Receipts Card */}
          <SyncedCard
            title="Fee Receipts"
            subtitle="Payment History"
            icon="receipt-outline"
            loading={feeLoading}
            loadingText="Syncing..."
            loadingSubtitle="Fetching records..."
            onPress={() => router.push('/fee-receipts' as any)}
            isDark={isDark}
            colors={colors}
            color={colors.warning}
            subtitleValue={undefined}
          />
        </View>
      </Animated.View>

      {/* Section Title */}
      <View style={styles.sectionHeader}>
        <Text style={[styles.sectionTitle, { color: colors.text }]}>Monthly Attendance</Text>
      </View>
    </Animated.View >
  );

  if (loading) {
    const skeletonColor = isDark ? 'rgba(255, 255, 255, 0.15)' : 'rgba(0, 0, 0, 0.08)';

    return (
      <View style={[styles.container, { backgroundColor: colors.background, paddingTop: insets.top }]}>
        <LinearGradient
          colors={isDark ? ['#1a1a2e', '#16213e'] : ['#f0f4ff', '#e8f0fe']}
          style={StyleSheet.absoluteFill}
        />
        {/* Skeleton Header */}
        <View style={styles.header}>
          <View style={{ flex: 1 }}>
            <SkeletonLoader width={100} height={14} style={{ backgroundColor: skeletonColor }} />
            <SkeletonLoader width={150} height={24} style={{ marginTop: 8, backgroundColor: skeletonColor }} />
          </View>
          <View style={{ flexDirection: 'row', gap: 8 }}>
            <SkeletonLoader width={44} height={44} borderRadius={22} style={{ backgroundColor: skeletonColor }} />
            <SkeletonLoader width={44} height={44} borderRadius={22} style={{ backgroundColor: skeletonColor }} />
          </View>
        </View>

        {/* Skeleton Profile Card */}
        <BlurView intensity={isDark ? 50 : 80} tint={isDark ? 'dark' : 'light'} style={[styles.profileCard, { borderColor: colors.cardBorder, borderWidth: 1, backgroundColor: isDark ? 'rgba(30,30,30,0.5)' : 'rgba(255,255,255,0.7)' }]}>
          <View style={{ flexDirection: 'row', alignItems: 'center', flex: 1 }}>
            <SkeletonLoader width={60} height={60} borderRadius={30} style={{ backgroundColor: skeletonColor }} />
            <View style={{ marginLeft: 16, flex: 1 }}>
              <SkeletonLoader width="60%" height={20} style={{ backgroundColor: skeletonColor }} />
              <SkeletonLoader width="40%" height={14} style={{ marginTop: 8, backgroundColor: skeletonColor }} />
              <View style={{ flexDirection: 'row', marginTop: 12, gap: 8 }}>
                <SkeletonLoader width={60} height={20} borderRadius={8} style={{ backgroundColor: skeletonColor }} />
                <SkeletonLoader width={80} height={20} borderRadius={8} style={{ backgroundColor: skeletonColor }} />
              </View>
            </View>
          </View>
        </BlurView>

        {/* Skeleton Stats */}
        <View style={styles.statsRow}>
          <View style={{ flex: 1 }}>
            <BlurView intensity={isDark ? 40 : 80} tint={isDark ? 'dark' : 'light'} style={[styles.statCard, { backgroundColor: isDark ? 'rgba(40,40,40,0.5)' : 'rgba(255,255,255,0.6)', borderColor: colors.cardBorder, borderWidth: 1 }]}>
              <View style={styles.statHeader}>
                <SkeletonLoader width={16} height={16} borderRadius={8} style={{ backgroundColor: skeletonColor }} />
                <SkeletonLoader width={60} height={12} style={{ marginLeft: 6, backgroundColor: skeletonColor }} />
              </View>
              <View>
                <SkeletonLoader width={80} height={36} style={{ backgroundColor: skeletonColor }} />
                <SkeletonLoader width={100} height={12} style={{ marginTop: 4, backgroundColor: skeletonColor }} />
              </View>
            </BlurView>
          </View>
          <View style={{ flex: 1 }}>
            <BlurView intensity={isDark ? 40 : 80} tint={isDark ? 'dark' : 'light'} style={[styles.statCard, { backgroundColor: isDark ? 'rgba(40,40,40,0.5)' : 'rgba(255,255,255,0.6)', borderColor: colors.cardBorder, borderWidth: 1 }]}>
              <View style={styles.statHeader}>
                <SkeletonLoader width={16} height={16} borderRadius={8} style={{ backgroundColor: skeletonColor }} />
                <SkeletonLoader width={80} height={12} style={{ marginLeft: 6, backgroundColor: skeletonColor }} />
              </View>
              <View>
                <SkeletonLoader width={40} height={36} style={{ backgroundColor: skeletonColor }} />
                <SkeletonLoader width={120} height={12} style={{ marginTop: 4, backgroundColor: skeletonColor }} />
              </View>
            </BlurView>
          </View>
        </View>

        {/* Skeleton Quick Actions */}
        <View style={{ marginBottom: 24 }}>
          <View style={styles.gridContainer}>
            {[1, 2].map((i) => (
              <View key={i} style={[styles.gridItem, { opacity: 1 }]}>
                <BlurView intensity={isDark ? 40 : 80} tint={isDark ? 'dark' : 'light'} style={[styles.gridCard, { backgroundColor: isDark ? 'rgba(40,40,40,0.5)' : 'rgba(255,255,255,0.6)', borderColor: colors.cardBorder, borderWidth: 1 }]}>
                  <View style={[styles.gridIcon, { backgroundColor: colors.cardBorder }]}>
                    <SkeletonLoader width={24} height={24} borderRadius={12} style={{ backgroundColor: skeletonColor }} />
                  </View>
                  <View>
                    <SkeletonLoader width={100} height={16} style={{ backgroundColor: skeletonColor }} />
                    <SkeletonLoader width={80} height={12} style={{ marginTop: 4, backgroundColor: skeletonColor }} />
                  </View>
                </BlurView>
              </View>
            ))}
          </View>
        </View>

        {/* Skeleton Monthly Attendance List */}
        <View style={styles.sectionHeader}>
          <SkeletonLoader width={180} height={20} style={{ backgroundColor: skeletonColor }} />
        </View>

        <View>
          {[1, 2, 3].map((i) => (
            <BlurView key={i} intensity={isDark ? 40 : 80} tint={isDark ? 'dark' : 'light'} style={[styles.subjectCard, { backgroundColor: isDark ? 'rgba(40,40,40,0.5)' : 'rgba(255,255,255,0.6)', borderColor: colors.cardBorder, borderWidth: 1 }]}>
              <View style={styles.subjectContent}>
                <SkeletonLoader width={100} height={18} style={{ backgroundColor: skeletonColor }} />
                <SkeletonLoader width={140} height={14} style={{ marginTop: 6, backgroundColor: skeletonColor }} />
                <SkeletonLoader width={60} height={20} borderRadius={10} style={{ marginTop: 8, backgroundColor: skeletonColor }} />
              </View>
              <SkeletonLoader width={56} height={56} borderRadius={30} style={{ backgroundColor: skeletonColor }} />
            </BlurView>
          ))}
        </View>
      </View>
    );
  }

  const getColor = (pct: number) => {
    if (pct >= 75) return colors.success;
    if (pct >= 60) return colors.warning;
    return colors.error;
  };

  const CircularProgress = ({ percentage, size = 56 }: { percentage: number; size?: number }) => {
    const color = getColor(percentage);

    return (
      <View style={[styles.circleOuter, { width: size, height: size, borderColor: colors.badge }]}>
        <View style={[styles.circleInner, {
          width: size - 8,
          height: size - 8,
          borderColor: color,
          borderTopColor: percentage < 25 ? colors.badge : color,
          borderRightColor: percentage < 50 ? colors.badge : color,
          borderBottomColor: percentage < 75 ? colors.badge : color,
          backgroundColor: colors.card,
        }]}>
          <Text style={[styles.circleText, { color }]}>{Math.round(percentage)}%</Text>
        </View>
      </View>
    );
  };

  const renderMonthItem = ({ item }: { item: MonthlyAttendance }) => {
    const isLow = item.percentage < 75;
    const isWarning = item.percentage >= 75 && item.percentage < 85;

    return (
      <BlurView
        intensity={isDark ? 40 : 80}
        tint={isDark ? 'dark' : 'light'}
        style={[styles.subjectCard, {
          backgroundColor: isDark ? 'rgba(40,40,40,0.5)' : 'rgba(255,255,255,0.6)',
          borderColor: colors.cardBorder,
          borderWidth: 1
        }]}
      >
        <View style={styles.subjectContent}>
          <Text style={[styles.subjectName, { color: colors.text }]}>{item.month}</Text>
          <Text style={[styles.subjectDetails, { color: colors.textSecondary }]}>
            {item.attended} / {item.total} classes
          </Text>
          <View style={[styles.statusBadge, {
            backgroundColor: isLow ? colors.errorBg : isWarning ? colors.warningBg : colors.successBg
          }]}>
            <Text style={[styles.statusText, {
              color: isLow ? colors.error : isWarning ? colors.warning : colors.success
            }]}>
              {isLow ? 'Low' : isWarning ? 'Warning' : 'Safe'}
            </Text>
          </View>
        </View>
        <CircularProgress percentage={item.percentage} />
      </BlurView>
    );
  };

  return (
    <View style={[styles.container, { paddingTop: insets.top, backgroundColor: colors.background }]}>
      <LinearGradient
        colors={isDark ? [colors.background, '#1a1a1a'] : [colors.primary + '10', colors.background]}
        start={{ x: 0, y: 0 }}
        end={{ x: 1, y: 1 }}
        style={StyleSheet.absoluteFill}
      />

      <FlatList
        data={attendanceData?.months ? [...attendanceData.months] : []}
        keyExtractor={(item) => item.month}
        renderItem={renderMonthItem}
        contentContainerStyle={styles.listContent}
        refreshControl={<RefreshControl refreshing={refreshing} onRefresh={onRefresh} tintColor={colors.text} />}
        ListHeaderComponent={headerComponent}
        showsVerticalScrollIndicator={false}
      />

      {/* Info Modal */}
      <Modal
        animationType="fade"
        transparent={true}
        visible={showInfoModal}
        onRequestClose={() => setShowInfoModal(false)}
      >
        <BlurView intensity={20} tint={isDark ? "dark" : "light"} style={styles.modalOverlay}>
          <View style={[styles.modalCard, { backgroundColor: colors.card, borderColor: colors.cardBorder }]}>
            <View style={{ alignItems: 'center', marginBottom: 16 }}>
              <View style={{ width: 48, height: 48, borderRadius: 24, backgroundColor: colors.primary + '20', justifyContent: 'center', alignItems: 'center', marginBottom: 12 }}>
                <Ionicons name="shield-checkmark-outline" size={28} color={colors.primary} />
              </View>
              <Text style={[styles.modalTitle, { color: colors.text }]}>Smart Auto-Login</Text>
            </View>

            <Text style={[styles.modalText, { color: colors.textSecondary }]}>
              The Student Portal connects safely to the college ERP (erp.nrcmec.org).
            </Text>
            <Text style={[styles.modalText, { color: colors.textSecondary, marginTop: 8 }]}>
              We use your saved app credentials to <Text style={{ color: colors.success, fontWeight: 'bold' }}>automatically fill</Text> the username and password fields for you.
            </Text>

            <TouchableOpacity
              style={[styles.modalButton, { backgroundColor: colors.primary }]}
              onPress={() => {
                Haptics.impactAsync(Haptics.ImpactFeedbackStyle.Light);
                setShowInfoModal(false);
              }}
            >
              <Text style={styles.modalButtonText}>Got it</Text>
            </TouchableOpacity>
          </View>
        </BlurView>
      </Modal>
      {/* Photo Update Modal */}
      <Modal
        animationType="fade"
        transparent={true}
        visible={showPhotoModal}
        onRequestClose={() => setShowPhotoModal(false)}
      >
        <BlurView intensity={40} tint={isDark ? "dark" : "light"} style={styles.modalOverlay}>
          <Animated.View
            entering={FadeInDown.springify().damping(15)}
            style={[styles.modalCard, { backgroundColor: colors.card, borderColor: colors.cardBorder, overflow: 'hidden' }]}
          >
            <LinearGradient
              colors={isDark ? [colors.background, colors.card] : [colors.card, colors.background]}
              style={StyleSheet.absoluteFill}
            />

            <View style={{ alignItems: 'center', marginBottom: 20 }}>
              <View style={{
                width: 64, height: 64, borderRadius: 32,
                backgroundColor: colors.primary + '15',
                justifyContent: 'center', alignItems: 'center',
                marginBottom: 16,
                borderWidth: 1, borderColor: colors.primary + '30'
              }}>
                <Ionicons name="image-outline" size={32} color={colors.primary} />
                <View style={{ position: 'absolute', bottom: 0, right: 0, backgroundColor: colors.badge, borderRadius: 10, padding: 2 }}>
                  <Ionicons name="cloud-upload" size={12} color={colors.success} />
                </View>
              </View>
              <Text style={[styles.modalTitle, { color: colors.text, fontSize: 22 }]}>Update Profile Photo</Text>
            </View>

            <Text style={[styles.modalText, { color: colors.textSecondary, marginBottom: 8 }]}>
              Want to see your picture here?
            </Text>
            <Text style={[styles.modalText, { color: colors.text, fontWeight: '500' }]}>
              Please update your profile photo on the <Text style={{ color: colors.primary }}>College Website</Text>.
            </Text>
            <Text style={[styles.modalText, { color: colors.textSecondary, fontSize: 12, marginTop: 8 }]}>
              It will sync automatically next time you login!
            </Text>

            <TouchableOpacity
              style={[styles.modalButton, { backgroundColor: colors.primary, marginTop: 28, shadowColor: colors.primary, shadowOpacity: 0.3, shadowRadius: 8, elevation: 4 }]}
              onPress={() => {
                Haptics.impactAsync(Haptics.ImpactFeedbackStyle.Light);
                setShowPhotoModal(false);
              }}
              activeOpacity={0.8}
            >
              <Text style={styles.modalButtonText}>Understood</Text>
            </TouchableOpacity>
          </Animated.View>
        </BlurView>
      </Modal>
    </View>
  );
}

const styles = StyleSheet.create({
  container: {
    flex: 1,
  },
  centerContainer: {
    flex: 1,
    justifyContent: 'center',
    alignItems: 'center',
  },
  listContent: {
    padding: 16,
    paddingBottom: 100,
  },
  header: {
    flexDirection: 'row',
    justifyContent: 'space-between',
    alignItems: 'flex-start',
    marginBottom: 24,
  },
  offlineBadge: {
    flexDirection: 'row',
    alignItems: 'center',
    marginTop: 4,
    paddingHorizontal: 6,
    paddingVertical: 2,
    borderRadius: 4,
    alignSelf: 'flex-start'
  },
  emptyText: {
    fontSize: 16,
  },
  modalOverlay: {
    flex: 1,
    justifyContent: 'center',
    alignItems: 'center',
    backgroundColor: 'rgba(0,0,0,0.3)',
  },
  modalCard: {
    width: '85%',
    padding: 24,
    borderRadius: 20,
    borderWidth: 1,
    shadowColor: "#000",
    shadowOffset: { width: 0, height: 10 },
    shadowOpacity: 0.25,
    shadowRadius: 10,
    elevation: 10,
  },
  modalTitle: {
    fontSize: 20,
    fontWeight: 'bold',
    textAlign: 'center',
  },
  modalText: {
    fontSize: 15,
    lineHeight: 22,
    textAlign: 'center',
  },
  modalButton: {
    marginTop: 24,
    paddingVertical: 12,
    borderRadius: 12,
    alignItems: 'center',
    borderWidth: 1,
    borderColor: 'transparent',
  },
  modalButtonText: {
    color: '#fff',
    fontSize: 16,
    fontWeight: 'bold',
  },
  welcomeText: {
    fontSize: 14,
  },
  headerTitle: {
    fontSize: 28,
    fontWeight: 'bold',
  },
  nameText: {
    fontSize: 28,
    fontWeight: 'bold',
    textTransform: 'capitalize',
  },
  iconBtn: {
    width: 44,
    height: 44,
    borderRadius: 22,
    justifyContent: 'center',
    alignItems: 'center',
    borderWidth: 1,
  },

  profileCard: {
    borderRadius: 16,
    padding: 16,
    flexDirection: 'row',
    alignItems: 'flex-start',
    marginBottom: 16,
    overflow: 'hidden', // Fix for Android BlurView border radius
  },
  profileImage: {
    width: 60,
    height: 60,
    borderRadius: 30,
    borderWidth: 2,
  },
  profileInfo: {
    marginLeft: 14,
    flex: 1,
  },
  profileName: {
    fontSize: 18,
    fontWeight: 'bold',
    textTransform: 'capitalize',
  },
  profileDept: {
    fontSize: 13,
    marginBottom: 8,
  },
  badgesRow: {
    flexDirection: 'row',
  },
  badge: {
    paddingHorizontal: 10,
    paddingVertical: 4,
    borderRadius: 12,
    marginRight: 8,
  },
  badgeText: {
    fontSize: 11,
    fontWeight: '500',
  },
  statsRow: {
    flexDirection: 'row',
    marginBottom: 12,
    gap: 12,
  },
  statCard: {
    flex: 1,
    borderRadius: 16,
    padding: 16,
    height: 115,
    justifyContent: 'space-between',
    overflow: 'hidden', // Fix for Android BlurView border radius
  },
  statHeader: {
    flexDirection: 'row',
    alignItems: 'center',
    marginBottom: 8,
  },
  statLabel: {
    fontSize: 11,
    fontWeight: '600',
  },
  statValue: {
    fontSize: 36,
    fontWeight: 'bold',
  },
  statSubtext: {
    fontSize: 12,
    marginTop: 4,
  },
  sectionHeader: {
    flexDirection: 'row',
    justifyContent: 'space-between',
    alignItems: 'center',
    marginBottom: 16,
  },
  sectionTitle: {
    fontSize: 20,
    fontWeight: '600',
  },
  subjectCard: {
    borderRadius: 16,
    padding: 16,
    flexDirection: 'row',
    alignItems: 'center',
    marginBottom: 12,
    overflow: 'hidden', // Fix for Android BlurView border radius
  },
  subjectContent: {
    flex: 1,
  },
  subjectName: {
    fontSize: 17,
    fontWeight: 'bold',
    marginBottom: 2,
  },
  subjectDetails: {
    fontSize: 13,
    marginBottom: 8,
  },
  statusBadge: {
    alignSelf: 'flex-start',
    paddingHorizontal: 10,
    paddingVertical: 4,
    borderRadius: 10,
  },
  statusText: {
    fontSize: 12,
    fontWeight: '600',
  },
  circleOuter: {
    borderRadius: 30,
    borderWidth: 4,
    justifyContent: 'center',
    alignItems: 'center',
  },
  circleInner: {
    borderRadius: 26,
    borderWidth: 3,
    justifyContent: 'center',
    alignItems: 'center',
  },
  circleText: {
    fontSize: 12,
    fontWeight: 'bold',
  },
  gridContainer: {
    flexDirection: 'row',
    justifyContent: 'space-between',
    gap: 12,
  },
  gridItem: {
    flex: 1,
  },
  gridCard: {
    borderRadius: 16,
    padding: 16,
    width: '100%',
    alignItems: 'flex-start',
    height: 115,
    justifyContent: 'space-between',
    overflow: 'hidden', // Fix for Android BlurView border radius
  },
  gridIcon: {
    width: 36,
    height: 36,
    borderRadius: 18,
    justifyContent: 'center',
    alignItems: 'center',
    marginBottom: 8,
  },
  gridTitle: {
    fontSize: 16,
    fontWeight: 'bold',
    marginBottom: 4,
  },
  gridSubtitle: {
    fontSize: 12,
  },
});


=======================================================
FILE: app\(tabs)\predict.tsx
=======================================================

import { useTheme } from '@/context/ThemeContext';
import { Ionicons } from '@expo/vector-icons';
import * as Haptics from 'expo-haptics';
import React, { useEffect, useState } from 'react';
import { ScrollView, StyleSheet, Text, View } from 'react-native';
import { Slider as AwesomeSlider } from 'react-native-awesome-slider';
import Animated, { FadeInDown, useAnimatedStyle, useSharedValue, withSpring } from 'react-native-reanimated';
import { useSafeAreaInsets } from 'react-native-safe-area-context';
import DonutChart from '../../components/DonutChart';
import { ScalePressable } from '../../components/ScalePressable';
import { SkeletonLoader } from '../../components/SkeletonLoader';
import { AnalyticsService } from '../../services/analytics';
import { AttendanceService } from '../../services/attendance';

// ... imports
import { SmartBunkPlanner } from '../../components/SmartBunkPlanner';

const PredictSkeleton = ({ colors, insets }: { colors: any; insets: any }) => (
    <View style={[styles.container, { backgroundColor: colors.background, paddingTop: insets.top }]}>
        {/* Header */}
        <View style={styles.header}>
            <SkeletonLoader width={200} height={28} borderRadius={8} />
        </View>

        <View style={styles.content}>
            {/* Current Status Card */}
            <View style={[styles.card, { backgroundColor: colors.card, padding: 20, marginBottom: 24 }]}>
                <SkeletonLoader width={120} height={13} borderRadius={4} style={{ marginBottom: 16 }} />
                <View style={{ flexDirection: 'row', alignItems: 'center', justifyContent: 'space-around' }}>
                    {/* Donut chart placeholder */}
                    <SkeletonLoader width={100} height={100} borderRadius={50} />
                    {/* Stats */}
                    <View style={{ justifyContent: 'center' }}>
                        <SkeletonLoader width={100} height={24} borderRadius={6} />
                        <SkeletonLoader width={120} height={14} borderRadius={4} style={{ marginTop: 8 }} />
                        <SkeletonLoader width={90} height={24} borderRadius={12} style={{ marginTop: 10 }} />
                    </View>
                </View>
            </View>

            {/* Tab Switcher */}
            <View style={{ flexDirection: 'row', marginBottom: 20, backgroundColor: colors.card, borderRadius: 12, padding: 4 }}>
                <SkeletonLoader width="48%" height={36} borderRadius={8} style={{ marginRight: '4%' }} />
                <SkeletonLoader width="48%" height={36} borderRadius={8} />
            </View>

            {/* Section Title */}
            <SkeletonLoader width={130} height={13} borderRadius={4} style={{ marginBottom: 16 }} />

            {/* Content Card */}
            <View style={[styles.card, { backgroundColor: colors.card, padding: 20 }]}>
                {/* Calendar grid placeholder */}
                <SkeletonLoader width="100%" height={40} borderRadius={8} style={{ marginBottom: 12 }} />
                <View style={{ flexDirection: 'row', justifyContent: 'space-between', marginBottom: 12 }}>
                    {[1, 2, 3, 4, 5, 6, 7].map(i => (
                        <SkeletonLoader key={i} width={36} height={36} borderRadius={8} />
                    ))}
                </View>
                <View style={{ flexDirection: 'row', justifyContent: 'space-between', marginBottom: 12 }}>
                    {[1, 2, 3, 4, 5, 6, 7].map(i => (
                        <SkeletonLoader key={i} width={36} height={36} borderRadius={8} />
                    ))}
                </View>
                <View style={{ flexDirection: 'row', justifyContent: 'space-between', marginBottom: 12 }}>
                    {[1, 2, 3, 4, 5, 6, 7].map(i => (
                        <SkeletonLoader key={i} width={36} height={36} borderRadius={8} />
                    ))}
                </View>
                <View style={{ flexDirection: 'row', justifyContent: 'space-between' }}>
                    {[1, 2, 3, 4, 5, 6, 7].map(i => (
                        <SkeletonLoader key={i} width={36} height={36} borderRadius={8} />
                    ))}
                </View>
            </View>
        </View>
    </View>
);

export default function PredictScreen() {
    const insets = useSafeAreaInsets();
    const { colors } = useTheme();

    const [loading, setLoading] = useState(true);
    const [stats, setStats] = useState({ attended: 0, total: 0, percentage: 0 });
    const [viewMode, setViewMode] = useState<'basic' | 'calendar'>('calendar'); // Default to calendar

    // Existing "Basic" state
    const [predictMode, setPredictMode] = useState<'attend' | 'miss'>('miss');
    const [predictionCount, setPredictionCount] = useState(1);

    // Animation state for "Attend/Miss" tabs
    const [layoutWidth, setLayoutWidth] = useState(0);
    const translateX = useSharedValue(0);

    // Shared values for slider
    const progress = useSharedValue(1);
    const min = useSharedValue(1);
    const max = useSharedValue(20);

    const pillStyle = useAnimatedStyle(() => {
        return {
            transform: [{ translateX: translateX.value }]
        };
    });

    useEffect(() => {
        if (layoutWidth > 0) {
            translateX.value = withSpring(predictMode === 'attend' ? 0 : (layoutWidth - 8) / 2);
        }
    }, [predictMode, layoutWidth, translateX]);

    useEffect(() => {
        loadData();
    }, []);

    const loadData = async () => {
        try {
            const summaryData = await AttendanceService.getAttendance();
            if (summaryData) {
                setStats({
                    attended: summaryData.semesterTotal.attended,
                    total: summaryData.semesterTotal.total,
                    percentage: summaryData.overallPercentage
                });
            }
        } catch {
        } finally {
            setLoading(false);
        }
    };

    const currentPredicted = AnalyticsService.predictFuture(
        stats.attended,
        stats.total,
        predictMode === 'attend' ? predictionCount : 0,
        predictMode === 'miss' ? predictionCount : 0
    );

    const diff = predictMode === 'attend'
        ? (currentPredicted - stats.percentage).toFixed(1)
        : (stats.percentage - currentPredicted).toFixed(1);

    if (loading) {
        return <PredictSkeleton colors={colors} insets={insets} />;
    }

    return (
        <View style={[styles.container, { backgroundColor: colors.background, paddingTop: insets.top }]}>
            <Animated.View entering={FadeInDown.delay(100).springify()} style={styles.header}>
                <Text style={[styles.title, { color: colors.text }]}>Attendance Goals üéØ</Text>
            </Animated.View>

            <ScrollView contentContainerStyle={styles.content}>
                {/* Current Stats */}
                <Animated.View
                    entering={FadeInDown.delay(200).springify()}
                    style={[styles.card, { backgroundColor: colors.card, padding: 20, marginBottom: 24 }]}
                >
                    <Text style={{ color: colors.textSecondary, fontSize: 13, marginBottom: 16, fontWeight: '600' }}>CURRENT STATUS</Text>
                    <View style={{ flexDirection: 'row', alignItems: 'center', justifyContent: 'space-around' }}>
                        <DonutChart percentage={stats.percentage} radius={50} strokeWidth={10} color={stats.percentage >= 75 ? colors.success : colors.primary} />
                        <View style={{ marginLeft: 0, justifyContent: 'center' }}>
                            <Text style={{ fontSize: 24, fontWeight: 'bold', color: colors.text }}>
                                {stats.attended} <Text style={{ fontSize: 16, color: colors.textSecondary }}>/ {stats.total}</Text>
                            </Text>
                            <Text style={{ fontSize: 14, color: colors.textSecondary, marginBottom: 8 }}>Classes Attended</Text>

                            <View style={{
                                backgroundColor: stats.percentage >= 75 ? (colors.success + '20') : ((colors.error || '#FF5252') + '20'),
                                paddingHorizontal: 10,
                                paddingVertical: 4,
                                borderRadius: 12,
                                alignSelf: 'flex-start'
                            }}>
                                <Text style={{ fontSize: 12, fontWeight: 'bold', color: stats.percentage >= 75 ? colors.success : (colors.error || '#FF5252') }}>
                                    {stats.percentage >= 75 ? 'On Track üöÄ' : 'Risk Zone ‚ö†Ô∏è'}
                                </Text>
                            </View>
                        </View>
                    </View>
                </Animated.View>

                {/* Main Feature Switcher */}
                <View style={{ flexDirection: 'row', marginBottom: 20, backgroundColor: colors.card, borderRadius: 12, padding: 4 }}>
                    <ScalePressable
                        onPress={() => { setViewMode('calendar'); Haptics.selectionAsync(); }}
                        style={{ flex: 1, paddingVertical: 8, alignItems: 'center', borderRadius: 8, backgroundColor: viewMode === 'calendar' ? colors.primary : 'transparent' }}
                    >
                        <Text style={{ fontWeight: '600', color: viewMode === 'calendar' ? '#fff' : colors.textSecondary }}>Smart Planner</Text>
                    </ScalePressable>
                    <ScalePressable
                        onPress={() => { setViewMode('basic'); Haptics.selectionAsync(); }}
                        style={{ flex: 1, paddingVertical: 8, alignItems: 'center', borderRadius: 8, backgroundColor: viewMode === 'basic' ? colors.primary : 'transparent' }}
                    >
                        <Text style={{ fontWeight: '600', color: viewMode === 'basic' ? '#fff' : colors.textSecondary }}>Calculator</Text>
                    </ScalePressable>
                </View>

                {viewMode === 'basic' ? (
                    /* Crystal Ball (Existing) */
                    <Animated.View entering={FadeInDown.springify()}>
                        <Text style={[styles.sectionTitle, { color: colors.textSecondary }]}>CRYSTAL BALL</Text>
                        <View style={[styles.card, { backgroundColor: colors.card, padding: 20 }]}>
                            {/* Mode Switch */}
                            <View
                                onLayout={(e) => setLayoutWidth(e.nativeEvent.layout.width)}
                                style={{
                                    flexDirection: 'row',
                                    backgroundColor: colors.background,
                                    borderRadius: 12,
                                    padding: 4,
                                    marginBottom: 24,
                                    position: 'relative'
                                }}
                            >
                                <Animated.View style={[{
                                    position: 'absolute',
                                    top: 4,
                                    bottom: 4,
                                    left: 4,
                                    width: layoutWidth > 0 ? (layoutWidth - 8) / 2 : '50%',
                                    borderRadius: 8,
                                    backgroundColor: predictMode === 'attend' ? colors.primary : (colors.error || '#FF5252'),
                                    shadowColor: "#000",
                                    shadowOffset: { width: 0, height: 1 },
                                    shadowOpacity: 0.1,
                                    shadowRadius: 2,
                                    elevation: 2,
                                }, pillStyle]} />

                                <ScalePressable
                                    onPress={() => { setPredictMode('attend'); Haptics.selectionAsync(); }}
                                    style={styles.tabButton}
                                >
                                    <Text style={{ fontWeight: '600', color: predictMode === 'attend' ? '#FFF' : colors.textSecondary }}>If I Attend</Text>
                                </ScalePressable>
                                <ScalePressable
                                    onPress={() => { setPredictMode('miss'); Haptics.selectionAsync(); }}
                                    style={styles.tabButton}
                                >
                                    <Text style={{ fontWeight: '600', color: predictMode === 'miss' ? '#FFF' : colors.textSecondary }}>If I Miss</Text>
                                </ScalePressable>
                            </View>

                            {/* Slider Controls */}
                            <View style={{ alignItems: 'center', marginBottom: 20 }}>
                                <View style={{ flexDirection: 'row', alignItems: 'baseline', marginBottom: 20 }}>
                                    <Text style={{ fontSize: 40, fontWeight: 'bold', color: colors.text }}>{predictionCount}</Text>
                                    <Text style={{ fontSize: 16, color: colors.textSecondary, marginLeft: 6 }}>
                                        Next {predictionCount === 1 ? 'Class' : 'Classes'}
                                    </Text>
                                </View>

                                <View style={{ width: '100%', height: 40, justifyContent: 'center' }}>
                                    <AwesomeSlider
                                        style={{ width: '100%', height: 40 }}
                                        progress={progress}
                                        minimumValue={min}
                                        maximumValue={max}
                                        step={1}
                                        onValueChange={(val: number) => {
                                            const discrete = Math.round(val);
                                            if (discrete !== predictionCount) {
                                                setPredictionCount(discrete);
                                                Haptics.selectionAsync();
                                            }
                                        }}
                                        onHapticFeedback={() => Haptics.impactAsync(Haptics.ImpactFeedbackStyle.Light)}
                                        theme={{
                                            disableMinTrackTintColor: colors.cardBorder || '#E0E0E0',
                                            maximumTrackTintColor: colors.cardBorder || '#E0E0E0',
                                            minimumTrackTintColor: predictMode === 'attend' ? colors.primary : (colors.error || '#FF5252'),
                                            cacheTrackTintColor: '#0000',
                                            bubbleBackgroundColor: '#0000',
                                            heartbeatColor: predictMode === 'attend' ? colors.primary : (colors.error || '#FF5252'),
                                        }}
                                        thumbWidth={16}
                                        renderBubble={() => null}
                                    />
                                </View>

                                <View style={{ flexDirection: 'row', justifyContent: 'space-between', width: '100%', paddingHorizontal: 0, marginTop: 4 }}>
                                    <Text style={{ fontSize: 12, color: colors.textSecondary }}>1</Text>
                                    <Text style={{ fontSize: 12, color: colors.textSecondary }}>20</Text>
                                </View>
                            </View>

                            {/* Result */}
                            <View style={{ alignItems: 'center', padding: 20, backgroundColor: colors.background, borderRadius: 16 }}>
                                <Text style={{ color: colors.textSecondary, fontSize: 13, marginBottom: 8, fontWeight: '600', letterSpacing: 0.5 }}>NEW PERCENTAGE</Text>
                                <Text style={{ fontSize: 42, fontWeight: 'bold', color: predictMode === 'attend' ? colors.success : (colors.error || '#FF5252') }}>
                                    {currentPredicted.toFixed(1)}%
                                </Text>
                                <View style={{ flexDirection: 'row', alignItems: 'center', marginTop: 8, backgroundColor: predictMode === 'attend' ? colors.success + '20' : (colors.error || '#FF5252') + '20', paddingHorizontal: 12, paddingVertical: 6, borderRadius: 20 }}>
                                    <Ionicons name={predictMode === 'attend' ? "trending-up" : "trending-down"} size={16} color={predictMode === 'attend' ? colors.success : (colors.error || '#FF5252')} />
                                    <Text style={{ fontSize: 14, fontWeight: '700', color: predictMode === 'attend' ? colors.success : (colors.error || '#FF5252'), marginLeft: 6 }}>
                                        {predictMode === 'attend' ? `+${diff}%` : `-${diff}%`}
                                    </Text>
                                </View>
                            </View>
                        </View>
                    </Animated.View>
                ) : (
                    /* Smart Bunk Planner (New) */
                    <Animated.View entering={FadeInDown.springify()}>
                        <Text style={[styles.sectionTitle, { color: colors.textSecondary }]}>PLAN MY BUNKS</Text>
                        <SmartBunkPlanner
                            currentAttended={stats.attended}
                            currentTotal={stats.total}
                            currentPercentage={stats.percentage}
                            colors={colors}
                        />
                    </Animated.View>
                )}
            </ScrollView>
        </View>
    );
}

const styles = StyleSheet.create({
    container: { flex: 1 },
    header: { paddingHorizontal: 20, paddingBottom: 16, paddingTop: 10 },
    title: { fontSize: 24, fontWeight: 'bold' },
    content: { padding: 20, paddingBottom: 100 },
    card: { borderRadius: 24, marginBottom: 24 },
    sectionTitle: { fontSize: 13, fontWeight: '700', marginBottom: 16, letterSpacing: 0.5 },
    tabButton: { flex: 1, paddingVertical: 10, alignItems: 'center', borderRadius: 8, zIndex: 1 }
});


=======================================================
FILE: app\(tabs)\_layout.tsx
=======================================================

import { Tabs } from 'expo-router';
import React from 'react';

import { AnimatedTabBar } from '@/components/animated-tab-bar';
import ResultsOverlay from '@/components/ResultsOverlay';

export default function TabLayout() {
  return (
    <>
      <Tabs
        screenOptions={{
          headerShown: false,
          tabBarStyle: {
            position: 'absolute',
            backgroundColor: 'transparent',
            borderTopWidth: 0,
            elevation: 0,
          },
        }}
        tabBar={(props) => <AnimatedTabBar {...props} />}
      >
        <Tabs.Screen
          name="index"
          options={{
            title: 'Home',
          }}
        />
        <Tabs.Screen
          name="explore"
          options={{
            title: 'Date-wise',
          }}
        />
        <Tabs.Screen
          name="predict"
          options={{
            title: 'Goals',
          }}
        />
      </Tabs>
      <ResultsOverlay />
    </>
  );
}


=======================================================
FILE: app\+not-found.tsx
=======================================================

import { Link, Stack } from 'expo-router';
import { StyleSheet, Text, View } from 'react-native';

export default function NotFoundScreen() {
    return (
        <>
            <Stack.Screen options={{ title: 'Oops!' }} />
            <View style={styles.container}>
                <Text style={styles.title}>This screen doesn&apos;t exist.</Text>
                <Link href="/" style={styles.link}>
                    <Text style={styles.linkText}>Go to home screen!</Text>
                </Link>
            </View>
        </>
    );
}

const styles = StyleSheet.create({
    container: {
        flex: 1,
        alignItems: 'center',
        justifyContent: 'center',
        padding: 20,
    },
    title: {
        fontSize: 20,
        fontWeight: 'bold',
    },
    link: {
        marginTop: 15,
        paddingVertical: 15,
    },
    linkText: {
        fontSize: 14,
        color: '#2e78b7',
    },
});


=======================================================
FILE: app\fee-receipts.tsx
=======================================================

import { useTheme } from '@/context/ThemeContext';
import { Ionicons } from '@expo/vector-icons';
import { LinearGradient } from 'expo-linear-gradient';
import { Stack, useRouter } from 'expo-router';
import React, { useCallback, useEffect, useState } from 'react';
import { Alert, FlatList, RefreshControl, StyleSheet, Text, TouchableOpacity, View } from 'react-native';
import Animated, { FadeInDown, FadeInRight } from 'react-native-reanimated';
import { FeeReceipt, FeeService } from '../services/FeeService';

// Skeleton Loader Component
const SkeletonLoader = ({ colors, isDark }: { colors: any; isDark: boolean }) => (
    <View style={{ paddingHorizontal: 20, marginTop: 10 }}>
        {[1, 2, 3].map((key) => (
            <View
                key={key}
                style={[
                    styles.card,
                    {
                        backgroundColor: colors.card,
                        padding: 20,
                        marginBottom: 16,
                    }
                ]}
            >
                {/* Header skeleton */}
                <View style={{ flexDirection: 'row', alignItems: 'center', marginBottom: 16 }}>
                    {/* Icon circle */}
                    <View style={[styles.skeletonLine, {
                        width: 48,
                        height: 48,
                        borderRadius: 24,
                        marginRight: 15,
                        backgroundColor: isDark ? 'rgba(255,255,255,0.1)' : '#e2e8f0'
                    }]} />
                    {/* Text lines */}
                    <View style={{ flex: 1 }}>
                        <View style={[styles.skeletonLine, { width: '60%', height: 16, marginBottom: 8, backgroundColor: isDark ? 'rgba(255,255,255,0.1)' : '#e2e8f0' }]} />
                        <View style={[styles.skeletonLine, { width: '40%', height: 12, backgroundColor: isDark ? 'rgba(255,255,255,0.08)' : '#f1f5f9' }]} />
                    </View>
                    {/* Badge */}
                    <View style={[styles.skeletonLine, { width: 50, height: 24, borderRadius: 12, backgroundColor: isDark ? 'rgba(255,255,255,0.08)' : '#f1f5f9' }]} />
                </View>
                {/* Separator */}
                <View style={{ height: 1, backgroundColor: colors.cardBorder, marginBottom: 16 }} />
                {/* Footer skeleton */}
                <View style={{ flexDirection: 'row', justifyContent: 'space-between', alignItems: 'center' }}>
                    <View>
                        <View style={[styles.skeletonLine, { width: 70, height: 10, marginBottom: 6, backgroundColor: isDark ? 'rgba(255,255,255,0.08)' : '#f1f5f9' }]} />
                        <View style={[styles.skeletonLine, { width: 120, height: 14, backgroundColor: isDark ? 'rgba(255,255,255,0.1)' : '#e2e8f0' }]} />
                    </View>
                    <View style={[styles.skeletonLine, { width: 80, height: 22, borderRadius: 4, backgroundColor: isDark ? 'rgba(255,255,255,0.1)' : '#e2e8f0' }]} />
                </View>
            </View>
        ))}
    </View>
);

export default function FeeReceiptsScreen() {
    const router = useRouter();
    const { colors, isDark } = useTheme();
    const [receipts, setReceipts] = useState<FeeReceipt[]>([]);
    const [loading, setLoading] = useState(true);
    const [refreshing, setRefreshing] = useState(false);
    const [years, setYears] = useState<string[]>([]);
    const [selectedYear, setSelectedYear] = useState<string>('');

    const fetchYears = useCallback(async () => {
        try {
            const fetchedYears = await FeeService.getAcademicYears();
            setYears(fetchedYears);
            // Use functional update to avoid dependency on selectedYear
            if (fetchedYears.length > 0) {
                setSelectedYear(prev => prev || fetchedYears[0]);
            } else if (fetchedYears.length === 0) {
                setLoading(false);
            }
        } catch {
            Alert.alert('Error', 'Failed to load academic years');
            setLoading(false);
        }
    }, []);

    const fetchReceipts = useCallback(async (year: string) => {
        if (!year) return;
        setLoading(true);
        try {
            const data = await FeeService.getReceipts(year);
            setReceipts(data);
        } catch {
            Alert.alert('Error', 'Failed to load fee receipts');
        } finally {
            setLoading(false);
            setRefreshing(false);
        }
    }, []);

    useEffect(() => {
        fetchYears();
    }, [fetchYears]);

    useEffect(() => {
        if (selectedYear) {
            fetchReceipts(selectedYear);
        }
    }, [selectedYear, fetchReceipts]);

    const onRefresh = () => {
        setRefreshing(true);
        fetchYears();
    };

    // Calculate Total Paid
    const totalPaid = receipts.reduce((sum, item) => {
        // Clean string "‚Çπ45,000.00" -> 45000.00
        const amountStr = item.amount.replace(/[^0-9.]/g, '');
        const amount = parseFloat(amountStr) || 0;
        return sum + amount;
    }, 0);

    const formatCurrency = (amount: number) => {
        return '‚Çπ' + amount.toLocaleString('en-IN', { minimumFractionDigits: 2 });
    };

    const renderItem = ({ item, index }: { item: FeeReceipt; index: number }) => (
        <Animated.View
            entering={FadeInDown.delay(index * 100).springify()}
            style={[styles.card, { backgroundColor: colors.card, shadowColor: isDark ? '#000' : '#888' }]}
        >
            <View style={styles.cardHeader}>
                <View style={[styles.iconContainer, { backgroundColor: colors.primary + '20' }]}>
                    <Ionicons name="receipt-outline" size={24} color={colors.primary} />
                </View>
                <View style={styles.headerTextContainer}>
                    <Text style={[styles.receiptNo, { color: colors.text }]}>Receipt #{item.receiptNo}</Text>
                    <Text style={[styles.date, { color: colors.textSecondary }]}>{item.date}</Text>
                </View>
                {/* Status Badge */}
                <View style={[styles.statusBadge, { backgroundColor: colors.success + '20' }]}>
                    <Text style={[styles.statusText, { color: colors.success }]}>PAID</Text>
                </View>
            </View>

            <View style={[styles.separator, { backgroundColor: colors.cardBorder }]} />
            <View style={styles.cardFooter}>
                <View style={styles.footerContent}>
                    <Text style={[styles.descriptionLabel, { color: colors.textSecondary }]}>Payment For</Text>
                    <Text style={[styles.description, { color: colors.text }]}>{item.description}</Text>
                </View>
                <Text style={[styles.amount, { color: colors.primary }]}>{item.amount}</Text>
            </View>
        </Animated.View>
    );

    return (
        <View style={[styles.container, { backgroundColor: colors.background }]}>
            <Stack.Screen options={{ headerShown: false }} />
            <LinearGradient
                colors={isDark ? [colors.background, '#1a1a2e'] : ['#e0eafc', '#cfdef3']}
                style={styles.background}
            />

            <View style={styles.header}>
                <TouchableOpacity onPress={() => router.back()} style={styles.backButton}>
                    <View style={[styles.backButtonCircle, { backgroundColor: colors.card, borderColor: colors.cardBorder }]}>
                        <Ionicons name="arrow-back" size={24} color={colors.text} />
                    </View>
                </TouchableOpacity>
                <Text style={[styles.headerTitle, { color: colors.text }]}>Fee Receipts</Text>
            </View>

            {/* Academic Year Selector */}
            <View style={styles.yearSelectorContainer}>
                <FlatList
                    horizontal
                    showsHorizontalScrollIndicator={false}
                    data={years}
                    keyExtractor={(item) => item}
                    contentContainerStyle={styles.yearListContent}
                    renderItem={({ item, index }) => (
                        <TouchableOpacity
                            onPress={() => setSelectedYear(item)}
                        >
                            <Animated.View
                                entering={FadeInRight.delay(index * 100)}
                                style={[
                                    styles.yearChip,
                                    { backgroundColor: isDark ? 'rgba(255,255,255,0.1)' : 'rgba(255,255,255,0.7)', borderColor: isDark ? 'rgba(255,255,255,0.2)' : 'rgba(255,255,255,0.9)' },
                                    selectedYear === item && { backgroundColor: colors.primary, borderColor: colors.primary },
                                ]}
                            >
                                <Text
                                    style={[
                                        styles.yearText,
                                        { color: colors.textSecondary },
                                        selectedYear === item && styles.yearTextSelected,
                                    ]}
                                >
                                    {item}
                                </Text>
                            </Animated.View>
                        </TouchableOpacity>
                    )}
                />
            </View>

            {/* Total Summary Card */}
            {!loading && receipts.length > 0 && (
                <Animated.View entering={FadeInDown.duration(600)} style={[styles.summaryCard, { shadowColor: colors.primary }]}>
                    <LinearGradient
                        colors={isDark ? [colors.primary, '#3730a3'] : ['#4361ee', '#3f37c9']}
                        start={{ x: 0, y: 0 }}
                        end={{ x: 1, y: 1 }}
                        style={styles.summaryGradient}
                    >
                        <View>
                            <Text style={styles.summaryLabel}>Total Paid ({selectedYear})</Text>
                            <Text style={styles.summaryAmount}>{formatCurrency(totalPaid)}</Text>
                        </View>
                        <View style={styles.summaryIcon}>
                            <Ionicons name="wallet-outline" size={32} color="rgba(255,255,255,0.8)" />
                        </View>
                    </LinearGradient>
                </Animated.View>
            )}

            {loading ? (
                <SkeletonLoader colors={colors} isDark={isDark} />
            ) : receipts.length === 0 ? (
                <View style={styles.center}>
                    <Ionicons name="document-text-outline" size={80} color={colors.textSecondary} />
                    <Text style={[styles.emptyText, { color: colors.text }]}>No receipts found</Text>
                    <Text style={[styles.emptySubText, { color: colors.textSecondary }]}>Select a different year or pull to refresh</Text>
                </View>
            ) : (
                <FlatList
                    data={receipts}
                    renderItem={renderItem}
                    keyExtractor={(item) => item.id}
                    contentContainerStyle={styles.listContent}
                    showsVerticalScrollIndicator={false}
                    refreshControl={
                        <RefreshControl
                            refreshing={refreshing}
                            onRefresh={onRefresh}
                            colors={[colors.primary]}
                            tintColor={colors.primary}
                        />
                    }
                />
            )}
        </View>
    );
}

const styles = StyleSheet.create({
    container: {
        flex: 1,
        paddingTop: 50,
    },
    background: {
        position: 'absolute',
        left: 0,
        right: 0,
        top: 0,
        bottom: 0,
    },
    header: {
        flexDirection: 'row',
        alignItems: 'center',
        paddingHorizontal: 20,
        marginBottom: 15,
        zIndex: 10,
    },
    backButton: {
        marginRight: 15,
    },
    backButtonCircle: {
        backgroundColor: 'rgba(255,255,255,0.6)',
        width: 40,
        height: 40,
        borderRadius: 20,
        justifyContent: 'center',
        alignItems: 'center',
    },
    headerTitle: {
        fontSize: 28,
        fontWeight: '800',
        color: '#1e293b',
        letterSpacing: -0.5,
    },
    yearSelectorContainer: {
        marginBottom: 20,
        height: 45,
    },
    yearListContent: {
        paddingHorizontal: 20,
        alignItems: 'center',
    },
    yearChip: {
        paddingHorizontal: 20,
        paddingVertical: 10,
        borderRadius: 25,
        backgroundColor: 'rgba(255,255,255,0.7)',
        marginRight: 10,
        borderWidth: 1,
        borderColor: 'rgba(255,255,255,0.9)',
    },
    yearChipSelected: {
        backgroundColor: '#4361ee',
        borderColor: '#4361ee',
        shadowColor: '#4361ee',
        shadowOffset: { width: 0, height: 4 },
        shadowOpacity: 0.3,
        shadowRadius: 8,
        elevation: 5,
    },
    yearText: {
        color: '#64748b',
        fontWeight: '600',
        fontSize: 14,
    },
    yearTextSelected: {
        color: '#fff',
        fontWeight: '700',
    },
    center: {
        flex: 1,
        justifyContent: 'center',
        alignItems: 'center',
        minHeight: 300,
    },
    listContent: {
        paddingHorizontal: 20,
        paddingBottom: 40,
    },
    card: {
        backgroundColor: '#fff',
        borderRadius: 20,
        padding: 20,
        marginBottom: 16,
        shadowColor: '#64748b',
        shadowOffset: { width: 0, height: 8 },
        shadowOpacity: 0.08,
        shadowRadius: 12,
        elevation: 3,
        position: 'relative',
        overflow: 'hidden',
    },
    cardHeader: {
        flexDirection: 'row',
        alignItems: 'center',
        marginBottom: 8, // Reduced margin
    },
    iconContainer: {
        width: 48,
        height: 48,
        borderRadius: 24,
        backgroundColor: '#eff6ff',
        justifyContent: 'center',
        alignItems: 'center',
        marginRight: 15,
    },
    headerTextContainer: {
        flex: 1,
    },
    receiptNo: {
        fontSize: 16,
        fontWeight: '700',
        color: '#1e293b',
        marginBottom: 2,
    },
    date: {
        fontSize: 13,
        color: '#94a3b8',
        fontWeight: '500',
    },
    separator: {
        height: 1,
        backgroundColor: '#f1f5f9',
        marginBottom: 15,
    },
    cardFooter: {
        flexDirection: 'row',
        justifyContent: 'space-between',
        alignItems: 'center',
    },
    footerContent: {
        flex: 1,
    },
    descriptionLabel: {
        fontSize: 11,
        textTransform: 'uppercase',
        color: '#94a3b8',
        fontWeight: '700',
        marginBottom: 4,
        letterSpacing: 0.5,
    },
    description: {
        fontSize: 15,
        color: '#334155',
        fontWeight: '600',
    },
    amount: {
        fontSize: 22,
        fontWeight: '800',
        color: '#4361ee',
    },
    statusBadge: {
        // No absolute positioning, flow naturally in header or separate
        backgroundColor: '#dcfce7',
        paddingVertical: 4,
        paddingHorizontal: 12,
        borderRadius: 12,
        marginLeft: 10,
    },
    statusText: {
        color: '#16a34a',
        fontSize: 11,
        fontWeight: '800',
        letterSpacing: 0.5,
    },
    emptyText: {
        fontSize: 20,
        color: '#334155',
        fontWeight: '700',
        marginTop: 20,
    },
    emptySubText: {
        fontSize: 14,
        color: '#94a3b8',
        marginTop: 8,
    },

    // Summary Card Styles
    summaryCard: {
        marginHorizontal: 20,
        marginBottom: 20,
        borderRadius: 20,
        shadowColor: '#4361ee',
        shadowOffset: { width: 0, height: 10 },
        shadowOpacity: 0.25,
        shadowRadius: 15,
        elevation: 10,
    },
    summaryGradient: {
        padding: 20,
        borderRadius: 20,
        flexDirection: 'row',
        justifyContent: 'space-between',
        alignItems: 'center',
    },
    summaryLabel: {
        color: 'rgba(255,255,255,0.8)',
        fontSize: 14,
        fontWeight: '600',
        marginBottom: 4,
    },
    summaryAmount: {
        color: '#fff',
        fontSize: 28,
        fontWeight: '800',
    },
    summaryIcon: {
        width: 50,
        height: 50,
        borderRadius: 25,
        backgroundColor: 'rgba(255,255,255,0.2)',
        justifyContent: 'center',
        alignItems: 'center',
    },

    // Skeleton Styles
    skeletonCard: {
        backgroundColor: 'rgba(255,255,255,0.6)',
    },
    skeletonLine: {
        backgroundColor: '#e2e8f0',
        borderRadius: 4,
    },
});


=======================================================
FILE: app\index.tsx
=======================================================

import { AuthService } from '@/services/auth';
import AsyncStorage from '@react-native-async-storage/async-storage';
import { Redirect } from 'expo-router';
import React, { useEffect, useState } from 'react';
import { ActivityIndicator, View } from 'react-native';

const ONBOARDING_KEY = 'has_seen_onboarding';

export default function Index() {
    const [isLoading, setIsLoading] = useState(true);
    const [isLoggedIn, setIsLoggedIn] = useState(false);
    const [needsOnboarding, setNeedsOnboarding] = useState(false);

    useEffect(() => {
        checkStatus();
    }, []);

    const checkStatus = async () => {
        try {
            // Check onboarding first
            const hasSeenOnboarding = await AsyncStorage.getItem(ONBOARDING_KEY);

            if (hasSeenOnboarding !== 'true') {
                setNeedsOnboarding(true);
                setIsLoading(false);
                return;
            }



            // Then check login
            const loggedIn = await AuthService.isLoggedIn();
            setIsLoggedIn(loggedIn);
        } catch {
            setIsLoggedIn(false);
        } finally {
            setIsLoading(false);
        }
    };

    if (isLoading) {
        return (
            <View style={{ flex: 1, justifyContent: 'center', alignItems: 'center', backgroundColor: '#0f172a' }}>
                <ActivityIndicator size="large" color="#3b82f6" />
            </View>
        );
    }

    if (needsOnboarding) {
        return <Redirect href="/onboarding" />;
    }

    if (isLoggedIn) {
        return <Redirect href="/(tabs)" />;
    }

    return <Redirect href="/login" />;
}



=======================================================
FILE: app\login.tsx
=======================================================

import { useTheme } from '@/context/ThemeContext';
import { Ionicons } from '@expo/vector-icons';
import { BlurView } from 'expo-blur';
import * as Haptics from 'expo-haptics';
import { LinearGradient } from 'expo-linear-gradient';
import { Stack, useRouter } from 'expo-router';
import { StatusBar } from 'expo-status-bar';
import React, { useEffect, useState } from 'react';
import {
    ActivityIndicator,
    Alert,
    Dimensions,
    Keyboard,
    KeyboardAvoidingView,
    Platform,
    StyleSheet,
    Text,
    TextInput,
    TouchableOpacity,
    TouchableWithoutFeedback,
    View,
} from 'react-native';
import Animated, {
    FadeInDown,
    FadeInUp,
    useAnimatedStyle,
    useSharedValue,
    withRepeat,
    withSequence,
    withTiming
} from 'react-native-reanimated';
import { useSafeAreaInsets } from 'react-native-safe-area-context';
import { AuthService } from '../services/auth';

const { width, height } = Dimensions.get('window');

// Random starting positions for orbs
const RandomOrb = ({ duration = 10000, size = 200, color = 'rgba(255,255,255,0.1)' }: any) => {
    const sv = useSharedValue(0);

    useEffect(() => {
        sv.value = withRepeat(
            withSequence(
                withTiming(1, { duration: duration / 2 }),
                withTiming(0, { duration: duration / 2 })
            ),
            -1,
            true
        );
    }, [duration, sv]);

    const style = useAnimatedStyle(() => {
        return {
            transform: [
                { translateY: sv.value * 100 },
                { translateX: sv.value * 50 },
                { scale: 1 + sv.value * 0.2 }
            ],
            opacity: 0.3 + sv.value * 0.3,
        };
    });

    return (
        <Animated.View
            style={[
                style,
                {
                    position: 'absolute',
                    width: size,
                    height: size,
                    borderRadius: size / 2,
                    backgroundColor: color,
                    top: Math.random() * height,
                    left: Math.random() * width - size / 2,
                }
            ]}
        />
    );
};

export default function LoginScreen() {
    const { colors, isDark } = useTheme();
    const router = useRouter();
    const insets = useSafeAreaInsets();

    const [studentId, setStudentId] = useState('');
    const [password, setPassword] = useState('');
    const [loading, setLoading] = useState(false);
    const [isSuccess, setIsSuccess] = useState(false);

    // Animations
    const shakeTranslateX = useSharedValue(0);
    const breather = useSharedValue(1);

    useEffect(() => {
        breather.value = withRepeat(
            withTiming(1.05, { duration: 3000 }),
            -1,
            true
        );
    }, [breather]);

    const animatedLogoStyle = useAnimatedStyle(() => ({
        transform: [{ scale: breather.value }]
    }));

    const triggerShake = () => {
        shakeTranslateX.value = withSequence(
            withTiming(-10, { duration: 50 }),
            withRepeat(withTiming(10, { duration: 100 }), 5, true),
            withTiming(0, { duration: 50 })
        );
    };

    const shakeStyle = useAnimatedStyle(() => {
        return {
            transform: [{ translateX: shakeTranslateX.value }],
        };
    });

    const handleLogin = async () => {
        Haptics.impactAsync(Haptics.ImpactFeedbackStyle.Light);

        if (!studentId || !password) {
            triggerShake();
            Haptics.notificationAsync(Haptics.NotificationFeedbackType.Error);
            Alert.alert('Missing Info', 'Please enter your Roll Number and Password.');
            return;
        }

        Keyboard.dismiss();
        setLoading(true);
        try {
            await AuthService.login(studentId, password);

            // Success Sequence
            setLoading(false);
            setIsSuccess(true);

            // Delay navigation to show "SYSTEM ONLINE"
            setTimeout(() => {
                router.replace('/(tabs)');
            }, 1500);

        } catch (error: any) {
            setLoading(false);
            triggerShake();
            Haptics.notificationAsync(Haptics.NotificationFeedbackType.Error);
            Alert.alert('Access Denied', error.message || 'Invalid credentials.');
        }
    };

    return (
        <TouchableWithoutFeedback onPress={Keyboard.dismiss}>
            <View style={styles.container}>
                <Stack.Screen options={{ headerShown: false }} />
                <StatusBar style={isDark ? "light" : "dark"} />

                {/* Background Gradient */}
                {/* Using a subtler gradient that matches app theme */}
                <LinearGradient
                    colors={isDark
                        ? [colors.background, '#1a1a1a']
                        : [colors.primary, colors.background]}
                    start={{ x: 0, y: 0 }}
                    end={{ x: 1, y: 1 }}
                    style={styles.background}
                />

                {/* Animated Background Orbs (Graphix) */}
                <View style={StyleSheet.absoluteFill} pointerEvents="none">
                    <RandomOrb color={colors.primary} size={300} duration={8000} />
                    <RandomOrb color={isDark ? '#444' : '#fff'} delay={1000} size={200} duration={12000} />
                    <RandomOrb color={colors.primary} delay={2000} size={150} duration={6000} />
                </View>

                <KeyboardAvoidingView
                    behavior={Platform.OS === 'ios' ? 'padding' : 'height'}
                    style={{ flex: 1, justifyContent: 'center' }}
                >
                    <View style={[styles.content, { marginTop: -insets.top }]}>

                        {/* Header */}
                        <Animated.View
                            entering={FadeInDown.delay(200).duration(1000).springify()}
                            style={styles.header}
                        >
                            <Animated.View style={[{ alignItems: 'center' }, animatedLogoStyle]}>
                                <View style={[styles.iconContainer, { backgroundColor: isDark ? 'rgba(255,255,255,0.1)' : 'rgba(255,255,255,0.2)' }]}>
                                    <Ionicons name="school" size={60} color={isDark ? colors.text : '#fff'} />
                                </View>
                                <Text style={[styles.title, { color: isDark ? colors.text : '#fff' }]}>Clgpo</Text>
                                <Text style={[styles.subtitle, { color: isDark ? colors.textSecondary : 'rgba(255,255,255,0.8)' }]}>Student Portal Access</Text>
                                <View style={{ height: 2, width: 50, backgroundColor: isSuccess ? colors.success : colors.primary, marginTop: 10, borderRadius: 1 }} />
                            </Animated.View>
                        </Animated.View>

                        {/* Login Form Card */}
                        <Animated.View entering={FadeInUp.delay(400).duration(1000).springify()}>
                            <Animated.View style={[shakeStyle]}>
                                <BlurView intensity={Platform.OS === 'ios' ? 80 : 100} tint={isDark ? 'dark' : 'light'} style={[styles.card, { backgroundColor: isDark ? 'rgba(30,30,30,0.6)' : 'rgba(255,255,255,0.8)', borderColor: colors.cardBorder }]}>
                                    <Text style={[styles.welcomeText, { color: colors.text }]}>Welcome Back</Text>

                                    <View style={[styles.inputContainer, { backgroundColor: colors.card, borderColor: colors.cardBorder }]}>
                                        <Ionicons name="person-outline" size={20} color={colors.textSecondary} style={styles.inputIcon} />
                                        <TextInput
                                            style={[styles.input, { color: colors.text }]}
                                            placeholder="Roll Number"
                                            placeholderTextColor={colors.textSecondary}
                                            value={studentId}
                                            onChangeText={text => setStudentId(text.toUpperCase())}
                                            autoCapitalize="characters"
                                            autoCorrect={false}
                                        />
                                    </View>

                                    <View style={[styles.inputContainer, { backgroundColor: colors.card, borderColor: colors.cardBorder }]}>
                                        <Ionicons name="lock-closed-outline" size={20} color={colors.textSecondary} style={styles.inputIcon} />
                                        <TextInput
                                            style={[styles.input, { color: colors.text }]}
                                            placeholder="Password"
                                            placeholderTextColor={colors.textSecondary}
                                            secureTextEntry={true}
                                            value={password}
                                            onChangeText={setPassword}
                                        />
                                    </View>

                                    <TouchableOpacity
                                        style={[
                                            styles.button,
                                            {
                                                backgroundColor: isSuccess ? colors.success : colors.primary,
                                                opacity: (loading || isSuccess) ? 0.9 : 1
                                            }
                                        ]}
                                        onPress={handleLogin}
                                        disabled={loading || isSuccess}
                                        activeOpacity={0.8}
                                    >
                                        {loading ? (
                                            <View style={{ flexDirection: 'row', alignItems: 'center' }}>
                                                <ActivityIndicator color="#fff" size="small" style={{ marginRight: 10 }} />
                                                <Text style={[styles.buttonText, { fontSize: 14, letterSpacing: 1 }]}>ESTABLISHING CONNECTION...</Text>
                                            </View>
                                        ) : isSuccess ? (
                                            <View style={{ flexDirection: 'row', alignItems: 'center' }}>
                                                <Ionicons name="checkmark-circle" size={24} color="#fff" style={{ marginRight: 8 }} />
                                                <Text style={[styles.buttonText, { letterSpacing: 2 }]}>SYSTEM ONLINE</Text>
                                            </View>
                                        ) : (
                                            <Text style={[styles.buttonText, { letterSpacing: 1 }]}>INITIATE LINK</Text>
                                        )}
                                    </TouchableOpacity>
                                </BlurView>
                            </Animated.View>
                        </Animated.View>

                        {/* Footer */}
                        <Animated.View
                            entering={FadeInUp.delay(600).duration(1000)}
                            style={styles.footer}
                        >
                            <Text style={[styles.footerText, { color: isDark ? colors.textSecondary : '#fff' }]}>Version 1.0.0</Text>
                        </Animated.View>

                    </View>
                </KeyboardAvoidingView>
            </View>
        </TouchableWithoutFeedback>
    );
}

const styles = StyleSheet.create({
    container: {
        flex: 1,
    },
    background: {
        position: 'absolute',
        left: 0,
        right: 0,
        top: 0,
        bottom: 0,
    },
    content: {
        paddingHorizontal: 24,
        alignItems: 'center',
    },
    header: {
        alignItems: 'center',
        marginBottom: 40,
    },
    iconContainer: {
        width: 100,
        height: 100,
        borderRadius: 50,
        justifyContent: 'center',
        alignItems: 'center',
        marginBottom: 16,
        borderWidth: 1,
        borderColor: 'rgba(255,255,255,0.3)',
    },
    title: {
        fontSize: 42,
        fontWeight: 'bold',
        letterSpacing: 1,
        textShadowColor: 'rgba(0, 0, 0, 0.1)',
        textShadowOffset: { width: 0, height: 2 },
        textShadowRadius: 4,
    },
    subtitle: {
        fontSize: 16,
        marginTop: 4,
    },
    card: {
        width: width * 0.9,
        borderRadius: 24,
        padding: 30,
        overflow: 'hidden',
        borderWidth: 1,
    },
    welcomeText: {
        fontSize: 24,
        fontWeight: 'bold',
        marginBottom: 24,
        textAlign: 'center',
    },
    inputContainer: {
        flexDirection: 'row',
        alignItems: 'center',
        borderRadius: 16,
        marginBottom: 16,
        height: 56,
        paddingHorizontal: 16,
        borderWidth: 1,
    },
    inputIcon: {
        marginRight: 12,
    },
    input: {
        flex: 1,
        fontSize: 16,
        height: '100%',
    },
    button: {
        height: 56,
        borderRadius: 16,
        justifyContent: 'center',
        alignItems: 'center',
        marginTop: 8,
        shadowColor: '#000',
        shadowOffset: {
            width: 0,
            height: 4,
        },
        shadowOpacity: 0.3,
        shadowRadius: 4.65,
        elevation: 8,
    },
    buttonText: {
        color: '#fff',
        fontSize: 18,
        fontWeight: 'bold',
    },
    footer: {
        marginTop: 40,
    },
    footerText: {
        fontSize: 12,
    },
});


=======================================================
FILE: app\logout.tsx
=======================================================

import { useRouter } from 'expo-router';
import React, { useEffect } from 'react';
import { ActivityIndicator, View } from 'react-native';
import { AuthService } from '../services/auth';

export default function LogoutScreen() {
    const router = useRouter();

    useEffect(() => {
        const performLogout = async () => {
            await AuthService.logout();
            router.replace('/login');
        };

        performLogout();
    }, [router]);

    return (
        <View style={{ flex: 1, justifyContent: 'center', alignItems: 'center', backgroundColor: '#fff' }}>
            <ActivityIndicator size="large" color="#000" />
        </View>
    );
}


=======================================================
FILE: app\notifications.tsx
=======================================================

import { useTheme } from '@/context/ThemeContext';
import { AppNotification, NotificationService } from '@/services/notification';
import { Ionicons } from '@expo/vector-icons';
import { BlurView } from 'expo-blur';
import { LinearGradient } from 'expo-linear-gradient';
import { Stack, useRouter } from 'expo-router';
import React, { useCallback, useEffect, useState } from 'react';
import { ActivityIndicator, FlatList, RefreshControl, StyleSheet, Text, View } from 'react-native';
import Animated, { FadeInDown } from 'react-native-reanimated';

import { ScalePressable } from '@/components/ScalePressable';

export default function NotificationsScreen() {
    const { colors, isDark } = useTheme();
    const router = useRouter();
    const [notifications, setNotifications] = useState<AppNotification[]>([]);
    const [loading, setLoading] = useState(true);
    const [refreshing, setRefreshing] = useState(false);

    const loadNotifications = useCallback(async () => {
        try {
            const data = await NotificationService.getNotifications();
            setNotifications(data);
        } catch {
        } finally {
            setLoading(false);
            setRefreshing(false);
        }
    }, []);

    useEffect(() => {
        loadNotifications();
    }, [loadNotifications]);

    const onRefresh = () => {
        setRefreshing(true);
        loadNotifications();
    };

    const renderItem = ({ item, index }: { item: AppNotification; index: number }) => (
        <Animated.View entering={FadeInDown.delay(index * 100).springify()}>
            <BlurView intensity={isDark ? 40 : 80} tint={isDark ? 'dark' : 'light'} style={[styles.card, { backgroundColor: isDark ? 'rgba(40,40,40,0.5)' : 'rgba(255,255,255,0.7)', borderColor: colors.cardBorder }]}>
                <View style={styles.header}>
                    <View style={[styles.iconContainer, { backgroundColor: colors.primary + '15' }]}>
                        <Text style={{ fontSize: 20 }}>{item.icon}</Text>
                    </View>
                    <View style={styles.headerText}>
                        <Text style={[styles.title, { color: colors.text }]}>{item.title}</Text>
                        <Text style={[styles.time, { color: colors.textSecondary }]}>{item.time}</Text>
                    </View>
                </View>
                <View style={styles.contentContainer}>
                    <Text style={[styles.description, { color: colors.textSecondary }]}>{item.description}</Text>
                </View>
            </BlurView>
        </Animated.View>
    );

    return (
        <View style={styles.container}>
            <Stack.Screen options={{ headerShown: false }} />
            <LinearGradient
                colors={isDark ? [colors.background, '#1a1a1a'] : [colors.primary + '10', colors.background]}
                style={StyleSheet.absoluteFill}
            />

            {/* Custom Header */}
            <View style={[styles.screenHeader, { paddingTop: 60 }]}>
                <ScalePressable onPress={() => router.back()} style={styles.backButton}>
                    <View style={[styles.backButtonCircle, { backgroundColor: isDark ? 'rgba(255,255,255,0.1)' : 'rgba(255,255,255,0.6)' }]}>
                        <Ionicons name="arrow-back" size={24} color={colors.text} />
                    </View>
                </ScalePressable>
                <Text style={[styles.screenTitle, { color: colors.text }]}>Notifications</Text>
            </View>

            {loading ? (
                <View style={styles.center}>
                    <ActivityIndicator size="large" color={colors.primary} />
                </View>
            ) : (
                <FlatList
                    data={notifications}
                    renderItem={renderItem}
                    keyExtractor={(item) => item.id}
                    contentContainerStyle={styles.list}
                    showsVerticalScrollIndicator={false}
                    refreshControl={<RefreshControl refreshing={refreshing} onRefresh={onRefresh} tintColor={colors.primary} />}
                    ListEmptyComponent={
                        <View style={styles.center}>
                            <Ionicons name="notifications-off-outline" size={64} color={colors.textSecondary + '50'} style={{ marginBottom: 16 }} />
                            <Text style={{ color: colors.textSecondary, fontSize: 16, fontWeight: '600' }}>No new notifications</Text>
                            <Text style={{ color: colors.textSecondary, opacity: 0.7, marginTop: 4 }}>You&apos;re all caught up!</Text>
                        </View>
                    }
                />
            )}
        </View>
    );
}

const styles = StyleSheet.create({
    container: {
        flex: 1,
    },
    screenHeader: {
        flexDirection: 'row',
        alignItems: 'center',
        paddingHorizontal: 20,
        marginBottom: 10,
        zIndex: 10,
    },
    backButton: {
        marginRight: 15,
    },
    backButtonCircle: {
        width: 40,
        height: 40,
        borderRadius: 20,
        justifyContent: 'center',
        alignItems: 'center',
    },
    screenTitle: {
        fontSize: 28,
        fontWeight: '800',
        letterSpacing: -0.5,
    },
    list: {
        padding: 20,
        gap: 16,
        paddingTop: 10,
    },
    center: {
        flex: 1,
        justifyContent: 'center',
        alignItems: 'center',
    },
    card: {
        padding: 16,
        borderRadius: 20,
        marginBottom: 4,
        borderWidth: 1,
        overflow: 'hidden',
    },
    header: {
        flexDirection: 'row',
        alignItems: 'center',
        marginBottom: 12,
    },
    iconContainer: {
        width: 40,
        height: 40,
        borderRadius: 20,
        justifyContent: 'center',
        alignItems: 'center',
        marginRight: 16,
    },
    headerText: {
        flex: 1,
    },
    title: {
        fontSize: 16,
        fontWeight: 'bold',
        marginBottom: 4,
    },
    time: {
        fontSize: 12,
        fontWeight: '500',
    },
    contentContainer: {
        marginLeft: 56, // 40 (icon) + 16 (margin)
    },
    description: {
        fontSize: 14,
        lineHeight: 22,
    },
});


=======================================================
FILE: app\onboarding.tsx
=======================================================


import { Ionicons } from '@expo/vector-icons';
import AsyncStorage from '@react-native-async-storage/async-storage';
import { LinearGradient } from 'expo-linear-gradient';
import { useRouter } from 'expo-router';
import React, { useState } from 'react';
import { Dimensions, StyleSheet, Text, View } from 'react-native';
import Animated, { FadeInDown, FadeInUp, useSharedValue, withSpring } from 'react-native-reanimated';
import { SafeAreaView } from 'react-native-safe-area-context';
import { ScalePressable } from '../components/ScalePressable';

const { width } = Dimensions.get('window');

const ONBOARDING_KEY = 'has_seen_onboarding';

interface Slide {
    id: number;
    icon: keyof typeof Ionicons.glyphMap;
    title: string;
    subtitle: string;
    color: string;
}

const slides: Slide[] = [
    {
        id: 1,
        icon: 'school-outline',
        title: 'Track Attendance',
        subtitle: 'Monitor your attendance percentage in real-time. Never miss the 75% threshold!',
        color: '#3b82f6',
    },
    {
        id: 2,
        icon: 'notifications-outline',
        title: 'Smart Alerts',
        subtitle: 'Get notified when your attendance is marked. Stay updated even in background!',
        color: '#8b5cf6',
    },
    {
        id: 3,
        icon: 'analytics-outline',
        title: 'Predict & Plan',
        subtitle: 'Calculate how many classes you can bunk while staying safe. Plan smarter!',
        color: '#10b981',
    },
    {
        id: 4,
        icon: 'rocket-outline',
        title: 'Ready to Go!',
        subtitle: 'Login with your ERP credentials and take control of your attendance.',
        color: '#f59e0b',
    },
];

export default function Onboarding() {
    const router = useRouter();
    const [currentIndex, setCurrentIndex] = useState(0);
    const translateX = useSharedValue(0);

    const handleNext = async () => {
        if (currentIndex < slides.length - 1) {
            setCurrentIndex(currentIndex + 1);
            translateX.value = withSpring(-((currentIndex + 1) * width));
        } else {
            // Mark onboarding as complete
            try {
                await AsyncStorage.setItem(ONBOARDING_KEY, 'true');
            } catch {
                // Save failure is non-critical
            }
            router.replace('/login');
        }
    };

    const handleSkip = async () => {
        try {
            await AsyncStorage.setItem(ONBOARDING_KEY, 'true');
        } catch {
            // Save failure is non-critical
        }
        router.replace('/login');
    };

    const currentSlide = slides[currentIndex];

    return (
        <View style={styles.container}>
            <LinearGradient
                colors={['#0f172a', '#1e293b', '#0f172a']}
                style={StyleSheet.absoluteFill}
            />

            <SafeAreaView style={styles.safeArea}>
                {/* Skip Button */}
                {currentIndex < slides.length - 1 && (
                    <Animated.View entering={FadeInUp.delay(200)} style={styles.skipContainer}>
                        <ScalePressable onPress={handleSkip}>
                            <Text style={styles.skipText}>Skip</Text>
                        </ScalePressable>
                    </Animated.View>
                )}

                {/* Main Content */}
                <View style={styles.content}>
                    {/* Icon */}
                    <Animated.View
                        key={currentSlide.id}
                        entering={FadeInDown.duration(500).springify()}
                        style={[styles.iconContainer, { backgroundColor: `${currentSlide.color}20` }]}
                    >
                        <View style={[styles.iconInner, { backgroundColor: `${currentSlide.color}40` }]}>
                            <Ionicons name={currentSlide.icon} size={80} color={currentSlide.color} />
                        </View>
                    </Animated.View>

                    {/* Text */}
                    <Animated.View
                        key={`text-${currentSlide.id}`}
                        entering={FadeInDown.delay(150).duration(500).springify()}
                        style={styles.textContainer}
                    >
                        <Text style={styles.title}>{currentSlide.title}</Text>
                        <Text style={styles.subtitle}>{currentSlide.subtitle}</Text>
                    </Animated.View>
                </View>

                {/* Bottom Section */}
                <View style={styles.bottomSection}>
                    {/* Pagination Dots */}
                    <View style={styles.pagination}>
                        {slides.map((_, index) => (
                            <View
                                key={index}
                                style={[
                                    styles.dot,
                                    {
                                        backgroundColor: index === currentIndex ? currentSlide.color : 'rgba(255,255,255,0.3)',
                                        width: index === currentIndex ? 24 : 8,
                                    },
                                ]}
                            />
                        ))}
                    </View>

                    {/* Next/Get Started Button */}
                    <ScalePressable onPress={handleNext}>
                        <LinearGradient
                            colors={[currentSlide.color, currentSlide.color + 'cc']}
                            start={{ x: 0, y: 0 }}
                            end={{ x: 1, y: 0 }}
                            style={styles.nextButton}
                        >
                            <Text style={styles.nextButtonText}>
                                {currentIndex === slides.length - 1 ? 'Get Started' : 'Next'}
                            </Text>
                            <Ionicons
                                name={currentIndex === slides.length - 1 ? 'checkmark' : 'arrow-forward'}
                                size={20}
                                color="#fff"
                            />
                        </LinearGradient>
                    </ScalePressable>
                </View>
            </SafeAreaView>
        </View>
    );
}

const styles = StyleSheet.create({
    container: {
        flex: 1,
    },
    safeArea: {
        flex: 1,
    },
    skipContainer: {
        alignItems: 'flex-end',
        paddingHorizontal: 24,
        paddingTop: 10,
    },
    skipText: {
        color: 'rgba(255,255,255,0.6)',
        fontSize: 16,
        fontWeight: '500',
    },
    content: {
        flex: 1,
        justifyContent: 'center',
        alignItems: 'center',
        paddingHorizontal: 40,
    },
    iconContainer: {
        width: 180,
        height: 180,
        borderRadius: 90,
        justifyContent: 'center',
        alignItems: 'center',
        marginBottom: 40,
    },
    iconInner: {
        width: 140,
        height: 140,
        borderRadius: 70,
        justifyContent: 'center',
        alignItems: 'center',
    },
    textContainer: {
        alignItems: 'center',
    },
    title: {
        fontSize: 32,
        fontWeight: 'bold',
        color: '#fff',
        textAlign: 'center',
        marginBottom: 16,
    },
    subtitle: {
        fontSize: 16,
        color: 'rgba(255,255,255,0.7)',
        textAlign: 'center',
        lineHeight: 24,
    },
    bottomSection: {
        paddingHorizontal: 24,
        paddingBottom: 40,
    },
    pagination: {
        flexDirection: 'row',
        justifyContent: 'center',
        alignItems: 'center',
        marginBottom: 30,
        gap: 8,
    },
    dot: {
        height: 8,
        borderRadius: 4,
    },
    nextButton: {
        flexDirection: 'row',
        alignItems: 'center',
        justifyContent: 'center',
        paddingVertical: 16,
        borderRadius: 16,
        gap: 8,
    },
    nextButtonText: {
        color: '#fff',
        fontSize: 18,
        fontWeight: 'bold',
    },
});

// Helper to check if onboarding should be shown
export const shouldShowOnboarding = async (): Promise<boolean> => {
    try {
        const hasSeenOnboarding = await AsyncStorage.getItem(ONBOARDING_KEY);
        return hasSeenOnboarding !== 'true';
    } catch {
        return true;
    }
};


=======================================================
FILE: app\settings.tsx
=======================================================


import { Ionicons } from '@expo/vector-icons';
import Constants from 'expo-constants';
import * as Haptics from 'expo-haptics';
import { LinearGradient } from 'expo-linear-gradient';
import { useRouter } from 'expo-router';
import React, { useState } from 'react';
import { Alert, Linking, Platform, ScrollView, Share, StyleSheet, Switch, Text, TouchableOpacity, View } from 'react-native';
import Animated, { FadeInDown } from 'react-native-reanimated';
import { SafeAreaView, useSafeAreaInsets } from 'react-native-safe-area-context';
import { AboutModal } from '../components/settings/AboutModal';
import { PrivacyModal } from '../components/settings/PrivacyModal';
import { TermsModal } from '../components/settings/TermsModal';
import { useTheme } from '../context/ThemeContext';
import { useLogout } from '../hooks/useLogout';

export default function Settings() {
    const router = useRouter();
    const { colors, isDark, toggleTheme } = useTheme();
    const insets = useSafeAreaInsets();
    const { handleLogout, loggingOut } = useLogout();

    // Mock state for notifications (would be connected to storage in real app)
    const [examAlerts, setExamAlerts] = useState(true);
    const [feeAlerts, setFeeAlerts] = useState(true);
    const [showPrivacyModal, setShowPrivacyModal] = useState(false);
    const [showTermsModal, setShowTermsModal] = useState(false);
    const [showAboutModal, setShowAboutModal] = useState(false);

    const handleClearCache = () => {
        Alert.alert(
            "Clear Cache",
            "Are you sure you want to clear all app cache? This will not log you out.",
            [
                { text: "Cancel", style: "cancel" },
                {
                    text: "Clear",
                    style: "destructive",
                    onPress: () => Alert.alert("Success", "Cache cleared successfully!")
                }
            ]
        );
    };

    const handleShareApp = async () => {
        Haptics.impactAsync(Haptics.ImpactFeedbackStyle.Light);
        try {
            await Share.share({
                message: 'üìö Check out Clgpo - the best app for tracking your college attendance!\n\nDownload it now and never miss the 75% threshold again! üéØ',
                title: 'Share Clgpo',
            });
        } catch {
            // Share cancelled or failed
        }
    };

    const SettingItem = ({ icon, title, subtitle, rightElement, onPress, color = colors.primary }: any) => (
        <TouchableOpacity
            style={[styles.settingItem, { borderBottomColor: colors.cardBorder }]}
            onPress={() => {
                Haptics.impactAsync(Haptics.ImpactFeedbackStyle.Light);
                onPress?.();
            }}
            disabled={!onPress}
            activeOpacity={0.7}
        >
            <View style={[styles.iconContainer, { backgroundColor: `${color}20` }]}>
                <Ionicons name={icon} size={22} color={color} />
            </View>
            <View style={styles.settingContent}>
                <Text style={[styles.settingTitle, { color: colors.text }]}>{title}</Text>
                {subtitle && <Text style={[styles.settingSubtitle, { color: colors.textSecondary }]}>{subtitle}</Text>}
            </View>
            {rightElement}
        </TouchableOpacity>
    );

    const SectionHeader = ({ title }: { title: string }) => (
        <Text style={[styles.sectionHeader, { color: colors.textSecondary }]}>{title}</Text>
    );

    return (
        <View style={[styles.container, { backgroundColor: colors.background }]}>
            <LinearGradient
                colors={isDark ? ['#0f172a', '#1e293b'] : ['#f0f9ff', '#e0f2fe']}
                style={StyleSheet.absoluteFill}
            />

            <SafeAreaView style={styles.safeArea}>
                {/* Simple Header */}
                <View style={styles.header}>
                    <TouchableOpacity
                        onPress={() => router.back()}
                        style={[styles.backBtn, { backgroundColor: colors.card, borderColor: colors.cardBorder }]}
                    >
                        <Ionicons name="arrow-back" size={24} color={colors.text} />
                    </TouchableOpacity>
                    <Text style={[styles.headerTitle, { color: colors.text }]}>Settings</Text>
                    <View style={{ width: 40 }} />
                </View>

                <ScrollView
                    contentContainerStyle={[styles.content, { paddingBottom: 40 + insets.bottom }]}
                    showsVerticalScrollIndicator={false}
                >
                    <Animated.View entering={FadeInDown.delay(100).duration(600).springify()}>
                        <View style={[styles.card, { backgroundColor: colors.card, borderColor: colors.cardBorder }]}>
                            <SectionHeader title="APPEARANCE" />
                            <SettingItem
                                icon={isDark ? "moon" : "sunny"}
                                title="App Theme"
                                subtitle={isDark ? "Dark Mode" : "Light Mode"}
                                color="#8b5cf6"
                                rightElement={
                                    <Switch
                                        value={isDark}
                                        onValueChange={toggleTheme}
                                        trackColor={{ false: '#767577', true: '#8b5cf6' }}
                                        thumbColor={Platform.OS === 'ios' ? '#fff' : '#f4f3f4'}
                                    />
                                }
                            />
                        </View>
                    </Animated.View>

                    <Animated.View entering={FadeInDown.delay(200).duration(600).springify()}>
                        <View style={[styles.card, { backgroundColor: colors.card, borderColor: colors.cardBorder }]}>
                            <SectionHeader title="NOTIFICATIONS" />
                            <SettingItem
                                icon="notifications"
                                title="Exam Results"
                                subtitle="Get notified for new grades"
                                color="#f59e0b"
                                rightElement={
                                    <Switch
                                        value={examAlerts}
                                        onValueChange={setExamAlerts}
                                        trackColor={{ false: '#767577', true: '#f59e0b' }}
                                        thumbColor={Platform.OS === 'ios' ? '#fff' : '#f4f3f4'}
                                    />
                                }
                            />
                            <SettingItem
                                icon="receipt"
                                title="Fee Updates"
                                subtitle="Alerts for payments and dues"
                                color="#10b981"
                                rightElement={
                                    <Switch
                                        value={feeAlerts}
                                        onValueChange={setFeeAlerts}
                                        trackColor={{ false: '#767577', true: '#10b981' }}
                                        thumbColor={Platform.OS === 'ios' ? '#fff' : '#f4f3f4'}
                                    />
                                }
                            />
                            {Platform.OS === 'android' && (
                                <SettingItem
                                    icon="battery-charging"
                                    title="Battery Optimization"
                                    subtitle="Allow background updates"
                                    color="#06b6d4"
                                    onPress={() => {
                                        Alert.alert(
                                            "Enable Background Activity",
                                            "To get reliable attendance notifications, please exclude Clgpo from battery optimization.\n\n1. Tap 'Open Settings'\n2. Find 'Clgpo'\n3. Select 'Don't optimize' or 'Unrestricted'",
                                            [
                                                { text: "Cancel", style: "cancel" },
                                                {
                                                    text: "Open Settings",
                                                    onPress: () => Linking.openSettings()
                                                }
                                            ]
                                        );
                                    }}
                                    rightElement={
                                        <Ionicons name="chevron-forward" size={20} color={colors.textSecondary} />
                                    }
                                />
                            )}

                        </View>
                    </Animated.View>

                    <Animated.View entering={FadeInDown.delay(300).duration(600).springify()}>
                        <View style={[styles.card, { backgroundColor: colors.card, borderColor: colors.cardBorder }]}>
                            <SectionHeader title="SUPPORT & DATA" />
                            <SettingItem
                                icon="trash-bin"
                                title="Clear Cache"
                                subtitle="Free up space"
                                color="#ef4444"
                                onPress={handleClearCache}
                            />
                            <SettingItem
                                icon="shield-checkmark"
                                title="Privacy Policy"
                                subtitle="How we handle your data"
                                color="#3b82f6"
                                onPress={() => setShowPrivacyModal(true)}
                                rightElement={
                                    <Ionicons name="chevron-forward" size={20} color={colors.textSecondary} />
                                }
                            />
                            <SettingItem
                                icon="document-text"
                                title="Terms of Service"
                                subtitle="Usage guidelines"
                                color="#8b5cf6"
                                onPress={() => setShowTermsModal(true)}
                                rightElement={
                                    <Ionicons name="chevron-forward" size={20} color={colors.textSecondary} />
                                }
                            />
                            <SettingItem
                                icon="information-circle"
                                title="About Clgpo"
                                subtitle={`v${Constants.expoConfig?.version || '1.0.0'}`}
                                color="#6366f1"
                                onPress={() => setShowAboutModal(true)}
                                rightElement={
                                    <Ionicons name="chevron-forward" size={20} color={colors.textSecondary} />
                                }
                            />
                            <SettingItem
                                icon="share-social"
                                title="Share Clgpo"
                                subtitle="Invite your friends"
                                color="#10b981"
                                onPress={handleShareApp}
                                rightElement={
                                    <Ionicons name="chevron-forward" size={20} color={colors.textSecondary} />
                                }
                            />
                        </View>
                    </Animated.View>

                    <Animated.View entering={FadeInDown.delay(400).duration(600).springify()}>
                        <TouchableOpacity
                            style={[styles.logoutBtn]}
                            onPress={handleLogout}
                            disabled={loggingOut}
                        >
                            <LinearGradient
                                colors={['#ef4444', '#dc2626']}
                                start={{ x: 0, y: 0 }}
                                end={{ x: 1, y: 0 }}
                                style={styles.logoutGradient}
                            >
                                <Ionicons name="log-out-outline" size={20} color="#fff" style={{ marginRight: 8 }} />
                                <Text style={styles.logoutText}>{loggingOut ? "Logging Out..." : "Log Out"}</Text>
                            </LinearGradient>
                        </TouchableOpacity>
                        <Text style={[styles.credits, { color: colors.textSecondary }]}>
                            Made with ‚ù§Ô∏è by Bharat Kumar
                        </Text>
                    </Animated.View>
                </ScrollView>
            </SafeAreaView>

            <PrivacyModal visible={showPrivacyModal} onClose={() => setShowPrivacyModal(false)} colors={colors} isDark={isDark} />
            <TermsModal visible={showTermsModal} onClose={() => setShowTermsModal(false)} colors={colors} isDark={isDark} />
            <AboutModal visible={showAboutModal} onClose={() => setShowAboutModal(false)} colors={colors} isDark={isDark} />
        </View >
    );
}

const styles = StyleSheet.create({
    container: {
        flex: 1,
    },
    safeArea: {
        flex: 1,
    },
    header: {
        flexDirection: 'row',
        alignItems: 'center',
        justifyContent: 'space-between',
        paddingHorizontal: 20,
        paddingVertical: 10,
        marginBottom: 10,
    },
    backBtn: {
        width: 40,
        height: 40,
        borderRadius: 20,
        justifyContent: 'center',
        alignItems: 'center',
        borderWidth: 1,
    },
    headerTitle: {
        fontSize: 20,
        fontWeight: 'bold',
    },
    content: {
        paddingHorizontal: 20,
    },
    card: {
        borderRadius: 20,
        padding: 16,
        marginBottom: 20,
        borderWidth: 1,
    },
    sectionHeader: {
        fontSize: 12,
        fontWeight: '700',
        marginBottom: 16,
        letterSpacing: 1,
    },
    settingItem: {
        flexDirection: 'row',
        alignItems: 'center',
        paddingVertical: 12,
        borderBottomWidth: 1,
    },
    iconContainer: {
        width: 36,
        height: 36,
        borderRadius: 10,
        justifyContent: 'center',
        alignItems: 'center',
        marginRight: 16,
    },
    settingContent: {
        flex: 1,
    },
    settingTitle: {
        fontSize: 16,
        fontWeight: '600',
    },
    settingSubtitle: {
        fontSize: 13,
        marginTop: 2,
    },
    logoutBtn: {
        marginTop: 10,
        borderRadius: 16,
        overflow: 'hidden',
        shadowColor: "#ef4444",
        shadowOffset: { width: 0, height: 4 },
        shadowOpacity: 0.3,
        shadowRadius: 8,
        elevation: 6,
    },
    logoutGradient: {
        flexDirection: 'row',
        alignItems: 'center',
        justifyContent: 'center',
        paddingVertical: 16,
    },
    logoutText: {
        color: '#fff',
        fontSize: 16,
        fontWeight: 'bold',
    },
    credits: {
        textAlign: 'center',
        marginTop: 20,
        fontSize: 12,
        opacity: 0.6,
    },
    // Modal styles
    modalContainer: {
        flex: 1,
    },
    modalHeader: {
        flexDirection: 'row',
        alignItems: 'center',
        justifyContent: 'space-between',
        paddingHorizontal: 20,
        paddingVertical: 10,
    },
    modalTitle: {
        fontSize: 20,
        fontWeight: 'bold',
    },
    modalContent: {
        padding: 20,
        paddingBottom: 40,
    },
    // Policy styles - Enhanced UI
    policyHeader: {
        paddingBottom: 30,
    },
    policyHeaderContent: {
        alignItems: 'center',
        paddingTop: 10,
    },
    policyBackBtn: {
        position: 'absolute',
        top: 10,
        left: 20,
        width: 40,
        height: 40,
        borderRadius: 20,
        backgroundColor: 'rgba(255,255,255,0.2)',
        justifyContent: 'center',
        alignItems: 'center',
    },
    policyHeaderIcon: {
        width: 80,
        height: 80,
        borderRadius: 40,
        backgroundColor: 'rgba(255,255,255,0.2)',
        justifyContent: 'center',
        alignItems: 'center',
        marginBottom: 12,
    },
    policyHeaderTitle: {
        fontSize: 28,
        fontWeight: 'bold',
        color: '#fff',
        marginBottom: 4,
    },
    policyHeaderSubtitle: {
        fontSize: 14,
        color: 'rgba(255,255,255,0.8)',
    },
    policyScrollContent: {
        padding: 20,
    },
    policySectionCard: {
        borderRadius: 16,
        padding: 16,
        marginBottom: 16,
        borderWidth: 1,
    },
    policySectionIcon: {
        width: 44,
        height: 44,
        borderRadius: 12,
        justifyContent: 'center',
        alignItems: 'center',
        marginBottom: 12,
    },
    policySectionTitle: {
        fontSize: 18,
        fontWeight: 'bold',
        marginBottom: 10,
    },
    policySectionText: {
        fontSize: 15,
        lineHeight: 24,
    },
    policyDataItem: {
        flexDirection: 'row',
        alignItems: 'flex-start',
        marginTop: 12,
        paddingTop: 12,
        borderTopWidth: 1,
        borderTopColor: 'rgba(128,128,128,0.2)',
    },
    policyDataIcon: {
        width: 32,
        height: 32,
        borderRadius: 8,
        justifyContent: 'center',
        alignItems: 'center',
        marginRight: 12,
    },
    policyDataTitle: {
        fontSize: 15,
        fontWeight: '600',
        marginBottom: 4,
    },
    policyDataDesc: {
        fontSize: 14,
        lineHeight: 20,
    },
    policyListItem: {
        flexDirection: 'row',
        alignItems: 'center',
        marginTop: 8,
    },
    policyListText: {
        fontSize: 15,
        flex: 1,
    },
    policyBanner: {
        flexDirection: 'row',
        alignItems: 'center',
        padding: 16,
        borderRadius: 16,
        marginBottom: 16,
    },
    policyBannerTitle: {
        fontSize: 16,
        fontWeight: 'bold',
        marginBottom: 4,
    },
    policyBannerText: {
        fontSize: 14,
        lineHeight: 20,
    },
    policyRightsGrid: {
        flexDirection: 'row',
        flexWrap: 'wrap',
        marginTop: 8,
        gap: 10,
    },
    policyRightItem: {
        width: '47%',
        flexDirection: 'row',
        alignItems: 'center',
        padding: 12,
        borderRadius: 12,
    },
    policyRightText: {
        fontSize: 14,
        fontWeight: '600',
        marginLeft: 10,
    },
    policyContactBtn: {
        flexDirection: 'row',
        alignItems: 'center',
        justifyContent: 'center',
        backgroundColor: '#06b6d4',
        paddingVertical: 14,
        paddingHorizontal: 20,
        borderRadius: 12,
        marginTop: 12,
    },
    policyContactBtnText: {
        color: '#fff',
        fontSize: 15,
        fontWeight: '600',
    },
    policyDate: {
        fontSize: 13,
        marginBottom: 20,
        fontStyle: 'italic',
    },
    policyHeading: {
        fontSize: 18,
        fontWeight: 'bold',
        marginTop: 20,
        marginBottom: 10,
    },
    policyText: {
        fontSize: 15,
        lineHeight: 24,
        marginBottom: 8,
    },
    // About styles
    aboutLogo: {
        width: 120,
        height: 120,
        borderRadius: 30,
        justifyContent: 'center',
        alignItems: 'center',
        marginBottom: 16,
    },
    aboutAppName: {
        fontSize: 32,
        fontWeight: 'bold',
        marginBottom: 4,
    },
    aboutVersion: {
        fontSize: 16,
        marginBottom: 24,
    },
    aboutCard: {
        width: '100%',
        borderRadius: 16,
        padding: 16,
        marginBottom: 16,
        borderWidth: 1,
    },
    aboutDescription: {
        fontSize: 15,
        lineHeight: 24,
        textAlign: 'center',
    },
    aboutSectionTitle: {
        fontSize: 18,
        fontWeight: 'bold',
        marginTop: 8,
        marginBottom: 12,
        alignSelf: 'flex-start',
    },
    featureItem: {
        flexDirection: 'row',
        alignItems: 'center',
        paddingVertical: 10,
    },
    featureText: {
        fontSize: 15,
        marginLeft: 12,
    },
    developerName: {
        fontSize: 18,
        fontWeight: 'bold',
        textAlign: 'center',
    },
    developerRole: {
        fontSize: 14,
        textAlign: 'center',
        marginBottom: 8,
    },
    developerDesc: {
        fontSize: 14,
        lineHeight: 20,
        textAlign: 'center',
    },
    copyright: {
        fontSize: 12,
        marginTop: 20,
        textAlign: 'center',
    },
    // Enhanced About styles
    aboutHeader: {
        paddingBottom: 30,
    },
    aboutLogoContainer: {
        marginBottom: 12,
    },
    aboutLogoInner: {
        width: 100,
        height: 100,
        borderRadius: 25,
        justifyContent: 'center',
        alignItems: 'center',
    },
    aboutHeaderTitle: {
        fontSize: 32,
        fontWeight: 'bold',
        color: '#fff',
        marginBottom: 8,
    },
    versionBadge: {
        backgroundColor: 'rgba(255,255,255,0.2)',
        paddingHorizontal: 16,
        paddingVertical: 6,
        borderRadius: 20,
    },
    versionBadgeText: {
        color: '#fff',
        fontSize: 14,
        fontWeight: '600',
    },
    aboutTaglineBanner: {
        flexDirection: 'row',
        alignItems: 'center',
        padding: 16,
        borderRadius: 16,
        marginBottom: 16,
    },
    aboutTagline: {
        fontSize: 16,
        fontWeight: '600',
        marginLeft: 12,
        flex: 1,
    },
    aboutFeaturesGrid: {
        flexDirection: 'row',
        flexWrap: 'wrap',
        gap: 10,
        marginTop: 8,
    },
    aboutFeatureCard: {
        width: '47%',
        padding: 12,
        borderRadius: 12,
        alignItems: 'center',
    },
    aboutFeatureIcon: {
        width: 44,
        height: 44,
        borderRadius: 12,
        justifyContent: 'center',
        alignItems: 'center',
        marginBottom: 8,
    },
    aboutFeatureTitle: {
        fontSize: 14,
        fontWeight: '600',
        textAlign: 'center',
    },
    aboutFeatureDesc: {
        fontSize: 12,
        textAlign: 'center',
        marginTop: 2,
    },
    aboutDeveloperCard: {
        flexDirection: 'row',
        alignItems: 'center',
        marginBottom: 8,
    },
    aboutDevAvatar: {
        width: 56,
        height: 56,
        borderRadius: 28,
        justifyContent: 'center',
        alignItems: 'center',
    },
    aboutDevInitial: {
        fontSize: 20,
        fontWeight: 'bold',
    },
    aboutDevInfo: {
        marginLeft: 12,
    },
    aboutDevName: {
        fontSize: 18,
        fontWeight: 'bold',
    },
    aboutDevRole: {
        fontSize: 14,
    },
    aboutCopyright: {
        fontSize: 12,
        textAlign: 'center',
        marginBottom: 4,
    },
    aboutMadeWith: {
        fontSize: 12,
        textAlign: 'center',
        marginBottom: 40,
    },
});


=======================================================
FILE: app\student-profile.tsx
=======================================================

import { useTheme } from '@/context/ThemeContext';
import { Ionicons } from '@expo/vector-icons';
import { BlurView } from 'expo-blur';
import { LinearGradient } from 'expo-linear-gradient';
import { useRouter } from 'expo-router';
import React, { useEffect, useState } from 'react';
import { Dimensions, Image, Pressable, StyleSheet, Text, TouchableOpacity, View } from 'react-native';
import Animated, { interpolate, useAnimatedStyle, useSharedValue, withRepeat, withTiming } from 'react-native-reanimated';

import { AuthService, StudentProfile } from '../services/auth';

const { width } = Dimensions.get('window');

export default function StudentProfileScreen() {
    const router = useRouter();
    useTheme();
    const [profile, setProfile] = useState<StudentProfile | null>(null);
    const shimmerValue = useSharedValue(-1);

    useEffect(() => {
        const loadProfile = async () => {
            const data = await AuthService.getProfile();
            setProfile(data);
        };
        loadProfile();

        shimmerValue.value = withRepeat(
            withTiming(1, { duration: 2500 }),
            -1,
            false
        );
    }, [shimmerValue]);



    const shimmerStyle = useAnimatedStyle(() => {
        return {
            transform: [
                { translateX: interpolate(shimmerValue.value, [-1, 1], [-width, width]) }
            ],
            opacity: 0.3
        };
    });

    return (
        <View style={styles.container}>
            {/* Backdrop Blur & Overlay */}
            <BlurView intensity={50} tint="dark" style={StyleSheet.absoluteFill} />
            <View style={[StyleSheet.absoluteFill, { backgroundColor: 'rgba(0,0,0,0.45)' }]} />

            <Pressable style={StyleSheet.absoluteFill} onPress={() => router.back()} />

            <View style={styles.modalContent}>
                {/* Header */}
                <View style={styles.header}>
                    <Text style={styles.title}>Student Identity</Text>
                    <TouchableOpacity onPress={() => router.back()} style={styles.closeBtn}>
                        <Ionicons name="close-circle" size={36} color="rgba(255,255,255,0.8)" />
                    </TouchableOpacity>
                </View>

                {/* Card Container */}
                <View style={styles.cardContainer}>

                    {/* ID Card */}
                    <View style={styles.idCard}>
                        <LinearGradient
                            colors={['#0f172a', '#1e293b', '#0f172a']} // Dark Slate Premium
                            start={{ x: 0, y: 0 }} end={{ x: 1, y: 1 }}
                            style={styles.cardGradient}
                        >
                            {/* Watermark */}
                            <View style={styles.watermarkContainer}>
                                <Ionicons name="school" size={200} color="rgba(255,255,255,0.03)" />
                            </View>

                            {/* Gold Header Stripe */}
                            <LinearGradient
                                colors={['#FFD700', '#FDB931', '#FFD700']}
                                start={{ x: 0, y: 0 }} end={{ x: 1, y: 0 }}
                                style={styles.goldStripe}
                            />

                            <View style={styles.contentPadding}>
                                <View style={styles.collegeHeader}>
                                    <View style={styles.logoCircle}>
                                        <Ionicons name="school" size={20} color="#0f172a" />
                                    </View>
                                    <View>
                                        <Text style={styles.collegeName}>NRCM ENGINEERING</Text>
                                        <Text style={styles.collegeSub}>Autonomous Institution</Text>
                                    </View>
                                </View>

                                <View style={styles.cardBody}>
                                    <View style={styles.photoFrame}>
                                        {profile?.profileImage ? (
                                            <Image source={{ uri: profile.profileImage }} style={styles.photo} />
                                        ) : (
                                            <View style={styles.photoPlaceholder}>
                                                <Ionicons name="person" size={50} color="#94a3b8" />
                                            </View>
                                        )}
                                        {/* Verified Badge */}
                                        <View style={styles.verifiedBadge}>
                                            <Ionicons name="checkmark-circle" size={20} color="#4ade80" />
                                        </View>
                                    </View>

                                    <View style={styles.details}>
                                        <Text style={styles.studentName}>{profile?.name || 'LOADING...'}</Text>
                                        <Text style={styles.rollNo}>{profile?.rollNo || '...'}</Text>
                                        <View style={styles.pillRow}>
                                            <LinearGradient colors={['#3b82f6', '#2563eb']} style={styles.pill}>
                                                <Text style={styles.pillText}>{profile?.year ? `YEAR ${profile.year}` : 'Student'}</Text>
                                            </LinearGradient>
                                            <View style={[styles.pill, { backgroundColor: 'rgba(255,255,255,0.1)' }]}>
                                                <Text style={styles.pillText}>{profile?.department || 'N/A'}</Text>
                                            </View>
                                        </View>
                                    </View>
                                </View>

                                <View style={styles.divider} />

                                <View style={styles.footerRow}>
                                    <View style={styles.footerInfo}>
                                        <View style={styles.infoBlock}>
                                            <Text style={styles.footerLabel}>VALID UNTIL</Text>
                                            <Text style={styles.footerValue}>{`MAY ${new Date().getFullYear() + 4}`}</Text>
                                        </View>
                                        <View style={styles.dividerVertical} />
                                        <View style={styles.infoBlock}>
                                            <Text style={styles.footerLabel}>ROLL NO</Text>
                                            <Text style={styles.footerValue}>{profile?.rollNo || '...'}</Text>
                                        </View>
                                    </View>
                                </View>
                            </View>

                            {/* Holographic Shine Overlay */}
                            <Animated.View style={[StyleSheet.absoluteFill, shimmerStyle]} pointerEvents="none">
                                <LinearGradient
                                    colors={['transparent', 'rgba(255,255,255,0.1)', 'rgba(255,255,255,0.4)', 'rgba(255,255,255,0.1)', 'transparent']}
                                    start={{ x: 0, y: 0 }}
                                    end={{ x: 1, y: 1 }}
                                    style={{ flex: 1, transform: [{ skewX: '-20deg' }] }}
                                />
                            </Animated.View>

                        </LinearGradient>
                    </View>
                </View>

            </View>
        </View>
    );
}

const styles = StyleSheet.create({
    container: {
        flex: 1,
        justifyContent: 'center',
        alignItems: 'center',
    },
    modalContent: {
        width: width * 0.95,
        alignItems: 'center',
    },
    header: {
        flexDirection: 'row',
        justifyContent: 'space-between',
        width: '100%',
        marginBottom: 24,
        alignItems: 'center',
        paddingHorizontal: 12,
    },
    title: {
        fontSize: 22,
        fontWeight: '700',
        color: '#fff',
        letterSpacing: 0.5,
        textTransform: 'uppercase',
        opacity: 0.9,
    },
    closeBtn: {
        opacity: 0.8
    },

    // Card Styles
    cardContainer: {
        width: width * 0.88,
        aspectRatio: 0.65, // Standard ID Card ratio (approx)
        shadowColor: '#000',
        shadowOffset: { width: 0, height: 20 },
        shadowOpacity: 0.6,
        shadowRadius: 30,
        elevation: 20,
    },
    idCard: {
        flex: 1,
        borderRadius: 24,
        overflow: 'hidden',
        borderWidth: 1,
        borderColor: 'rgba(255,255,255,0.15)',
        backgroundColor: '#0f172a',
    },
    cardGradient: {
        flex: 1,
    },
    goldStripe: {
        height: 6,
        width: '100%',
    },
    contentPadding: {
        flex: 1,
        padding: 24,
    },
    watermarkContainer: {
        position: 'absolute',
        bottom: -50,
        right: -50,
        opacity: 0.1,
        transform: [{ rotate: '-15deg' }]
    },

    collegeHeader: {
        flexDirection: 'row',
        alignItems: 'center',
        marginBottom: 30,
        gap: 12,
    },
    logoCircle: {
        width: 36,
        height: 36,
        borderRadius: 18,
        backgroundColor: '#FFD700', // Gold
        justifyContent: 'center',
        alignItems: 'center',
    },
    collegeName: {
        color: '#fff',
        fontWeight: 'bold',
        fontSize: 14,
        letterSpacing: 1.5,
    },
    collegeSub: {
        color: 'rgba(255,255,255,0.5)',
        fontSize: 10,
        textTransform: 'uppercase',
        letterSpacing: 2,
    },

    cardBody: {
        alignItems: 'center',
        marginBottom: 20,
    },
    photoFrame: {
        width: 140,
        height: 140,
        borderRadius: 70,
        borderWidth: 4,
        borderColor: '#FFD700',
        padding: 4,
        marginBottom: 20,
        position: 'relative',
        shadowColor: '#000',
        shadowOpacity: 0.5,
        shadowRadius: 10,
    },
    photo: {
        width: '100%',
        height: '100%',
        borderRadius: 66,
        backgroundColor: '#e2e8f0',
    },
    photoPlaceholder: {
        width: '100%',
        height: '100%',
        borderRadius: 66,
        backgroundColor: '#1e293b',
        justifyContent: 'center',
        alignItems: 'center',
    },
    verifiedBadge: {
        position: 'absolute',
        bottom: 0,
        right: 0,
        backgroundColor: '#fff',
        borderRadius: 12,
        padding: 2,
    },

    details: {
        alignItems: 'center',
        width: '100%',
    },
    studentName: {
        color: '#fff',
        fontSize: 24,
        fontWeight: '800',
        textAlign: 'center',
        marginBottom: 6,
        letterSpacing: 0.5,
    },
    rollNo: {
        color: '#94a3b8',
        fontSize: 16,
        fontFamily: 'monospace', // Tech feel
        letterSpacing: 2,
        marginBottom: 16,
    },
    pillRow: {
        flexDirection: 'row',
        gap: 10,
    },
    pill: {
        paddingHorizontal: 14,
        paddingVertical: 6,
        borderRadius: 20,
        borderWidth: 1,
        borderColor: 'rgba(255,255,255,0.1)',
    },
    pillText: {
        color: '#fff',
        fontSize: 11,
        fontWeight: 'bold',
        textTransform: 'uppercase',
    },

    divider: {
        height: 1,
        backgroundColor: 'rgba(255,255,255,0.1)',
        width: '100%',
        marginBottom: 20,
    },

    footerRow: {
        flexDirection: 'row',
        justifyContent: 'center',
        alignItems: 'center',
        marginTop: 10,
    },
    footerInfo: {
        flexDirection: 'row',
        alignItems: 'center',
        gap: 20,
    },
    infoBlock: {
        alignItems: 'center',
    },
    dividerVertical: {
        width: 1,
        height: 24,
        backgroundColor: 'rgba(255,255,255,0.2)',
    },
    footerLabel: {
        color: 'rgba(255,255,255,0.5)',
        fontSize: 10,
        fontWeight: '700',
        marginBottom: 4,
        letterSpacing: 1,
    },
    footerValue: {
        color: '#fff',
        fontSize: 14,
        fontWeight: '600',
        letterSpacing: 0.5,
    },
});


=======================================================
FILE: app\_layout.tsx
=======================================================

import { DarkTheme, DefaultTheme, ThemeProvider } from '@react-navigation/native';
import { Stack } from 'expo-router';
import * as SplashScreen from 'expo-splash-screen';
import { useEffect } from 'react';
import { GestureHandlerRootView } from 'react-native-gesture-handler';
import 'react-native-reanimated';

import { useColorScheme } from '@/hooks/use-color-scheme';
import { ErrorBoundary } from '../components/ErrorBoundary';
import { ResultsProvider } from '../context/ResultsContext';
import { ThemeProvider as CustomThemeProvider } from '../context/ThemeContext';

// Prevent the splash screen from auto-hiding before asset loading is complete.
SplashScreen.preventAutoHideAsync();

export default function RootLayout() {
  const colorScheme = useColorScheme();
  /* Font loading removed as assets/fonts/SpaceMono-Regular.ttf is missing */
  const loaded = true;

  useEffect(() => {
    const prepare = async () => {
      // Small delay so splash logo is visible before fade-out
      await new Promise(resolve => setTimeout(resolve, 300));
      await SplashScreen.hideAsync();
    };

    if (loaded) {
      prepare();

      // Register background tasks and permissions
      const initBackgroundTasks = async () => {
        const { registerBackgroundFetchAsync } = await import('../services/BackgroundFetchService');
        const { NotificationService } = await import('../services/notification');

        await NotificationService.registerForPushNotificationsAsync();
        await registerBackgroundFetchAsync();

        // Initialize Daily Notification with cached data
        const { AttendanceService } = await import('../services/attendance');
        const { STORAGE_KEYS, loadData } = await import('../utils/storage');
        const cachedAttendance = await loadData(STORAGE_KEYS.ATTENDANCE);

        if (cachedAttendance?.overallPercentage) {
          await NotificationService.scheduleDailySummary(cachedAttendance.overallPercentage);
        } else {
          // Try to fetch if nothing cached
          try {
            const newAtt = await AttendanceService.getAttendance();
            if (newAtt?.overallPercentage) {
              await NotificationService.scheduleDailySummary(newAtt.overallPercentage);
            }
          } catch {
            // No data available yet for daily notification
          }
        }
      };

      initBackgroundTasks();
    }
  }, [loaded]);

  if (!loaded) {
    return null;
  }

  return (
    <ErrorBoundary>
      <GestureHandlerRootView style={{ flex: 1 }}>
        <CustomThemeProvider>
          <ResultsProvider>
            <ThemeProvider value={colorScheme === 'dark' ? DarkTheme : DefaultTheme}>
              <Stack>
                <Stack.Screen name="index" options={{ headerShown: false }} />
                <Stack.Screen name="onboarding" options={{ headerShown: false }} />
                <Stack.Screen name="login" options={{ headerShown: false }} />
                <Stack.Screen name="(tabs)" options={{ headerShown: false }} />
                <Stack.Screen
                  name="student-profile"
                  options={{
                    presentation: 'transparentModal',
                    animation: 'fade',
                    headerShown: false,
                  }}
                />
                <Stack.Screen
                  name="settings"
                  options={{
                    headerShown: false,
                    presentation: 'card',
                    animation: 'slide_from_right'
                  }}
                />
                <Stack.Screen name="+not-found" />
              </Stack>
            </ThemeProvider>
          </ResultsProvider>
        </CustomThemeProvider>
      </GestureHandlerRootView>
    </ErrorBoundary>
  );
}


=======================================================
FILE: app.json
=======================================================

{
  "expo": {
    "name": "Clgpo",
    "slug": "clgpo",
    "description": "College ERP companion app for attendance, results, and analytics",
    "version": "1.0.0",
    "orientation": "portrait",
    "icon": "./assets/images/Clgpo.png",
    "scheme": "clgpo",
    "userInterfaceStyle": "automatic",
    "ios": {
      "supportsTablet": true,
      "bundleIdentifier": "com.clgpo.app"
    },
    "android": {
      "adaptiveIcon": {
        "backgroundColor": "#E6F4FE",
        "foregroundImage": "./assets/images/Clgpo.png",
        "monochromeImage": "./assets/images/android-icon-monochrome.png"
      },
      "permissions": [
        "android.permission.INTERNET",
        "android.permission.ACCESS_NETWORK_STATE",
        "android.permission.POST_NOTIFICATIONS"
      ],
      "package": "com.clgpo.app",
      "versionCode": 1
    },
    "web": {
      "output": "static",
      "favicon": "./assets/images/Clgpo.png"
    },
    "plugins": [
      "expo-router",
      [
        "expo-splash-screen",
        {
          "image": "./assets/images/Clgpo.png",
          "imageWidth": 200,
          "resizeMode": "contain",
          "backgroundColor": "#ffffff",
          "dark": {
            "backgroundColor": "#0f0f1a"
          }
        }
      ],
      "expo-secure-store",
      "expo-background-task",
      "expo-font"
    ],
    "experiments": {
      "typedRoutes": true
    },
    "extra": {
      "router": {},
      "eas": {
        "projectId": "18b5494c-80c6-40e6-bcea-5e39faa54442"
      }
    }
  }
}


=======================================================
FILE: babel.config.js
=======================================================

module.exports = function (api) {
    api.cache(true);
    return {
        presets: ['babel-preset-expo'],
        plugins: ['react-native-reanimated/plugin'],
    };
};


=======================================================
FILE: components\animated-tab-bar.tsx
=======================================================

import { Ionicons } from '@expo/vector-icons';
import { BottomTabBarProps } from '@react-navigation/bottom-tabs';
import * as Haptics from 'expo-haptics';
import React from 'react';
import { Pressable, StyleSheet, View } from 'react-native';
import Animated, {
    Extrapolation,
    SharedValue,
    interpolate,
    interpolateColor,
    useAnimatedStyle,
    useSharedValue,
    withSpring,
} from 'react-native-reanimated';
import { useSafeAreaInsets } from 'react-native-safe-area-context';

interface TabConfig {
    icon: keyof typeof Ionicons.glyphMap;
    activeIcon: keyof typeof Ionicons.glyphMap;
    label: string;
}

const TAB_CONFIG: Record<string, TabConfig> = {
    index: {
        icon: 'home-outline',
        activeIcon: 'home',
        label: 'Home',
    },
    login: {
        icon: 'log-in-outline',
        activeIcon: 'log-in',
        label: 'Login',
    },
    explore: {
        icon: 'calendar-outline',
        activeIcon: 'calendar',
        label: 'Calendar',
    },
    predict: {
        icon: 'flag-outline',
        activeIcon: 'flag',
        label: 'Goals',
    },
};

const AnimatedPressable = Animated.createAnimatedComponent(Pressable);

interface TabBarItemProps {
    route: any;
    index: number;
    state: any;
    descriptors: any;
    navigation: any;
    activeIndex: SharedValue<number>;
}

function TabBarItem({ route, index, state, descriptors, navigation, activeIndex }: TabBarItemProps) {
    const { options } = descriptors[route.key];
    const isFocused = state.index === index;
    const config = TAB_CONFIG[route.name] || {
        icon: 'ellipse-outline' as const,
        activeIcon: 'ellipse' as const,
        label: options.title || route.name,
    };

    const onPress = () => {
        Haptics.impactAsync(Haptics.ImpactFeedbackStyle.Light);

        const event = navigation.emit({
            type: 'tabPress',
            target: route.key,
            canPreventDefault: true,
        });

        if (!isFocused && !event.defaultPrevented) {
            navigation.navigate(route.name);
        }
    };

    // Animated background style
    const animatedBgStyle = useAnimatedStyle(() => {
        const backgroundColor = interpolateColor(
            activeIndex.value,
            [index - 0.5, index, index + 0.5],
            ['transparent', '#3a3a3c', 'transparent']
        );

        const scale = interpolate(
            activeIndex.value,
            [index - 1, index, index + 1],
            [0.95, 1, 0.95],
            Extrapolation.CLAMP
        );

        return {
            backgroundColor,
            transform: [{ scale }],
        };
    });

    // Animated icon style
    const animatedIconStyle = useAnimatedStyle(() => {
        const scale = interpolate(
            activeIndex.value,
            [index - 0.3, index, index + 0.3],
            [1, 1.1, 1],
            Extrapolation.CLAMP
        );

        return {
            transform: [{ scale }],
        };
    });

    // Animated label style
    const animatedLabelStyle = useAnimatedStyle(() => {
        const opacity = interpolate(
            activeIndex.value,
            [index - 0.4, index, index + 0.4],
            [0, 1, 0],
            Extrapolation.CLAMP
        );
        const translateX = interpolate(
            activeIndex.value,
            [index - 0.4, index, index + 0.4],
            [-5, 0, 5],
            Extrapolation.CLAMP
        );

        return {
            opacity,
            transform: [{ translateX }],
        };
    });

    return (
        <AnimatedPressable
            accessibilityRole="button"
            accessibilityState={isFocused ? { selected: true } : {}}
            accessibilityLabel={options.tabBarAccessibilityLabel}
            onPress={onPress}
            style={[styles.tab, animatedBgStyle]}
        >
            <Animated.View style={animatedIconStyle}>
                <Ionicons
                    name={isFocused ? config.activeIcon : config.icon}
                    size={22}
                    color={isFocused ? '#fff' : '#666'}
                />
            </Animated.View>
            {isFocused && (
                <Animated.Text style={[styles.label, animatedLabelStyle]}>
                    {config.label}
                </Animated.Text>
            )}
        </AnimatedPressable>
    );
}

export function AnimatedTabBar({ state, descriptors, navigation }: BottomTabBarProps) {
    const activeIndex = useSharedValue(state.index);
    const insets = useSafeAreaInsets();

    React.useEffect(() => {
        activeIndex.value = withSpring(state.index, {
            damping: 18,
            stiffness: 180,
            mass: 0.6,
        });
    }, [state.index, activeIndex]);

    return (
        <View style={[styles.container, { bottom: 20 + insets.bottom }]}>
            <View style={styles.tabBar}>
                {state.routes.map((route, index) => {
                    // Filter out hidden routes if needed, but for now just render all
                    // We typically typically filter by options.title or similar if needed
                    // But here we just pass everything to TabBarItem

                    // IMPORTANT: Don't show the 'login' route in the tab bar if it accidentally got into the tab group
                    // But wait, the tab group only contains the screens defined in (tabs)/_layout.tsx
                    // app/login.tsx is OUTSIDE the (tabs) group so it won't appear here.
                    // However, 'index' (which we moved) is now 'login'.
                    // Wait, `app/(tabs)/index` still exists.
                    // `app/(tabs)/explore` exists.
                    // So we are good.

                    return (
                        <TabBarItem
                            key={route.key}
                            route={route}
                            index={index}
                            state={state}
                            descriptors={descriptors}
                            navigation={navigation}
                            activeIndex={activeIndex}
                        />
                    );
                })}
            </View>
        </View>
    );
}

const styles = StyleSheet.create({
    container: {
        position: 'absolute',
        left: 0,
        right: 0,
        alignItems: 'center',
        paddingHorizontal: 60,
    },
    tabBar: {
        flexDirection: 'row',
        backgroundColor: '#1c1c1e',
        borderRadius: 30,
        paddingHorizontal: 8,
        paddingVertical: 8,
        alignItems: 'center',
        justifyContent: 'center',
        gap: 6,
        shadowColor: '#000',
        shadowOffset: { width: 0, height: 6 },
        shadowOpacity: 0.3,
        shadowRadius: 12,
        elevation: 10,
        borderWidth: 1,
        borderColor: 'rgba(255,255,255,0.1)',
    },
    tab: {
        flexDirection: 'row',
        alignItems: 'center',
        justifyContent: 'center',
        height: 46,
        paddingHorizontal: 18,
        borderRadius: 23,
        gap: 8,
    },
    label: {
        color: '#fff',
        fontSize: 14,
        fontWeight: '600',
    },
});


=======================================================
FILE: components\AnimatedNumber.tsx
=======================================================

import React, { useEffect, useState } from 'react';
import { Text, TextProps, TextStyle } from 'react-native';
import {
    Easing,
    runOnJS,
    useAnimatedReaction,
    useSharedValue,
    withTiming,
} from 'react-native-reanimated';

interface AnimatedNumberProps extends TextProps {
    value: number;
    style?: TextStyle | TextStyle[];
    duration?: number;
    prefix?: string;
    suffix?: string;
    isInt?: boolean; // If true, rounds to integer
}

export const AnimatedNumber: React.FC<AnimatedNumberProps> = ({
    value,
    style,
    duration = 800,
    prefix = '',
    suffix = '',
    isInt = true,
    ...rest
}) => {
    const sv = useSharedValue(0);
    const [displayValue, setDisplayValue] = useState(prefix + '0' + suffix);

    useEffect(() => {
        sv.value = withTiming(value, {
            duration,
            easing: Easing.out(Easing.exp),
        });
    }, [value, duration, sv]);

    useAnimatedReaction(
        () => sv.value,
        (currentValue) => {
            const formatted = isInt
                ? Math.round(currentValue).toString()
                : currentValue.toFixed(1);
            runOnJS(setDisplayValue)(prefix + formatted + suffix);
        }
    );

    return (
        <Text style={style} {...rest}>
            {displayValue}
        </Text>
    );
};


=======================================================
FILE: components\DonutChart.tsx
=======================================================

import { useTheme } from '@/context/ThemeContext';
import React, { useEffect } from 'react';
import { StyleSheet, Text, View } from 'react-native';
import Animated, { useAnimatedProps, useSharedValue, withDelay, withTiming } from 'react-native-reanimated';
import Svg, { Circle, G } from 'react-native-svg';

const AnimatedCircle = Animated.createAnimatedComponent(Circle);

interface DonutChartProps {
    percentage: number;
    radius?: number;
    strokeWidth?: number;
    color?: string;
    max?: number;
}

export default function DonutChart({
    percentage,
    radius = 40,
    strokeWidth = 10,
    color,
    max = 100
}: DonutChartProps) {
    const { colors } = useTheme();
    const activeColor = color || colors.primary;
    const passiveColor = colors.cardBorder || '#E0E0E0';

    const halfCircle = radius + strokeWidth;
    const circumference = 2 * Math.PI * radius;

    const animatedValue = useSharedValue(0);

    useEffect(() => {
        // Animate to target percentage
        // Clamp between 0 and max
        const target = Math.min(Math.max(percentage, 0), max);
        animatedValue.value = withDelay(500, withTiming(target, { duration: 1500 }));
    }, [percentage, max, animatedValue]);

    const animatedProps = useAnimatedProps(() => {
        const strokeDashoffset = circumference - (circumference * animatedValue.value) / max;
        return {
            strokeDashoffset,
        };
    });

    return (
        <View style={{ width: halfCircle * 2, height: halfCircle * 2, alignItems: 'center', justifyContent: 'center' }}>
            <Svg
                width={radius * 2 + strokeWidth * 2}
                height={radius * 2 + strokeWidth * 2}
                viewBox={`0 0 ${halfCircle * 2} ${halfCircle * 2}`}
            >
                <G rotation="-90" origin={`${halfCircle}, ${halfCircle}`}>
                    <Circle
                        cx="50%"
                        cy="50%"
                        r={radius}
                        stroke={passiveColor}
                        strokeWidth={strokeWidth}
                        strokeOpacity={0.2}
                        fill="transparent"
                    />
                    <AnimatedCircle
                        cx="50%"
                        cy="50%"
                        r={radius}
                        stroke={activeColor}
                        strokeWidth={strokeWidth}
                        strokeDasharray={circumference}
                        animatedProps={animatedProps}
                        strokeLinecap="round"
                        fill="transparent"
                    />
                </G>
            </Svg>
            <View style={[StyleSheet.absoluteFillObject, { alignItems: 'center', justifyContent: 'center' }]}>
                <Text style={{ fontSize: radius * 0.5, fontWeight: 'bold', color: colors.text }}>
                    {percentage.toFixed(1)}%
                </Text>
            </View>
        </View>
    );
}


=======================================================
FILE: components\ErrorBoundary.tsx
=======================================================

import React, { Component, ErrorInfo, ReactNode } from 'react';
import { StyleSheet, Text, TouchableOpacity, View } from 'react-native';

interface Props {
    children: ReactNode;
}

interface State {
    hasError: boolean;
    error: Error | null;
}

export class ErrorBoundary extends Component<Props, State> {
    constructor(props: Props) {
        super(props);
        this.state = { hasError: false, error: null };
    }

    static getDerivedStateFromError(error: Error): State {
        return { hasError: true, error };
    }

    componentDidCatch(_error: Error, _info: ErrorInfo) {
        // Error logged for crash analytics in the future
    }

    handleRestart = () => {
        this.setState({ hasError: false, error: null });
    };

    render() {
        if (this.state.hasError) {
            return (
                <View style={styles.container}>
                    <Text style={styles.emoji}>üòµ</Text>
                    <Text style={styles.title}>Something went wrong</Text>
                    <Text style={styles.subtitle}>
                        The app ran into an unexpected error. Please restart to continue.
                    </Text>
                    <TouchableOpacity style={styles.button} onPress={this.handleRestart}>
                        <Text style={styles.buttonText}>Restart App</Text>
                    </TouchableOpacity>
                </View>
            );
        }

        return this.props.children;
    }
}

const styles = StyleSheet.create({
    container: {
        flex: 1,
        justifyContent: 'center',
        alignItems: 'center',
        backgroundColor: '#0f0f1a',
        padding: 32,
    },
    emoji: {
        fontSize: 64,
        marginBottom: 16,
    },
    title: {
        fontSize: 24,
        fontWeight: '700',
        color: '#ffffff',
        marginBottom: 12,
        textAlign: 'center',
    },
    subtitle: {
        fontSize: 15,
        color: 'rgba(255,255,255,0.6)',
        textAlign: 'center',
        lineHeight: 22,
        marginBottom: 32,
        maxWidth: 280,
    },
    button: {
        backgroundColor: '#6366f1',
        paddingHorizontal: 32,
        paddingVertical: 14,
        borderRadius: 12,
    },
    buttonText: {
        color: '#ffffff',
        fontSize: 16,
        fontWeight: '600',
    },
});


=======================================================
FILE: components\OfflineIndicator.tsx
=======================================================


import { Ionicons } from '@expo/vector-icons';
import React from 'react';
import { StyleSheet, Text } from 'react-native';
import Animated, { FadeInDown, FadeOutUp } from 'react-native-reanimated';

interface OfflineIndicatorProps {
    isOffline: boolean;
    colors: any;
}

export const OfflineIndicator = ({ isOffline, colors }: OfflineIndicatorProps) => {
    if (!isOffline) return null;

    return (
        <Animated.View
            entering={FadeInDown.duration(300)}
            exiting={FadeOutUp.duration(300)}
            style={[styles.container, { backgroundColor: colors.warning || '#f59e0b' }]}
        >
            <Ionicons name="cloud-offline-outline" size={16} color="#fff" />
            <Text style={styles.text}>Offline - Showing cached data</Text>
        </Animated.View>
    );
};

const styles = StyleSheet.create({
    container: {
        flexDirection: 'row',
        alignItems: 'center',
        justifyContent: 'center',
        paddingVertical: 8,
        paddingHorizontal: 16,
        gap: 8,
    },
    text: {
        color: '#fff',
        fontSize: 13,
        fontWeight: '600',
    },
});


=======================================================
FILE: components\ResultsEnhancements.tsx
=======================================================

import { Ionicons } from '@expo/vector-icons';
import { LinearGradient } from 'expo-linear-gradient';
import React, { useMemo, useState } from 'react';
import { Dimensions, StyleSheet, Text, View } from 'react-native';
import { Slider } from 'react-native-awesome-slider';
import { useSharedValue } from 'react-native-reanimated';
import { Circle, Defs, Line, Path, Stop, Svg, LinearGradient as SvgGradient, Text as SvgText } from 'react-native-svg';
import { SemesterResult } from '../services/results';

const { width } = Dimensions.get('window');
const CHART_WIDTH = width - 48; // Padding
const CHART_HEIGHT = 180;

// --- GPA Trend Chart ---
export const GPATrendChart = ({ semesters, colors }: { semesters: SemesterResult[], colors: any }) => {
    const data = useMemo(() => {
        return semesters
            .map(s => {
                const sgpa = parseFloat(s.sgpa);
                // Shorten semester label logic
                // e.g. "I/IV I SEM" -> "1-1", "I SEM" -> "1", "Semester 1" -> "1"
                let label = s.semester.replace(/Semester/i, '').trim();

                // Try to detect Year/Sem pattern like "I/IV I SEM" (1st Year, 1st Sem of 4)
                const romMap: { [key: string]: string } = { 'I': '1', 'II': '2', 'III': '3', 'IV': '4' };
                const parts = label.split(/[\/\s-]+/);

                if (parts.length >= 2) {
                    // Heuristic: Check if parts are Roman numerals
                    const year = romMap[parts[0]] || parts[0];
                    const sem = romMap[parts[1]] || parts[1];
                    // If we found valid conversions, use them
                    if ((parseInt(year) || romMap[parts[0]]) && (parseInt(sem) || romMap[parts[1]])) {
                        label = `${year}-${sem}`;
                    }
                } else if (romMap[label]) {
                    label = romMap[label];
                }

                return {
                    originalLabel: s.semester,
                    label: label.length > 5 ? label.substring(0, 4) + '..' : label, // Fallback truncate
                    value: isNaN(sgpa) ? 0 : sgpa
                };
            });
    }, [semesters]);

    if (data.length < 2) return null;

    const SIDE_PADDING = 30;
    const VERTICAL_PADDING = 20;
    const GRAPH_WIDTH = CHART_WIDTH - (SIDE_PADDING * 2);
    const GRAPH_HEIGHT = CHART_HEIGHT - (VERTICAL_PADDING * 2);

    // Y-Axis Scale
    const maxVal = 10;
    const minVal = 4;

    const getX = (index: number) => SIDE_PADDING + (index / (data.length - 1)) * GRAPH_WIDTH;
    const getY = (value: number) => VERTICAL_PADDING + GRAPH_HEIGHT - ((value - minVal) / (maxVal - minVal)) * GRAPH_HEIGHT;

    const points = data.map((d, i) => ({ x: getX(i), y: getY(d.value), value: d.value, label: d.label }));

    // Bezier Curve Logic
    const getBezierPath = (pts: typeof points) => {
        if (pts.length === 0) return '';
        if (pts.length === 1) return `M ${pts[0].x} ${pts[0].y}`;
        let d = `M ${pts[0].x} ${pts[0].y}`;
        for (let i = 0; i < pts.length - 1; i++) {
            const current = pts[i];
            const next = pts[i + 1];
            const controlX1 = current.x + (next.x - current.x) / 2;
            const controlY1 = current.y;
            const controlX2 = current.x + (next.x - current.x) / 2;
            const controlY2 = next.y;
            d += ` C ${controlX1} ${controlY1} ${controlX2} ${controlY2} ${next.x} ${next.y}`;
        }
        return d;
    };

    const pathD = getBezierPath(points);
    const fillPath = `${pathD} L ${points[points.length - 1].x} ${CHART_HEIGHT} L ${points[0].x} ${CHART_HEIGHT} Z`;

    return (
        <View style={[styles.card, { backgroundColor: colors.card, marginBottom: 20 }]}>
            <View style={{ padding: 16, borderBottomWidth: 1, borderBottomColor: colors.border || '#eee' }}>
                <Text style={{ color: colors.textSecondary, fontSize: 13, fontWeight: '700', letterSpacing: 0.5 }}>ACADEMIC PERFORMANCE</Text>
            </View>
            <View style={{ paddingVertical: 20, alignItems: 'center' }}>
                <Svg width={CHART_WIDTH} height={CHART_HEIGHT + 20}>
                    <Defs>
                        <SvgGradient id="grad" x1="0" y1="0" x2="0" y2="1">
                            <Stop offset="0" stopColor={colors.primary} stopOpacity="0.4" />
                            <Stop offset="1" stopColor={colors.primary} stopOpacity="0" />
                        </SvgGradient>
                    </Defs>

                    {/* Grid Lines */}
                    {[5, 6, 7, 8, 9, 10].map(val => (
                        <Line
                            key={val}
                            x1={SIDE_PADDING} y1={getY(val)}
                            x2={CHART_WIDTH - SIDE_PADDING} y2={getY(val)}
                            stroke={colors.textSecondary}
                            strokeWidth="1"
                            strokeOpacity="0.1"
                            strokeDasharray="4,4"
                        />
                    ))}

                    <Path d={fillPath} fill="url(#grad)" />
                    <Path d={pathD} stroke={colors.primary} strokeWidth="3" fill="none" />

                    {points.map((p, i) => (
                        <React.Fragment key={i}>
                            <Circle cx={p.x} cy={p.y} r="5" fill={colors.card} stroke={colors.primary} strokeWidth="2" />

                            {/* Value Label - Positioned with collision check */}
                            <SvgText
                                x={p.x}
                                y={p.y - 12}
                                fill={colors.text}
                                fontSize="12"
                                fontWeight="bold"
                                textAnchor="middle"
                            >
                                {p.value.toFixed(2)}
                            </SvgText>

                            {/* Semester Label */}
                            <SvgText
                                x={p.x}
                                y={CHART_HEIGHT + 15}
                                fill={colors.textSecondary}
                                fontSize="11"
                                fontWeight="500"
                                textAnchor="middle"
                            >
                                {p.label}
                            </SvgText>
                        </React.Fragment>
                    ))}
                </Svg>
            </View>
        </View>
    );
};

// --- Backlog Tracker ---
export const BacklogTracker = ({ semesters, colors }: { semesters: SemesterResult[], colors: any }) => {
    const backlogs = useMemo(() => {
        const fails: { subject: string, code: string, semester: string }[] = [];
        semesters.forEach(sem => {
            sem.subjects.forEach(sub => {
                // Check fail condition (F grade, absent, or explicitly 'F' result)
                const isFail = sub.result.toUpperCase() === 'F' ||
                    sub.grade.toUpperCase() === 'F' ||
                    sub.grade.toLowerCase() === 'ab';

                if (isFail) {
                    fails.push({
                        subject: sub.subjectName,
                        code: sub.subjectCode,
                        semester: sem.semester
                    });
                }
            });
        });
        return fails;
    }, [semesters]);

    if (backlogs.length === 0) return (
        <View style={[styles.card, { backgroundColor: colors.card, borderColor: colors.success + '40', borderWidth: 1, marginBottom: 20 }]}>
            <View style={{ flexDirection: 'row', alignItems: 'center', padding: 16 }}>
                <View style={{
                    width: 48, height: 48, borderRadius: 24,
                    backgroundColor: colors.success + '15',
                    justifyContent: 'center', alignItems: 'center',
                    marginRight: 16
                }}>
                    <Ionicons name="shield-checkmark" size={28} color={colors.success} />
                </View>
                <View style={{ flex: 1 }}>
                    <Text style={{ color: colors.success, fontSize: 18, fontWeight: 'bold' }}>All Clear!</Text>
                    <Text style={{ color: colors.text, opacity: 0.7, fontSize: 13, marginTop: 2 }}>No active backlogs. Keep it up! üéâ</Text>
                </View>
            </View>
        </View>
    );

    return (
        <View style={[styles.card, { backgroundColor: colors.card, marginBottom: 20, borderColor: colors.error, borderWidth: 1 }]}>
            <View style={{ padding: 16, borderBottomWidth: 1, borderBottomColor: colors.border || 'rgba(0,0,0,0.1)', flexDirection: 'row', justifyContent: 'space-between', alignItems: 'center' }}>
                <Text style={{ color: colors.error, fontSize: 13, fontWeight: '700', letterSpacing: 0.5 }}>ACTIVE BACKLOGS ({backlogs.length})</Text>
                <Ionicons name="warning" size={18} color={colors.error} />
            </View>
            <View style={{ padding: 16 }}>
                {backlogs.map((b, i) => (
                    <View key={i} style={{ flexDirection: 'row', alignItems: 'center', marginBottom: i === backlogs.length - 1 ? 0 : 12 }}>
                        <View style={{ width: 8, height: 8, borderRadius: 4, backgroundColor: colors.error, marginRight: 12 }} />
                        <View style={{ flex: 1 }}>
                            <Text style={{ color: colors.text, fontWeight: '600', fontSize: 14 }}>{b.subject}</Text>
                            <Text style={{ color: colors.textSecondary, fontSize: 12, marginTop: 2 }}>{b.code} ‚Ä¢ {b.semester}</Text>
                        </View>
                    </View>
                ))}
            </View>
        </View>
    );
};

// --- What-If Calculator ---
export const WhatIfCalculator = ({ cgpa, semesters, colors }: { cgpa: string, semesters: SemesterResult[], colors: any }) => {
    const [nextSemSGPA, setNextSemSGPA] = useState(8.5);
    const [nextSemCredits, setNextSemCredits] = useState(21);

    // Shared values for sliders
    const sgpaProgress = useSharedValue(8.5);
    const sgpaMin = useSharedValue(0);
    const sgpaMax = useSharedValue(10);

    const creditsProgress = useSharedValue(21);
    const creditsMin = useSharedValue(15);
    const creditsMax = useSharedValue(30);

    const currentCGPA = parseFloat(cgpa);

    // Calculate total credits so far
    const totalCredits = useMemo(() => {
        return semesters.reduce((acc, sem) => {
            // Try parsed total credits first, else sum subjects
            // Note: Parser might not set totalCredits, so we look at subjects
            let semCredits = 0;
            if (sem.totalCredits) {
                semCredits = parseFloat(sem.totalCredits);
            } else {
                semCredits = sem.subjects.reduce((sum, sub) => {
                    const c = parseFloat(sub.credits);
                    return !isNaN(c) ? sum + c : sum;
                }, 0);
            }
            return acc + (isNaN(semCredits) ? 0 : semCredits);
        }, 0);
    }, [semesters]);

    if (isNaN(currentCGPA)) return null;

    const newCGPA = ((currentCGPA * totalCredits) + (nextSemSGPA * nextSemCredits)) / (totalCredits + nextSemCredits);
    const diff = newCGPA - currentCGPA;

    return (
        <View style={[styles.card, { backgroundColor: colors.card, marginBottom: 20 }]}>
            <LinearGradient
                colors={[colors.primary + '10', colors.background]}
                style={{ padding: 16 }}
            >
                <View style={{ flexDirection: 'row', justifyContent: 'space-between', alignItems: 'center', marginBottom: 16 }}>
                    <Text style={{ color: colors.primary, fontSize: 13, fontWeight: '700', letterSpacing: 0.5 }}>WHAT-IF CALCULATOR üîÆ</Text>
                    <View style={{ paddingHorizontal: 8, paddingVertical: 2, backgroundColor: colors.primary, borderRadius: 10 }}>
                        <Text style={{ color: '#fff', fontSize: 10, fontWeight: 'bold' }}>NEXT SEMESTER</Text>
                    </View>
                </View>

                {/* Next SGPA Slider */}
                <View style={{ marginBottom: 20 }}>
                    <View style={{ flexDirection: 'row', justifyContent: 'space-between', marginBottom: 8 }}>
                        <Text style={{ color: colors.textSecondary, fontSize: 12 }}>Target SGPA</Text>
                        <Text style={{ color: colors.text, fontWeight: 'bold' }}>{nextSemSGPA.toFixed(1)}</Text>
                    </View>
                    <Slider
                        style={{ width: '100%', height: 30 }}
                        progress={sgpaProgress}
                        minimumValue={sgpaMin}
                        maximumValue={sgpaMax}
                        onValueChange={(val) => setNextSemSGPA(Math.round(val * 10) / 10)}
                        theme={{
                            minimumTrackTintColor: colors.primary,
                            maximumTrackTintColor: colors.border || '#ccc',
                            bubbleBackgroundColor: '#0000',
                        }}
                        thumbWidth={16}
                        renderBubble={() => null}
                    />
                </View>

                {/* Credits Slider */}
                <View style={{ marginBottom: 20 }}>
                    <View style={{ flexDirection: 'row', justifyContent: 'space-between', marginBottom: 8 }}>
                        <Text style={{ color: colors.textSecondary, fontSize: 12 }}>Credits</Text>
                        <Text style={{ color: colors.text, fontWeight: 'bold' }}>{nextSemCredits}</Text>
                    </View>
                    <Slider
                        style={{ width: '100%', height: 30 }}
                        progress={creditsProgress}
                        minimumValue={creditsMin}
                        maximumValue={creditsMax}
                        step={1}
                        onValueChange={(val) => setNextSemCredits(val)}
                        theme={{
                            minimumTrackTintColor: colors.textSecondary,
                            maximumTrackTintColor: colors.border || '#ccc',
                            bubbleBackgroundColor: '#0000',
                        }}
                        thumbWidth={16}
                        renderBubble={() => null}
                    />
                </View>

                <View style={{ borderTopWidth: 1, borderTopColor: colors.border || 'rgba(0,0,0,0.05)', paddingTop: 16, flexDirection: 'row', justifyContent: 'space-between', alignItems: 'center' }}>
                    <View>
                        <Text style={{ color: colors.textSecondary, fontSize: 12 }}>Predicted CGPA</Text>
                        <View style={{ flexDirection: 'row', alignItems: 'baseline' }}>
                            <Text style={{ color: colors.text, fontSize: 24, fontWeight: 'bold' }}>{newCGPA.toFixed(2)}</Text>
                            <Text style={{
                                color: diff >= 0 ? colors.success : colors.error,
                                fontSize: 13,
                                marginLeft: 8,
                                fontWeight: '600'
                            }}>
                                {diff >= 0 ? '‚Üë' : '‚Üì'} {Math.abs(diff).toFixed(2)}
                            </Text>
                        </View>
                    </View>
                    <View style={{ alignItems: 'flex-end' }}>
                        <Text style={{ color: colors.textSecondary, fontSize: 10 }}>Based on {totalCredits.toFixed(0)} credits</Text>
                    </View>
                </View>
            </LinearGradient>
        </View>
    );
};

const styles = StyleSheet.create({
    card: {
        borderRadius: 16,
        overflow: 'hidden',
        shadowOffset: { width: 0, height: 2 },
        shadowOpacity: 0.1,
        shadowRadius: 4,
        elevation: 3,
    }
});


=======================================================
FILE: components\ResultsOverlay.tsx
=======================================================

import { API_CONFIG } from '@/constants/config';
import { Colors } from '@/constants/theme';
import { Ionicons } from '@expo/vector-icons';
import { useFocusEffect } from 'expo-router';
import * as SecureStore from 'expo-secure-store';
import React, { useCallback, useEffect, useState } from 'react';
import { ActivityIndicator, BackHandler, RefreshControl, ScrollView, StyleSheet, Text, TouchableOpacity, View } from 'react-native';
import { GestureHandlerRootView, PanGestureHandler, State } from 'react-native-gesture-handler';
import Animated, { FadeInDown } from 'react-native-reanimated';
import { SafeAreaView } from 'react-native-safe-area-context';
import { WebView } from 'react-native-webview';
import { useResults } from '../context/ResultsContext';
import { useTheme } from '../context/ThemeContext';
import { ResultsService, SemesterResult, SubjectResult } from '../services/results';
import { BacklogTracker, GPATrendChart } from './ResultsEnhancements';

const SubjectRow = ({ subject, isDark, colors }: { subject: SubjectResult, isDark: boolean, colors: typeof Colors.light }) => {
    const isFail = subject.result.toUpperCase() === 'F' ||
        subject.grade.toUpperCase() === 'F' ||
        subject.grade.toLowerCase() === 'ab';

    const isPass = !isFail && (subject.result.toUpperCase().includes('P') || (subject.grade !== '-' && subject.grade !== 'null'));

    const badgeText = subject.result !== '-' ? subject.result : (isFail ? 'F' : 'P');
    const gradeColor = isPass ? colors.success : colors.error;
    const borderColor = colors.cardBorder || (isDark ? '#333' : '#eee');

    return (
        <View style={[styles.subjectRow, { borderBottomColor: borderColor }]}>
            <View style={styles.subjectInfo}>
                <Text style={[styles.subjectName, { color: colors.text }]}>{subject.subjectName}</Text>
                <Text style={[styles.subjectCode, { color: colors.textSecondary }]}>{subject.subjectCode}</Text>
            </View>
            <View style={styles.marksContainer}>
                {subject.internal !== '-' && (
                    <View style={styles.markBox}>
                        <Text style={[styles.markLabel, { color: colors.textSecondary }]}>Int</Text>
                        <Text style={[styles.markValue, { color: colors.text }]}>{subject.internal}</Text>
                    </View>
                )}
                {subject.credits !== '-' && (
                    <View style={styles.markBox}>
                        <Text style={[styles.markLabel, { color: colors.textSecondary }]}>Cr</Text>
                        <Text style={[styles.markValue, { color: colors.text }]}>{subject.credits}</Text>
                    </View>
                )}
                {subject.grade !== '-' && subject.grade !== subject.result && (
                    <View style={styles.markBox}>
                        <Text style={[styles.markLabel, { color: colors.textSecondary }]}>Grd</Text>
                        <Text style={[styles.markValue, { color: colors.text }]}>{subject.grade}</Text>
                    </View>
                )}
                <View style={[styles.gradeBadge, { backgroundColor: gradeColor + '20' }]}>
                    <Text style={[styles.gradeText, { color: gradeColor }]}>{badgeText}</Text>
                </View>
            </View>
        </View>
    );
};

const SemesterCard = ({ semester, isDark, colors }: { semester: SemesterResult, isDark: boolean, colors: typeof Colors.light }) => {
    const [expanded, setExpanded] = useState(false);
    const borderColor = colors.cardBorder || (isDark ? '#333' : '#eee');

    const totalSubjects = semester.subjects.length;
    const passedSubjects = semester.subjects.filter(s => {
        const isFail = s.result.toUpperCase() === 'F' ||
            s.grade.toUpperCase() === 'F' ||
            s.grade.toLowerCase() === 'ab';
        return !isFail && (s.result.toUpperCase().includes('P') || (s.grade !== '-' && s.grade !== 'null'));
    }).length;

    const progress = totalSubjects > 0 ? passedSubjects / totalSubjects : 0;

    return (
        <View style={[styles.card, { backgroundColor: colors.card, shadowColor: isDark ? '#000' : '#ccc' }]}>
            <TouchableOpacity
                activeOpacity={0.7}
                onPress={() => setExpanded(!expanded)}
                style={[styles.cardHeader, { borderBottomWidth: expanded ? 1 : 0, borderBottomColor: borderColor }]}
            >
                <View>
                    <Text style={[styles.semesterTitle, { color: colors.text }]}>{semester.semester}</Text>
                    <Text style={[styles.sgpaText, { color: colors.textSecondary }]}>
                        SGPA: <Text style={{ color: colors.primary, fontWeight: 'bold' }}>{semester.sgpa}</Text>
                    </Text>
                </View>
                <View style={styles.headerRight}>
                    <View style={[styles.summaryBadge, { backgroundColor: progress === 1 ? colors.success + '20' : colors.warning + '20', paddingHorizontal: 8, paddingVertical: 4, borderRadius: 8 }]}>
                        <Text style={[styles.summaryText, { color: progress === 1 ? colors.success : colors.warning }]}>
                            {passedSubjects}/{totalSubjects} Passed
                        </Text>
                    </View>
                    <Ionicons name={expanded ? "chevron-up" : "chevron-down"} size={20} color={colors.textSecondary} style={{ marginLeft: 8 }} />
                </View>
            </TouchableOpacity>

            {expanded && (
                <View style={styles.cardContent}>
                    {semester.subjects.map((subject, idx) => (
                        <Animated.View
                            key={idx}
                            entering={FadeInDown.delay(idx * 50).duration(400).springify()}
                        >
                            <SubjectRow subject={subject} isDark={isDark} colors={colors} />
                        </Animated.View>
                    ))}
                </View>
            )}
        </View>
    );
};

export default function ResultsOverlay() {
    const {
        isVisible,
        hideResults,
        results,
        loading,
        error,
        setResultsData,
        setLoadingState,
        setErrorState,
        fetchSignal
    } = useResults();
    const { colors, isDark } = useTheme();

    // Handle Hardware Back Button
    useEffect(() => {
        const onBackPress = () => {
            if (isVisible) {
                hideResults();
                return true; // Prevent default behavior (exit app)
            }
            return false; // Let default behavior happen
        };

        const backHandler = BackHandler.addEventListener('hardwareBackPress', onBackPress);

        return () => backHandler.remove();
    }, [isVisible, hideResults]);

    const onGestureEvent = ({ nativeEvent }: any) => {
        if (nativeEvent.translationX > 50 && nativeEvent.state === State.ACTIVE) {
            hideResults();
        }
    };

    const [viewOriginal, setViewOriginal] = useState(false);
    const [credentials, setCredentials] = useState({ username: '', password: '' });
    const [statusText, setStatusText] = useState('Initializing...');
    const [webViewKey, setWebViewKey] = useState(0);

    // ... (loadCredentials and effects)

    const loadCredentials = useCallback(async () => {
        try {
            const savedUser = await SecureStore.getItemAsync('user_credentials');
            if (savedUser) {
                const parsed = JSON.parse(savedUser);
                const newUsername = parsed.studentId || '';
                const newPassword = parsed.pass || '';

                // Only update if changed or not set
                if (newUsername !== credentials.username || newPassword !== credentials.password) {
                    setResultsData(null); // Clear old results
                    setCredentials({
                        username: newUsername,
                        password: newPassword
                    });
                    setStatusText('Pre-loading Results...');
                }
            }
        } catch {
            // Error loading credentials
        }
    }, [credentials, setResultsData]);

    useFocusEffect(
        useCallback(() => {
            loadCredentials();
        }, [loadCredentials])
    );

    useEffect(() => {
        // Initial load
        setResultsData(null);
        loadCredentials();
    }, [setResultsData, loadCredentials]);

    const attemptFetch = useCallback(() => {
        setLoadingState(true);
        setErrorState(null);
        setStatusText('Checking for results...');
        // Force WebView reload/remount
        setWebViewKey(prev => prev + 1);
    }, [setLoadingState, setErrorState]);

    // Listen for external fetch triggers
    useEffect(() => {
        if (fetchSignal > 0) {
            attemptFetch();
        }
    }, [fetchSignal, attemptFetch]);

    const toggleView = () => {
        setViewOriginal(!viewOriginal);
    };

    const INJECTED_JAVASCRIPT = `
    (function() {

            function log(msg) {
                window.ReactNativeWebView.postMessage(msg);
            }

            // DEBUG: Log where we are
            log('DEBUG: Loc: ' + window.location.href);
            try {
                log('DEBUG: Title: ' + document.title);
                var bodySnippet = document.body.innerText.substring(0, 100).replace(/\\n/g, ' ');
                log('DEBUG: BodyStart: ' + bodySnippet);
                var inputs = document.querySelectorAll('input');
                log('DEBUG: Inputs: ' + inputs.length);
                for (var i = 0; i < inputs.length; i++) {
                    log('DEBUG: Input[' + i + ']: ' + (inputs[i].id || inputs[i].name || inputs[i].type));
                }
            } catch (e) { }

            function isLoginForm() {
                var body = document.body.innerText.toLowerCase();
                return document.querySelector('input[type="password"]') ||
                    body.includes('sign in') ||
                    body.includes('login') ||
                    body.includes('student office');
            }

            function sendHtml() {
                var html = document.documentElement.outerHTML;
                window.ReactNativeWebView.postMessage(JSON.stringify({
                    type: 'HTML_SOURCE',
                    html: html
                }));
            }

            if (window.location.href.toLowerCase().includes('overallmarks.aspx') && !isLoginForm()) {
                log('RESULTS_READY');
                sendHtml();
            }

            function tryRefill() {
                var acted = false;

                // 1. Try Username
                var u = document.querySelector('input[placeholder="User Name"]') ||
                    document.querySelector('input[id*="txtUserName"]');

                if (u && "${credentials.username}") {
                    if (u.value !== "${credentials.username}") {
                        log('STATUS: Filling Username...');
                        u.value = "${credentials.username}";
                        u.dispatchEvent(new Event('input', { bubbles: true }));
                        u.dispatchEvent(new Event('change', { bubbles: true }));
                        acted = true;
                    }
                }

                // 2. Try Password
                var p = document.querySelector('input[type="password"]');

                if (p && "${credentials.password}") {
                    if (p.value !== "${credentials.password}") {
                        log('STATUS: Filling Password...');
                        p.value = "${credentials.password}";
                        p.dispatchEvent(new Event('input', { bubbles: true }));
                        p.dispatchEvent(new Event('change', { bubbles: true }));
                        acted = true;
                    }
                }

                // 3. Click Submit/Next if we are on a login form
                if (isLoginForm()) {
                    var btn = document.querySelector('input[type="submit"]') ||
                        document.querySelector('button[type="submit"]') ||
                        document.querySelector('input[value="Next"]') ||
                        document.querySelector('input[value="Submit"]') ||
                        document.querySelector('button'); // Fallback

                    if (btn) {
                        // Only click if we just acted, OR if we haven't clicked in a while (throttle)
                        // For now, let's just click if we found a password field or it looks like a login page
                        if (acted || p) {
                            log('STATUS: Clicking Submit...');
                            btn.click();

                            // Helper: Redirect if stuck
                            setTimeout(function () {
                                if (!window.location.href.toLowerCase().includes('overallmarks')) {
                                    // Only redirect if we definitely succeeded in leaving login (heuristic)
                                    // Actually, let's trust the browser navigation unless we are sure.
                                }
                            }, 3000);
                            return true;
                        }
                    }
                }

                // 4. Dashboard Link (if we are logged in but not on results)
                if (!window.location.href.toLowerCase().includes('overallmarks') && !isLoginForm()) {
                    var xpath = "//a[contains(text(),'Overall Marks Result')]";
                    var dashboardLink = document.evaluate(xpath, document, null, XPathResult.FIRST_ORDERED_NODE_TYPE, null).singleNodeValue;

                    if (dashboardLink) {
                        log('STATUS: Clicking Result Link...');
                        dashboardLink.click();
                        return true;
                    }
                }
                return acted;
            }

            var lastHtmlLength = 0;
            var lastSendTime = 0;
            var observer = new MutationObserver(function (mutations) {
                mutations.forEach(function (mutation) {
                    if (tryRefill()) return;

                    if (window.location.href.toLowerCase().includes('overallmarks.aspx') && !isLoginForm()) {
                        var currentHtml = document.documentElement.outerHTML;
                        var now = Date.now();
                        if (Math.abs(currentHtml.length - lastHtmlLength) > 1000 && (now - lastSendTime > 1000)) {
                            lastHtmlLength = currentHtml.length;
                            lastSendTime = now;
                            log('STATUS: Content updated...');
                            sendHtml();
                        }
                    }
                });
            });

            observer.observe(document.body, { childList: true, subtree: true });

            var attempts = 0;
            var interval = setInterval(function () {
                attempts++;
                var clicked = tryRefill();
                if (clicked || attempts > 200) {
                    clearInterval(interval);
                    observer.disconnect();
                }
            }, 100);
        })();
    true;
    `;

    const handleMessage = async (event: any) => {
        try {
            const msg = event.nativeEvent.data;
            if (msg === 'RESULTS_READY') {
                setStatusText('Parsing results...');
            } else if (msg.startsWith('STATUS:')) {
                setStatusText(msg.replace('STATUS: ', ''));
            } else {
                const data = JSON.parse(msg);
                if (data.type === 'HTML_SOURCE') {
                    const parsed = await ResultsService.parseResults(data.html);
                    if (parsed) {
                        setResultsData(parsed);
                        setLoadingState(false);
                    }
                }
            }
        } catch {
            // Ignore
        }
    };

    // if (!isVisible) return null; // REMOVED to keep WebView alive

    return (
        <View style={[styles.overlayContainer, !isVisible && styles.hiddenContainer]} pointerEvents={isVisible ? 'auto' : 'none'}>
            <View style={[styles.backdrop, { opacity: isVisible ? 1 : 0 }]} />
            <GestureHandlerRootView style={{ flex: 1 }}>
                <PanGestureHandler
                    onGestureEvent={onGestureEvent}
                    activeOffsetX={[0, 50]} // Only activate on right swipe
                    failOffsetY={[-20, 20]} // Fail if vertical swipe is too large
                >
                    <SafeAreaView style={[styles.container, { backgroundColor: colors.background, opacity: isVisible ? 1 : 0, transform: [{ translateY: isVisible ? 0 : 1000 }] }]}>
                        {/* Header */}
                        <View style={[styles.header, { borderBottomColor: isDark ? '#333' : '#eee', backgroundColor: colors.card }]}>
                            <View style={{ flexDirection: 'row', alignItems: 'center' }}>
                                <TouchableOpacity onPress={hideResults} style={{ marginRight: 10, padding: 4 }}>
                                    <Ionicons name="chevron-back" size={24} color={colors.text} />
                                </TouchableOpacity>
                                <View>
                                    <Text style={[styles.headerTitle, { color: colors.text }]}>Academic Dashboard</Text>
                                    {/* Removed simple CGPA text here as it's now in the dashboard */}
                                </View>
                            </View>
                            <View style={{ flexDirection: 'row', alignItems: 'center' }}>
                                <TouchableOpacity onPress={toggleView} style={{ marginRight: 15 }}>
                                    <Ionicons name={viewOriginal ? "list" : "globe-outline"} size={24} color={colors.primary} />
                                </TouchableOpacity>
                                <TouchableOpacity onPress={hideResults} style={styles.closeButton}>
                                    <Ionicons name="close-circle" size={32} color={colors.primary} />
                                </TouchableOpacity>
                            </View>
                        </View>

                        {/* Main Content Area */}
                        <View style={{ flex: 1 }}>
                            <View style={{
                                flex: viewOriginal ? 1 : 0,
                                height: viewOriginal ? '100%' : 1,
                                opacity: viewOriginal ? 1 : 0,
                                overflow: 'hidden'
                            }}>
                                <WebView
                                    key={`${credentials.username}-${webViewKey}`}
                                    source={{ uri: API_CONFIG.ENDPOINTS.RESULTS }}
                                    injectedJavaScript={INJECTED_JAVASCRIPT}
                                    onMessage={handleMessage}
                                    javaScriptEnabled={true}
                                    domStorageEnabled={true}
                                    incognito={true}
                                    cacheEnabled={false}
                                    style={{ flex: 1 }}
                                />
                            </View>

                            {!viewOriginal && (
                                <View style={{ ...StyleSheet.absoluteFillObject }}>
                                    {loading && !results ? (
                                        <View style={styles.centerContainer}>
                                            <ActivityIndicator size="large" color={colors.primary} />
                                            <Text style={[styles.loadingText, { color: colors.textSecondary }]}>{statusText}</Text>
                                            <TouchableOpacity style={[styles.retryButton, { marginTop: 20, backgroundColor: colors.card }]} onPress={() => setViewOriginal(true)}>
                                                <Text style={[styles.retryText, { color: colors.primary }]}>View Original Page</Text>
                                            </TouchableOpacity>
                                        </View>
                                    ) : error ? (
                                        <View style={styles.centerContainer}>
                                            <Ionicons name="alert-circle-outline" size={48} color={colors.error} />
                                            <Text style={[styles.errorText, { color: colors.text }]}>Failed to load results</Text>
                                            <View style={{ height: 20 }} />
                                            <TouchableOpacity style={[styles.retryButton, { backgroundColor: colors.primary }]} onPress={attemptFetch}>
                                                <Text style={styles.retryText}>Retry</Text>
                                            </TouchableOpacity>
                                            <TouchableOpacity style={{ marginTop: 20 }} onPress={() => setViewOriginal(true)}>
                                                <Text style={{ color: colors.primary, textDecorationLine: 'underline' }}>View Original Webpage</Text>
                                            </TouchableOpacity>
                                        </View>
                                    ) : (
                                        <ScrollView
                                            style={styles.scrollContainer}
                                            contentContainerStyle={styles.scrollContent}
                                            refreshControl={
                                                <RefreshControl refreshing={loading} onRefresh={attemptFetch} tintColor={colors.primary} />
                                            }
                                        >
                                            {results?.semesters.length === 0 ? (
                                                <View style={styles.centerContainer}>
                                                    <Text style={[styles.emptyText, { color: colors.textSecondary }]}>No results found.</Text>
                                                    <Text style={{ color: colors.textSecondary, marginBottom: 20, textAlign: 'center', marginTop: 10 }}>
                                                        The parser couldn&apos;t find your marks table.
                                                    </Text>
                                                    <TouchableOpacity style={[styles.retryButton, { backgroundColor: colors.primary }]} onPress={() => setViewOriginal(true)}>
                                                        <Text style={styles.retryText}>View Original Page</Text>
                                                    </TouchableOpacity>
                                                </View>
                                            ) : (
                                                <>
                                                    {results && (
                                                        <>
                                                            <BacklogTracker semesters={results.semesters} colors={colors} />
                                                            <GPATrendChart semesters={results.semesters} colors={colors} />


                                                            <View style={{ flexDirection: 'row', alignItems: 'center', marginBottom: 16 }}>
                                                                <Text style={[styles.sectionTitle, { color: colors.text }]}>SEMESTER DETAILS</Text>
                                                                <View style={{ height: 1, flex: 1, backgroundColor: colors.textSecondary, marginLeft: 16, opacity: 0.2 }} />
                                                            </View>
                                                        </>
                                                    )}

                                                    {results?.semesters.map((sem, index) => (
                                                        <Animated.View
                                                            key={index}
                                                            entering={FadeInDown.delay(index * 100).duration(600).springify()}
                                                        >
                                                            <SemesterCard semester={sem} isDark={isDark} colors={colors} />
                                                        </Animated.View>
                                                    ))}
                                                </>
                                            )}
                                            <View style={{ height: 40 }} />
                                        </ScrollView>
                                    )}
                                </View>
                            )}
                        </View>
                    </SafeAreaView>
                </PanGestureHandler>
            </GestureHandlerRootView>
        </View>
    );
}

const styles = StyleSheet.create({
    overlayContainer: {
        ...StyleSheet.absoluteFillObject,
        zIndex: 9999,
    },
    hiddenContainer: {
        top: 10000,
    },
    backdrop: {
        ...StyleSheet.absoluteFillObject,
        backgroundColor: 'rgba(0,0,0,0.5)',
    },
    container: {
        flex: 1,
        marginTop: 0,
        // borderTopLeftRadius: 20, // Removed for full screen
        // borderTopRightRadius: 20, // Removed for full screen
        overflow: 'hidden',
    },
    header: {
        flexDirection: 'row',
        justifyContent: 'space-between',
        alignItems: 'center',
        padding: 16,
        borderBottomWidth: 1,
        zIndex: 10,
    },
    headerTitle: {
        fontSize: 20,
        fontWeight: 'bold',
    },

    closeButton: {
        padding: 4,
    },
    centerContainer: {
        flex: 1,
        justifyContent: 'center',
        alignItems: 'center',
        padding: 20,
    },
    loadingText: {
        marginTop: 16,
        fontSize: 16,
    },
    errorText: {
        fontSize: 18,
        fontWeight: 'bold',
        marginTop: 16,
    },
    errorSubText: {
        textAlign: 'center',
        marginTop: 8,
        marginBottom: 20,
    },
    retryButton: {
        paddingHorizontal: 20,
        paddingVertical: 10,
        borderRadius: 20,
    },
    retryText: {
        color: '#fff',
        fontWeight: 'bold',
    },
    scrollContainer: {
        flex: 1,
    },
    scrollContent: {
        padding: 16,
    },
    card: {
        borderRadius: 16,
        marginBottom: 16,
        shadowOffset: { width: 0, height: 2 },
        shadowOpacity: 0.1,
        shadowRadius: 4,
        elevation: 3,
        overflow: 'hidden',
    },
    cardHeader: {
        padding: 16,
        flexDirection: 'row',
        justifyContent: 'space-between',
        alignItems: 'center',
    },
    semesterTitle: {
        fontSize: 18,
        fontWeight: 'bold',
    },
    sgpaText: {
        fontSize: 14,
        marginTop: 4,
    },
    headerRight: {
        flexDirection: 'row',
        alignItems: 'center',
    },
    summaryBadge: {
        marginRight: 8,
    },
    summaryText: {
        fontSize: 12,
        fontWeight: '600',
    },
    cardContent: {
        padding: 0,
    },
    subjectRow: {
        flexDirection: 'row',
        justifyContent: 'space-between',
        padding: 12,
        borderBottomWidth: 1,
        alignItems: 'center',
    },
    subjectInfo: {
        flex: 1,
        paddingRight: 8,
    },
    subjectName: {
        fontSize: 14,
        fontWeight: '500',
        marginBottom: 2,
    },
    subjectCode: {
        fontSize: 12,
    },
    marksContainer: {
        flexDirection: 'row',
        alignItems: 'center',
    },
    markBox: {
        alignItems: 'center',
        width: 35,
        marginRight: 4,
    },
    markLabel: {
        fontSize: 10,
    },
    markValue: {
        fontSize: 12,
        fontWeight: 'bold',
    },
    gradeBadge: {
        width: 30,
        height: 30,
        borderRadius: 15,
        justifyContent: 'center',
        alignItems: 'center',
        marginLeft: 4,
    },
    gradeText: {
        fontSize: 12,
        fontWeight: 'bold',
    },
    emptyText: {
        fontSize: 16,
    },
    sectionTitle: {
        fontSize: 14,
        fontWeight: '600',
        letterSpacing: 0.5
    }
});


=======================================================
FILE: components\ScalePressable.tsx
=======================================================

import * as Haptics from 'expo-haptics';
import React from 'react';
import { Pressable, PressableProps, StyleProp, ViewStyle } from 'react-native';
import Animated, {
    useAnimatedStyle,
    useSharedValue,
    withSpring,
} from 'react-native-reanimated';

interface ScalePressableProps extends PressableProps {
    children: React.ReactNode;
    style?: StyleProp<ViewStyle>;
    scaleTo?: number;
}

const AnimatedPressable = Animated.createAnimatedComponent(Pressable);

export const ScalePressable: React.FC<ScalePressableProps> = ({
    children,
    style,
    scaleTo = 0.96,
    onPressIn,
    onPressOut,
    ...props
}) => {
    const scale = useSharedValue(1);

    const animatedStyle = useAnimatedStyle(() => {
        return {
            transform: [{ scale: scale.value }],
        };
    });

    const handlePressIn = (event: any) => {
        Haptics.impactAsync(Haptics.ImpactFeedbackStyle.Light);
        scale.value = withSpring(scaleTo, { damping: 10, stiffness: 300 });
        onPressIn?.(event);
    };

    const handlePressOut = (event: any) => {
        scale.value = withSpring(1, { damping: 10, stiffness: 300 });
        onPressOut?.(event);
    };

    return (
        <AnimatedPressable
            style={[style, animatedStyle]}
            onPressIn={handlePressIn}
            onPressOut={handlePressOut}
            {...props}
        >
            {children}
        </AnimatedPressable>
    );
};


=======================================================
FILE: components\settings\AboutModal.tsx
=======================================================

import { Ionicons } from '@expo/vector-icons';
import Constants from 'expo-constants';
import * as Haptics from 'expo-haptics';
import { LinearGradient } from 'expo-linear-gradient';
import React from 'react';
import { Image, Linking, Modal, ScrollView, StyleSheet, Text, TouchableOpacity, View } from 'react-native';
import { useSafeAreaInsets } from 'react-native-safe-area-context';

interface AboutModalProps {
    visible: boolean;
    onClose: () => void;
    colors: any;
    isDark: boolean;
}

export const AboutModal = ({ visible, onClose, colors, isDark }: AboutModalProps) => {
    const insets = useSafeAreaInsets();
    return (
        <Modal
            animationType="slide"
            transparent={false}
            visible={visible}
            onRequestClose={onClose}
        >
            <View style={[styles.modalContainer, { backgroundColor: colors.background }]}>
                <ScrollView
                    showsVerticalScrollIndicator={false}
                    bounces={false}
                >
                    <LinearGradient
                        colors={isDark ? ['#0f172a', '#1e293b'] : ['#1e293b', '#334155']}
                        style={[styles.aboutHeader, { paddingTop: insets.top }]}
                    >
                        <View style={styles.policyHeaderContent}>
                            <TouchableOpacity onPress={onClose} style={styles.policyBackBtn}>
                                <Ionicons name="arrow-back" size={24} color="#fff" />
                            </TouchableOpacity>
                            <View style={styles.aboutLogoContainer}>
                                <Image
                                    source={require('../../assets/images/Clgpo.png')}
                                    style={{ width: 80, height: 80, borderRadius: 20 }}
                                    resizeMode="contain"
                                />
                            </View>
                            <Text style={styles.aboutHeaderTitle}>Clgpo</Text>
                            <View style={styles.versionBadge}>
                                <Text style={styles.versionBadgeText}>Version {Constants.expoConfig?.version || '1.0.0'}</Text>
                            </View>
                        </View>
                    </LinearGradient>

                    <View style={styles.policyScrollContent}>
                        {/* Tagline Banner */}
                        <LinearGradient
                            colors={isDark ? ['#1e3a5f', '#0f172a'] : ['#eff6ff', '#dbeafe']}
                            style={styles.aboutTaglineBanner}
                        >
                            <Ionicons name="sparkles" size={24} color={isDark ? '#60a5fa' : '#2563eb'} />
                            <Text style={[styles.aboutTagline, { color: isDark ? '#93c5fd' : '#1e40af' }]}>
                                Your Personal Attendance Companion
                            </Text>
                        </LinearGradient>

                        {/* Description Card */}
                        <View style={[styles.policySectionCard, { backgroundColor: colors.card, borderColor: colors.cardBorder }]}>
                            <View style={[styles.policySectionIcon, { backgroundColor: '#10b981' + '20' }]}>
                                <Ionicons name="information-circle" size={24} color="#10b981" />
                            </View>
                            <Text style={[styles.policySectionTitle, { color: colors.text }]}>What is Clgpo?</Text>
                            <Text style={[styles.policySectionText, { color: colors.textSecondary }]}>
                                Clgpo is designed specifically for students who want to stay on top of their attendance. Track your attendance, predict future requirements, and never fall below the 75% threshold again!
                            </Text>
                        </View>

                        {/* Features Grid */}
                        <View style={[styles.policySectionCard, { backgroundColor: colors.card, borderColor: colors.cardBorder }]}>
                            <View style={[styles.policySectionIcon, { backgroundColor: '#3b82f6' + '20' }]}>
                                <Ionicons name="grid" size={24} color="#3b82f6" />
                            </View>
                            <Text style={[styles.policySectionTitle, { color: colors.text }]}>Features</Text>

                            <View style={styles.aboutFeaturesGrid}>
                                <View style={[styles.aboutFeatureCard, { backgroundColor: colors.badge }]}>
                                    <View style={[styles.aboutFeatureIcon, { backgroundColor: '#10b981' + '20' }]}>
                                        <Ionicons name="stats-chart" size={24} color="#10b981" />
                                    </View>
                                    <Text style={[styles.aboutFeatureTitle, { color: colors.text }]}>Live Tracking</Text>
                                    <Text style={[styles.aboutFeatureDesc, { color: colors.textSecondary }]}>Real-time updates</Text>
                                </View>

                                <View style={[styles.aboutFeatureCard, { backgroundColor: colors.badge }]}>
                                    <View style={[styles.aboutFeatureIcon, { backgroundColor: '#3b82f6' + '20' }]}>
                                        <Ionicons name="calculator" size={24} color="#3b82f6" />
                                    </View>
                                    <Text style={[styles.aboutFeatureTitle, { color: colors.text }]}>Smart Predictions</Text>
                                    <Text style={[styles.aboutFeatureDesc, { color: colors.textSecondary }]}>Know your limits</Text>
                                </View>

                                <View style={[styles.aboutFeatureCard, { backgroundColor: colors.badge }]}>
                                    <View style={[styles.aboutFeatureIcon, { backgroundColor: '#f59e0b' + '20' }]}>
                                        <Ionicons name="school" size={24} color="#f59e0b" />
                                    </View>
                                    <Text style={[styles.aboutFeatureTitle, { color: colors.text }]}>Results Viewer</Text>
                                    <Text style={[styles.aboutFeatureDesc, { color: colors.textSecondary }]}>Check grades fast</Text>
                                </View>

                                <View style={[styles.aboutFeatureCard, { backgroundColor: colors.badge }]}>
                                    <View style={[styles.aboutFeatureIcon, { backgroundColor: '#8b5cf6' + '20' }]}>
                                        <Ionicons name="receipt" size={24} color="#8b5cf6" />
                                    </View>
                                    <Text style={[styles.aboutFeatureTitle, { color: colors.text }]}>Fee Receipts</Text>
                                    <Text style={[styles.aboutFeatureDesc, { color: colors.textSecondary }]}>Easy management</Text>
                                </View>

                                <View style={[styles.aboutFeatureCard, { backgroundColor: colors.badge }]}>
                                    <View style={[styles.aboutFeatureIcon, { backgroundColor: '#ec4899' + '20' }]}>
                                        <Ionicons name="notifications" size={24} color="#ec4899" />
                                    </View>
                                    <Text style={[styles.aboutFeatureTitle, { color: colors.text }]}>Alerts</Text>
                                    <Text style={[styles.aboutFeatureDesc, { color: colors.textSecondary }]}>Never miss updates</Text>
                                </View>

                                <View style={[styles.aboutFeatureCard, { backgroundColor: colors.badge }]}>
                                    <View style={[styles.aboutFeatureIcon, { backgroundColor: '#06b6d4' + '20' }]}>
                                        <Ionicons name="cloud-offline" size={24} color="#06b6d4" />
                                    </View>
                                    <Text style={[styles.aboutFeatureTitle, { color: colors.text }]}>Offline Mode</Text>
                                    <Text style={[styles.aboutFeatureDesc, { color: colors.textSecondary }]}>Works anywhere</Text>
                                </View>
                            </View>
                        </View>

                        {/* Developer Card */}
                        <View style={[styles.policySectionCard, { backgroundColor: colors.card, borderColor: colors.cardBorder }]}>
                            <View style={[styles.policySectionIcon, { backgroundColor: '#8b5cf6' + '20' }]}>
                                <Ionicons name="code-slash" size={24} color="#8b5cf6" />
                            </View>
                            <Text style={[styles.policySectionTitle, { color: colors.text }]}>Developer</Text>

                            <View style={styles.aboutDeveloperCard}>
                                <LinearGradient
                                    colors={isDark ? ['#4c1d95', '#7c3aed'] : ['#ede9fe', '#ddd6fe']}
                                    style={styles.aboutDevAvatar}
                                >
                                    <Text style={[styles.aboutDevInitial, { color: isDark ? '#fff' : '#7c3aed' }]}>BK</Text>
                                </LinearGradient>
                                <View style={styles.aboutDevInfo}>
                                    <Text style={[styles.aboutDevName, { color: colors.text }]}>Bharat Kumar</Text>
                                    <Text style={[styles.aboutDevRole, { color: colors.textSecondary }]}>Student Developer</Text>
                                </View>
                            </View>
                            <Text style={[styles.policySectionText, { color: colors.textSecondary, textAlign: 'center', marginTop: 12 }]}>
                                Built with ‚ù§Ô∏è for fellow students who struggle to keep track of their attendance.
                            </Text>

                            <TouchableOpacity
                                style={[styles.policyContactBtn, { backgroundColor: '#0077b5' }]}
                                onPress={() => { Haptics.impactAsync(Haptics.ImpactFeedbackStyle.Light); Linking.openURL('https://www.linkedin.com/in/bharatkumarkovilapu/'); }}
                            >
                                <Ionicons name="logo-linkedin" size={18} color="#fff" style={{ marginRight: 8 }} />
                                <Text style={styles.policyContactBtnText}>Connect on LinkedIn</Text>
                            </TouchableOpacity>
                        </View>

                        {/* Special Thanks */}
                        <LinearGradient
                            colors={isDark ? ['#1e3a5f', '#0f172a'] : ['#fef3c7', '#fde68a']}
                            style={[styles.policyBanner, { marginBottom: 20 }]}
                        >
                            <Ionicons name="heart" size={28} color={isDark ? '#fbbf24' : '#d97706'} />
                            <View style={{ marginLeft: 12, flex: 1 }}>
                                <Text style={[styles.policyBannerTitle, { color: isDark ? '#fde68a' : '#92400e' }]}>Special Thanks</Text>
                                <Text style={[styles.policyBannerText, { color: isDark ? '#fcd34d' : '#a16207' }]}>To all beta testers who helped make this app better!</Text>
                            </View>
                        </LinearGradient>

                        {/* Copyright */}
                        <Text style={[styles.aboutCopyright, { color: colors.textSecondary }]}>
                            ¬© 2026 Clgpo. All rights reserved.
                        </Text>
                        <Text style={[styles.aboutMadeWith, { color: colors.textSecondary }]}>
                            Made with üíö in India
                        </Text>
                    </View>
                </ScrollView>
            </View>
        </Modal>
    );
};

const styles = StyleSheet.create({
    modalContainer: {
        flex: 1,
    },
    policyHeaderContent: {
        alignItems: 'center',
        paddingHorizontal: 20,
        paddingTop: 10,
    },
    policyBackBtn: {
        position: 'absolute',
        top: 10,
        left: 20,
        width: 40,
        height: 40,
        justifyContent: 'center',
        alignItems: 'center',
        backgroundColor: 'rgba(255,255,255,0.2)',
        borderRadius: 20,
    },
    policyScrollContent: {
        padding: 20,
    },
    policySectionCard: {
        borderRadius: 20,
        padding: 20,
        marginBottom: 20,
        borderWidth: 1,
        shadowColor: '#000',
        shadowOffset: { width: 0, height: 2 },
        shadowOpacity: 0.05,
        shadowRadius: 8,
        elevation: 2,
    },
    policySectionIcon: {
        width: 48,
        height: 48,
        borderRadius: 24,
        justifyContent: 'center',
        alignItems: 'center',
        marginBottom: 16,
    },
    policySectionTitle: {
        fontSize: 20,
        fontWeight: 'bold',
        marginBottom: 12,
    },
    policySectionText: {
        fontSize: 15,
        lineHeight: 24,
    },
    policyBanner: {
        flexDirection: 'row',
        alignItems: 'center',
        padding: 20,
        borderRadius: 20,
        marginBottom: 20,
    },
    policyBannerTitle: {
        fontSize: 16,
        fontWeight: 'bold',
        marginBottom: 4,
    },
    policyBannerText: {
        fontSize: 13,
        lineHeight: 18,
    },
    policyContactBtn: {
        flexDirection: 'row',
        alignItems: 'center',
        justifyContent: 'center',
        backgroundColor: '#06b6d4',
        paddingVertical: 14,
        borderRadius: 12,
        marginTop: 20,
    },
    policyContactBtnText: {
        color: '#fff',
        fontSize: 16,
        fontWeight: 'bold',
    },
    aboutHeader: {
        paddingBottom: 30,
        borderBottomLeftRadius: 30,
        borderBottomRightRadius: 30,
        shadowColor: '#000',
        shadowOffset: { width: 0, height: 4 },
        shadowOpacity: 0.15,
        shadowRadius: 12,
        elevation: 8,
    },
    aboutLogoContainer: {
        marginBottom: 16,
        shadowColor: '#000',
        shadowOffset: { width: 0, height: 8 },
        shadowOpacity: 0.2,
        shadowRadius: 16,
        elevation: 10,
    },
    aboutLogoInner: {
        width: 100,
        height: 100,
        borderRadius: 30,
        justifyContent: 'center',
        alignItems: 'center',
        transform: [{ rotate: '-10deg' }],
    },
    aboutHeaderTitle: {
        fontSize: 32,
        fontWeight: '900',
        color: '#fff',
        letterSpacing: 1,
        marginBottom: 8,
    },
    versionBadge: {
        backgroundColor: 'rgba(255,255,255,0.2)',
        paddingHorizontal: 16,
        paddingVertical: 6,
        borderRadius: 20,
    },
    versionBadgeText: {
        color: '#fff',
        fontSize: 14,
        fontWeight: '600',
    },
    aboutTaglineBanner: {
        flexDirection: 'row',
        alignItems: 'center',
        justifyContent: 'center',
        padding: 16,
        borderRadius: 16,
        marginBottom: 24,
        marginTop: 10,
    },
    aboutTagline: {
        fontSize: 15,
        fontWeight: '600',
        marginLeft: 8,
    },
    aboutFeaturesGrid: {
        flexDirection: 'row',
        flexWrap: 'wrap',
        justifyContent: 'space-between',
    },
    aboutFeatureCard: {
        width: '48%',
        padding: 16,
        borderRadius: 16,
        marginBottom: 16,
        alignItems: 'center',
    },
    aboutFeatureIcon: {
        width: 48,
        height: 48,
        borderRadius: 24,
        justifyContent: 'center',
        alignItems: 'center',
        marginBottom: 12,
    },
    aboutFeatureTitle: {
        fontSize: 14,
        fontWeight: 'bold',
        marginBottom: 4,
        textAlign: 'center',
    },
    aboutFeatureDesc: {
        fontSize: 12,
        textAlign: 'center',
    },
    aboutDeveloperCard: {
        flexDirection: 'row',
        alignItems: 'center',
        padding: 16,
        backgroundColor: 'rgba(139, 92, 246, 0.05)',
        borderRadius: 16,
        marginTop: 8,
    },
    aboutDevAvatar: {
        width: 56,
        height: 56,
        borderRadius: 28,
        justifyContent: 'center',
        alignItems: 'center',
        marginRight: 16,
    },
    aboutDevInitial: {
        fontSize: 20,
        fontWeight: 'bold',
    },
    aboutDevInfo: {
        flex: 1,
    },
    aboutDevName: {
        fontSize: 18,
        fontWeight: 'bold',
        marginBottom: 4,
    },
    aboutDevRole: {
        fontSize: 14,
    },
    aboutCopyright: {
        textAlign: 'center',
        fontSize: 14,
        marginTop: 10,
        fontWeight: '500',
    },
    aboutMadeWith: {
        textAlign: 'center',
        fontSize: 12,
        marginTop: 4,
        marginBottom: 40,
    },
});


=======================================================
FILE: components\settings\PrivacyModal.tsx
=======================================================

import { Ionicons } from '@expo/vector-icons';
import * as Haptics from 'expo-haptics';
import { LinearGradient } from 'expo-linear-gradient';
import React from 'react';
import { Linking, Modal, ScrollView, StyleSheet, Text, TouchableOpacity, View } from 'react-native';
import { useSafeAreaInsets } from 'react-native-safe-area-context';

interface PrivacyModalProps {
    visible: boolean;
    onClose: () => void;
    colors: any;
    isDark: boolean;
}

export const PrivacyModal = ({ visible, onClose, colors, isDark }: PrivacyModalProps) => {
    const insets = useSafeAreaInsets();
    return (
        <Modal
            animationType="slide"
            transparent={false}
            visible={visible}
            onRequestClose={onClose}
        >
            <View style={[styles.modalContainer, { backgroundColor: colors.background }]}>
                <ScrollView
                    showsVerticalScrollIndicator={false}
                    bounces={false}
                >
                    <LinearGradient
                        colors={isDark ? ['#1e3a5f', '#0f172a'] : ['#3b82f6', '#1d4ed8']}
                        style={[styles.policyHeader, { paddingTop: insets.top }]}
                    >
                        <View style={styles.policyHeaderContent}>
                            <TouchableOpacity onPress={onClose} style={styles.policyBackBtn}>
                                <Ionicons name="arrow-back" size={24} color="#fff" />
                            </TouchableOpacity>
                            <View style={styles.policyHeaderIcon}>
                                <Ionicons name="shield-checkmark" size={48} color="#fff" />
                            </View>
                            <Text style={styles.policyHeaderTitle}>Privacy Policy</Text>
                            <Text style={styles.policyHeaderSubtitle}>Last updated: February 2026</Text>
                        </View>
                    </LinearGradient>

                    <View style={styles.policyScrollContent}>
                        {/* Introduction Card */}
                        <View style={[styles.policySectionCard, { backgroundColor: colors.card, borderColor: colors.cardBorder }]}>
                            <View style={[styles.policySectionIcon, { backgroundColor: '#3b82f6' + '20' }]}>
                                <Ionicons name="information-circle" size={24} color="#3b82f6" />
                            </View>
                            <Text style={[styles.policySectionTitle, { color: colors.text }]}>Introduction</Text>
                            <Text style={[styles.policySectionText, { color: colors.textSecondary }]}>
                                Welcome to Clgpo. We respect your privacy and are committed to protecting your personal data. This privacy policy explains how we collect, use, and safeguard your information when you use our mobile application.
                            </Text>
                        </View>

                        {/* Data Collection Card */}
                        <View style={[styles.policySectionCard, { backgroundColor: colors.card, borderColor: colors.cardBorder }]}>
                            <View style={[styles.policySectionIcon, { backgroundColor: '#8b5cf6' + '20' }]}>
                                <Ionicons name="folder-open" size={24} color="#8b5cf6" />
                            </View>
                            <Text style={[styles.policySectionTitle, { color: colors.text }]}>Information We Collect</Text>

                            <View style={styles.policyDataItem}>
                                <View style={[styles.policyDataIcon, { backgroundColor: '#10b981' + '20' }]}>
                                    <Ionicons name="key" size={16} color="#10b981" />
                                </View>
                                <View style={{ flex: 1 }}>
                                    <Text style={[styles.policyDataTitle, { color: colors.text }]}>Login Credentials</Text>
                                    <Text style={[styles.policyDataDesc, { color: colors.textSecondary }]}>Stored securely on your device using encrypted storage. Never transmitted to our servers.</Text>
                                </View>
                            </View>

                            <View style={styles.policyDataItem}>
                                <View style={[styles.policyDataIcon, { backgroundColor: '#f59e0b' + '20' }]}>
                                    <Ionicons name="calendar" size={16} color="#f59e0b" />
                                </View>
                                <View style={{ flex: 1 }}>
                                    <Text style={[styles.policyDataTitle, { color: colors.text }]}>Attendance Data</Text>
                                    <Text style={[styles.policyDataDesc, { color: colors.textSecondary }]}>Fetched directly from your college ERP and cached locally for offline access.</Text>
                                </View>
                            </View>

                            <View style={styles.policyDataItem}>
                                <View style={[styles.policyDataIcon, { backgroundColor: '#ec4899' + '20' }]}>
                                    <Ionicons name="person" size={16} color="#ec4899" />
                                </View>
                                <View style={{ flex: 1 }}>
                                    <Text style={[styles.policyDataTitle, { color: colors.text }]}>Profile Information</Text>
                                    <Text style={[styles.policyDataDesc, { color: colors.textSecondary }]}>Basic details (name, roll number, department) retrieved from ERP and stored locally.</Text>
                                </View>
                            </View>
                        </View>

                        {/* Data Usage Card */}
                        <View style={[styles.policySectionCard, { backgroundColor: colors.card, borderColor: colors.cardBorder }]}>
                            <View style={[styles.policySectionIcon, { backgroundColor: '#10b981' + '20' }]}>
                                <Ionicons name="analytics" size={24} color="#10b981" />
                            </View>
                            <Text style={[styles.policySectionTitle, { color: colors.text }]}>How We Use Your Data</Text>

                            {['Display attendance statistics', 'Provide 75% predictions', 'Send smart notifications', 'Enable offline access', 'Improve app experience'].map((item, index) => (
                                <View key={index} style={styles.policyListItem}>
                                    <Ionicons name="checkmark-circle" size={18} color="#10b981" style={{ marginRight: 10 }} />
                                    <Text style={[styles.policyListText, { color: colors.textSecondary }]}>{item}</Text>
                                </View>
                            ))}
                        </View>

                        {/* Security Card */}
                        <View style={[styles.policySectionCard, { backgroundColor: colors.card, borderColor: colors.cardBorder }]}>
                            <View style={[styles.policySectionIcon, { backgroundColor: '#ef4444' + '20' }]}>
                                <Ionicons name="lock-closed" size={24} color="#ef4444" />
                            </View>
                            <Text style={[styles.policySectionTitle, { color: colors.text }]}>Data Security</Text>
                            <Text style={[styles.policySectionText, { color: colors.textSecondary, marginBottom: 12 }]}>
                                All sensitive data is stored locally using secure, encrypted storage mechanisms.
                            </Text>

                            {['Device-level encryption', 'No external uploads', 'HTTPS communication', 'No tracking SDKs'].map((item, index) => (
                                <View key={index} style={styles.policyListItem}>
                                    <Ionicons name="shield" size={18} color="#ef4444" style={{ marginRight: 10 }} />
                                    <Text style={[styles.policyListText, { color: colors.textSecondary }]}>{item}</Text>
                                </View>
                            ))}
                        </View>

                        {/* No Sharing Banner */}
                        <LinearGradient
                            colors={isDark ? ['#065f46', '#064e3b'] : ['#d1fae5', '#a7f3d0']}
                            style={styles.policyBanner}
                        >
                            <Ionicons name="checkmark-done-circle" size={32} color={isDark ? '#10b981' : '#047857'} />
                            <View style={{ marginLeft: 12, flex: 1 }}>
                                <Text style={[styles.policyBannerTitle, { color: isDark ? '#fff' : '#064e3b' }]}>We Never Share Your Data</Text>
                                <Text style={[styles.policyBannerText, { color: isDark ? '#a7f3d0' : '#047857' }]}>Your data stays on your device and is only transmitted to your college ERP.</Text>
                            </View>
                        </LinearGradient>

                        {/* Your Rights Card */}
                        <View style={[styles.policySectionCard, { backgroundColor: colors.card, borderColor: colors.cardBorder }]}>
                            <View style={[styles.policySectionIcon, { backgroundColor: '#6366f1' + '20' }]}>
                                <Ionicons name="hand-left" size={24} color="#6366f1" />
                            </View>
                            <Text style={[styles.policySectionTitle, { color: colors.text }]}>Your Rights</Text>

                            <View style={styles.policyRightsGrid}>
                                <View style={[styles.policyRightItem, { backgroundColor: colors.badge }]}>
                                    <Ionicons name="eye" size={20} color={colors.primary} />
                                    <Text style={[styles.policyRightText, { color: colors.text }]}>Access</Text>
                                </View>
                                <View style={[styles.policyRightItem, { backgroundColor: colors.badge }]}>
                                    <Ionicons name="trash" size={20} color="#ef4444" />
                                    <Text style={[styles.policyRightText, { color: colors.text }]}>Delete</Text>
                                </View>
                                <View style={[styles.policyRightItem, { backgroundColor: colors.badge }]}>
                                    <Ionicons name="log-out" size={20} color="#f59e0b" />
                                    <Text style={[styles.policyRightText, { color: colors.text }]}>Logout</Text>
                                </View>
                                <View style={[styles.policyRightItem, { backgroundColor: colors.badge }]}>
                                    <Ionicons name="close-circle" size={20} color="#8b5cf6" />
                                    <Text style={[styles.policyRightText, { color: colors.text }]}>Uninstall</Text>
                                </View>
                            </View>
                        </View>

                        {/* Contact Card */}
                        <View style={[styles.policySectionCard, { backgroundColor: colors.card, borderColor: colors.cardBorder, marginBottom: 40 }]}>
                            <View style={[styles.policySectionIcon, { backgroundColor: '#06b6d4' + '20' }]}>
                                <Ionicons name="mail" size={24} color="#06b6d4" />
                            </View>
                            <Text style={[styles.policySectionTitle, { color: colors.text }]}>Contact Us</Text>
                            <Text style={[styles.policySectionText, { color: colors.textSecondary }]}>
                                Have questions about this Privacy Policy?
                            </Text>
                            <TouchableOpacity
                                style={styles.policyContactBtn}
                                onPress={() => { Haptics.impactAsync(Haptics.ImpactFeedbackStyle.Light); Linking.openURL('https://www.linkedin.com/in/bharatkumarkovilapu/'); }}
                            >
                            </TouchableOpacity>
                        </View>
                    </View>
                </ScrollView>
            </View>
        </Modal >
    );
};

const styles = StyleSheet.create({
    modalContainer: {
        flex: 1,
    },
    policyHeader: {
        paddingBottom: 20,
        borderBottomLeftRadius: 30,
        borderBottomRightRadius: 30,
        shadowColor: '#000',
        shadowOffset: { width: 0, height: 4 },
        shadowOpacity: 0.15,
        shadowRadius: 12,
        elevation: 8,
    },
    policyHeaderContent: {
        alignItems: 'center',
        paddingHorizontal: 20,
        paddingTop: 10,
    },
    policyBackBtn: {
        position: 'absolute',
        top: 10,
        left: 20,
        width: 40,
        height: 40,
        justifyContent: 'center',
        alignItems: 'center',
        backgroundColor: 'rgba(255,255,255,0.2)',
        borderRadius: 20,
    },
    policyHeaderIcon: {
        width: 80,
        height: 80,
        backgroundColor: 'rgba(255,255,255,0.2)',
        borderRadius: 40,
        justifyContent: 'center',
        alignItems: 'center',
        marginBottom: 16,
    },
    policyHeaderTitle: {
        fontSize: 28,
        fontWeight: 'bold',
        color: '#fff',
        marginBottom: 8,
    },
    policyHeaderSubtitle: {
        fontSize: 14,
        color: 'rgba(255,255,255,0.8)',
    },
    policyScrollContent: {
        padding: 20,
    },
    policySectionCard: {
        borderRadius: 20,
        padding: 20,
        marginBottom: 20,
        borderWidth: 1,
        shadowColor: '#000',
        shadowOffset: { width: 0, height: 2 },
        shadowOpacity: 0.05,
        shadowRadius: 8,
        elevation: 2,
    },
    policySectionIcon: {
        width: 48,
        height: 48,
        borderRadius: 24,
        justifyContent: 'center',
        alignItems: 'center',
        marginBottom: 16,
    },
    policySectionTitle: {
        fontSize: 20,
        fontWeight: 'bold',
        marginBottom: 12,
    },
    policySectionText: {
        fontSize: 15,
        lineHeight: 24,
    },
    policyDataItem: {
        flexDirection: 'row',
        marginTop: 16,
    },
    policyDataIcon: {
        width: 32,
        height: 32,
        borderRadius: 16,
        justifyContent: 'center',
        alignItems: 'center',
        marginRight: 12,
    },
    policyDataTitle: {
        fontSize: 16,
        fontWeight: '600',
        marginBottom: 4,
    },
    policyDataDesc: {
        fontSize: 14,
        lineHeight: 20,
    },
    policyListItem: {
        flexDirection: 'row',
        alignItems: 'center',
        marginTop: 12,
    },
    policyListText: {
        fontSize: 15,
        flex: 1,
    },
    policyBanner: {
        flexDirection: 'row',
        alignItems: 'center',
        padding: 20,
        borderRadius: 20,
        marginBottom: 20,
    },
    policyBannerTitle: {
        fontSize: 16,
        fontWeight: 'bold',
        marginBottom: 4,
    },
    policyBannerText: {
        fontSize: 13,
        lineHeight: 18,
    },
    policyRightsGrid: {
        flexDirection: 'row',
        flexWrap: 'wrap',
        justifyContent: 'space-between',
        marginTop: 8,
    },
    policyRightItem: {
        width: '48%',
        flexDirection: 'row',
        alignItems: 'center',
        padding: 12,
        borderRadius: 12,
        marginBottom: 12,
    },
    policyRightText: {
        fontSize: 14,
        fontWeight: '600',
        marginLeft: 8,
    },
    policyContactBtn: {
        flexDirection: 'row',
        alignItems: 'center',
        justifyContent: 'center',
        backgroundColor: '#06b6d4',
        paddingVertical: 14,
        borderRadius: 12,
        marginTop: 20,
    },
    policyContactBtnText: {
        color: '#fff',
        fontSize: 16,
        fontWeight: 'bold',
    },
});


=======================================================
FILE: components\settings\TermsModal.tsx
=======================================================

import { Ionicons } from '@expo/vector-icons';
import * as Haptics from 'expo-haptics';
import { LinearGradient } from 'expo-linear-gradient';
import React from 'react';
import { Linking, Modal, ScrollView, StyleSheet, Text, TouchableOpacity, View } from 'react-native';
import { useSafeAreaInsets } from 'react-native-safe-area-context';

interface TermsModalProps {
    visible: boolean;
    onClose: () => void;
    colors: any;
    isDark: boolean;
}

export const TermsModal = ({ visible, onClose, colors, isDark }: TermsModalProps) => {
    const insets = useSafeAreaInsets();
    return (
        <Modal
            animationType="slide"
            transparent={false}
            visible={visible}
            onRequestClose={onClose}
        >
            <View style={[styles.modalContainer, { backgroundColor: colors.background }]}>
                <ScrollView
                    showsVerticalScrollIndicator={false}
                    bounces={false}
                >
                    <LinearGradient
                        colors={isDark ? ['#7c3aed', '#4c1d95'] : ['#8b5cf6', '#6d28d9']}
                        style={[styles.policyHeader, { paddingTop: insets.top }]}
                    >
                        <View style={styles.policyHeaderContent}>
                            <TouchableOpacity onPress={onClose} style={styles.policyBackBtn}>
                                <Ionicons name="arrow-back" size={24} color="#fff" />
                            </TouchableOpacity>
                            <View style={styles.policyHeaderIcon}>
                                <Ionicons name="document-text" size={48} color="#fff" />
                            </View>
                            <Text style={styles.policyHeaderTitle}>Terms of Service</Text>
                            <Text style={styles.policyHeaderSubtitle}>Last updated: February 2026</Text>
                        </View>
                    </LinearGradient>

                    <View style={styles.policyScrollContent}>
                        {/* Acceptance Card */}
                        <View style={[styles.policySectionCard, { backgroundColor: colors.card, borderColor: colors.cardBorder }]}>
                            <View style={[styles.policySectionIcon, { backgroundColor: '#8b5cf6' + '20' }]}>
                                <Ionicons name="checkbox" size={24} color="#8b5cf6" />
                            </View>
                            <Text style={[styles.policySectionTitle, { color: colors.text }]}>Acceptance of Terms</Text>
                            <Text style={[styles.policySectionText, { color: colors.textSecondary }]}>
                                By downloading, installing, or using Clgpo, you agree to be bound by these Terms of Service. If you do not agree, please do not use the application.
                            </Text>
                        </View>

                        {/* Service Description Card */}
                        <View style={[styles.policySectionCard, { backgroundColor: colors.card, borderColor: colors.cardBorder }]}>
                            <View style={[styles.policySectionIcon, { backgroundColor: '#3b82f6' + '20' }]}>
                                <Ionicons name="apps" size={24} color="#3b82f6" />
                            </View>
                            <Text style={[styles.policySectionTitle, { color: colors.text }]}>Description of Service</Text>
                            <Text style={[styles.policySectionText, { color: colors.textSecondary, marginBottom: 12 }]}>
                                Clgpo is a student utility application that helps you track your college attendance by connecting to your ERP system.
                            </Text>

                            {['Real-time attendance tracking', 'Predictions & analytics', 'Exam results viewing', 'Fee receipt management', 'Smart notifications'].map((item, index) => (
                                <View key={index} style={styles.policyListItem}>
                                    <Ionicons name="checkmark-circle" size={18} color="#3b82f6" style={{ marginRight: 10 }} />
                                    <Text style={[styles.policyListText, { color: colors.textSecondary }]}>{item}</Text>
                                </View>
                            ))}
                        </View>

                        {/* User Responsibilities Card */}
                        <View style={[styles.policySectionCard, { backgroundColor: colors.card, borderColor: colors.cardBorder }]}>
                            <View style={[styles.policySectionIcon, { backgroundColor: '#f59e0b' + '20' }]}>
                                <Ionicons name="person-circle" size={24} color="#f59e0b" />
                            </View>
                            <Text style={[styles.policySectionTitle, { color: colors.text }]}>User Responsibilities</Text>

                            {['Keep login credentials confidential', 'Use only for intended purpose', 'Maintain device security', 'No reverse engineering', 'Follow institution policies'].map((item, index) => (
                                <View key={index} style={styles.policyListItem}>
                                    <Ionicons name="alert-circle" size={18} color="#f59e0b" style={{ marginRight: 10 }} />
                                    <Text style={[styles.policyListText, { color: colors.textSecondary }]}>{item}</Text>
                                </View>
                            ))}
                        </View>

                        {/* Disclaimer Banner */}
                        <LinearGradient
                            colors={isDark ? ['#7f1d1d', '#450a0a'] : ['#fef2f2', '#fecaca']}
                            style={styles.policyBanner}
                        >
                            <Ionicons name="warning" size={32} color={isDark ? '#fca5a5' : '#b91c1c'} />
                            <View style={{ marginLeft: 12, flex: 1 }}>
                                <Text style={[styles.policyBannerTitle, { color: isDark ? '#fff' : '#7f1d1d' }]}>Disclaimer</Text>
                                <Text style={[styles.policyBannerText, { color: isDark ? '#fecaca' : '#991b1b' }]}>Clgpo is provided &quot;as is&quot; without warranties. Data accuracy depends on ERP system.</Text>
                            </View>
                        </LinearGradient>

                        {/* Liability Card */}
                        <View style={[styles.policySectionCard, { backgroundColor: colors.card, borderColor: colors.cardBorder }]}>
                            <View style={[styles.policySectionIcon, { backgroundColor: '#ef4444' + '20' }]}>
                                <Ionicons name="shield-half" size={24} color="#ef4444" />
                            </View>
                            <Text style={[styles.policySectionTitle, { color: colors.text }]}>Limitation of Liability</Text>
                            <Text style={[styles.policySectionText, { color: colors.textSecondary }]}>
                                Clgpo and its developers shall not be liable for any damages arising from use or inability to use the application, incorrect data, or academic decisions made based on app information.
                            </Text>
                        </View>

                        {/* Legal Grid */}
                        <View style={[styles.policySectionCard, { backgroundColor: colors.card, borderColor: colors.cardBorder }]}>
                            <View style={[styles.policySectionIcon, { backgroundColor: '#6366f1' + '20' }]}>
                                <Ionicons name="library" size={24} color="#6366f1" />
                            </View>
                            <Text style={[styles.policySectionTitle, { color: colors.text }]}>Legal Terms</Text>

                            <View style={styles.policyRightsGrid}>
                                <View style={[styles.policyRightItem, { backgroundColor: colors.badge }]}>
                                    <Ionicons name="bulb" size={20} color="#f59e0b" />
                                    <Text style={[styles.policyRightText, { color: colors.text }]}>IP Rights</Text>
                                </View>
                                <View style={[styles.policyRightItem, { backgroundColor: colors.badge }]}>
                                    <Ionicons name="link" size={20} color="#3b82f6" />
                                    <Text style={[styles.policyRightText, { color: colors.text }]}>Third-Party</Text>
                                </View>
                                <View style={[styles.policyRightItem, { backgroundColor: colors.badge }]}>
                                    <Ionicons name="close-circle" size={20} color="#ef4444" />
                                    <Text style={[styles.policyRightText, { color: colors.text }]}>Termination</Text>
                                </View>
                                <View style={[styles.policyRightItem, { backgroundColor: colors.badge }]}>
                                    <Ionicons name="refresh" size={20} color="#10b981" />
                                    <Text style={[styles.policyRightText, { color: colors.text }]}>Updates</Text>
                                </View>
                            </View>
                        </View>

                        {/* Contact Card */}
                        <View style={[styles.policySectionCard, { backgroundColor: colors.card, borderColor: colors.cardBorder, marginBottom: 40 }]}>
                            <View style={[styles.policySectionIcon, { backgroundColor: '#8b5cf6' + '20' }]}>
                                <Ionicons name="chatbubbles" size={24} color="#8b5cf6" />
                            </View>
                            <Text style={[styles.policySectionTitle, { color: colors.text }]}>Questions?</Text>
                            <Text style={[styles.policySectionText, { color: colors.textSecondary }]}>
                                Have questions about these Terms of Service?
                            </Text>
                            <TouchableOpacity
                                style={[styles.policyContactBtn, { backgroundColor: '#8b5cf6' }]}
                                onPress={() => { Haptics.impactAsync(Haptics.ImpactFeedbackStyle.Light); Linking.openURL('https://www.linkedin.com/in/bharatkumarkovilapu/'); }}
                            >
                            </TouchableOpacity>
                        </View>
                    </View>
                </ScrollView>
            </View>
        </Modal >
    );
};

const styles = StyleSheet.create({
    modalContainer: {
        flex: 1,
    },
    policyHeader: {
        paddingBottom: 20,
        borderBottomLeftRadius: 30,
        borderBottomRightRadius: 30,
        shadowColor: '#000',
        shadowOffset: { width: 0, height: 4 },
        shadowOpacity: 0.15,
        shadowRadius: 12,
        elevation: 8,
    },
    policyHeaderContent: {
        alignItems: 'center',
        paddingHorizontal: 20,
        paddingTop: 10,
    },
    policyBackBtn: {
        position: 'absolute',
        top: 10,
        left: 20,
        width: 40,
        height: 40,
        justifyContent: 'center',
        alignItems: 'center',
        backgroundColor: 'rgba(255,255,255,0.2)',
        borderRadius: 20,
    },
    policyHeaderIcon: {
        width: 80,
        height: 80,
        backgroundColor: 'rgba(255,255,255,0.2)',
        borderRadius: 40,
        justifyContent: 'center',
        alignItems: 'center',
        marginBottom: 16,
    },
    policyHeaderTitle: {
        fontSize: 28,
        fontWeight: 'bold',
        color: '#fff',
        marginBottom: 8,
    },
    policyHeaderSubtitle: {
        fontSize: 14,
        color: 'rgba(255,255,255,0.8)',
    },
    policyScrollContent: {
        padding: 20,
    },
    policySectionCard: {
        borderRadius: 20,
        padding: 20,
        marginBottom: 20,
        borderWidth: 1,
        shadowColor: '#000',
        shadowOffset: { width: 0, height: 2 },
        shadowOpacity: 0.05,
        shadowRadius: 8,
        elevation: 2,
    },
    policySectionIcon: {
        width: 48,
        height: 48,
        borderRadius: 24,
        justifyContent: 'center',
        alignItems: 'center',
        marginBottom: 16,
    },
    policySectionTitle: {
        fontSize: 20,
        fontWeight: 'bold',
        marginBottom: 12,
    },
    policySectionText: {
        fontSize: 15,
        lineHeight: 24,
    },
    policyListItem: {
        flexDirection: 'row',
        alignItems: 'center',
        marginTop: 12,
    },
    policyListText: {
        fontSize: 15,
        flex: 1,
    },
    policyBanner: {
        flexDirection: 'row',
        alignItems: 'center',
        padding: 20,
        borderRadius: 20,
        marginBottom: 20,
    },
    policyBannerTitle: {
        fontSize: 16,
        fontWeight: 'bold',
        marginBottom: 4,
    },
    policyBannerText: {
        fontSize: 13,
        lineHeight: 18,
    },
    policyRightsGrid: {
        flexDirection: 'row',
        flexWrap: 'wrap',
        justifyContent: 'space-between',
        marginTop: 8,
    },
    policyRightItem: {
        width: '48%',
        flexDirection: 'row',
        alignItems: 'center',
        padding: 12,
        borderRadius: 12,
        marginBottom: 12,
    },
    policyRightText: {
        fontSize: 14,
        fontWeight: '600',
        marginLeft: 8,
    },
    policyContactBtn: {
        flexDirection: 'row',
        alignItems: 'center',
        justifyContent: 'center',
        backgroundColor: '#06b6d4',
        paddingVertical: 14,
        borderRadius: 12,
        marginTop: 20,
    },
    policyContactBtnText: {
        color: '#fff',
        fontSize: 16,
        fontWeight: 'bold',
    },
});


=======================================================
FILE: components\SkeletonLoader.tsx
=======================================================


import React, { useEffect } from 'react';
import { StyleSheet, View } from 'react-native';
import Animated, {
    interpolate,
    useAnimatedStyle,
    useSharedValue,
    withRepeat,
    withTiming,
} from 'react-native-reanimated';

interface SkeletonLoaderProps {
    width: number | string;
    height: number;
    borderRadius?: number;
    style?: any;
}

export const SkeletonLoader = ({ width, height, borderRadius = 8, style }: SkeletonLoaderProps) => {
    const shimmer = useSharedValue(0);

    useEffect(() => {
        // Breathing pulse animation
        shimmer.value = withRepeat(
            withTiming(1, { duration: 1500 }),
            -1,
            true // Reverse for smooth breathing
        );
    }, [shimmer]);

    const animatedStyle = useAnimatedStyle(() => {
        const opacity = interpolate(
            shimmer.value,
            [0, 1],
            [0.3, 0.6] // Subtle lighting change
        );
        return { opacity };
    });

    return (
        <Animated.View
            style={[
                styles.skeleton,
                { width, height, borderRadius },
                animatedStyle,
                style,
            ]}
        />
    );
};

// Pre-made skeleton patterns
export const CardSkeleton = ({ colors }: { colors: any }) => (
    <View style={[styles.card, { backgroundColor: colors.card, borderColor: colors.cardBorder }]}>
        <View style={styles.cardHeader}>
            <SkeletonLoader width={50} height={50} borderRadius={25} />
            <View style={styles.cardHeaderText}>
                <SkeletonLoader width={150} height={16} />
                <SkeletonLoader width={100} height={12} style={{ marginTop: 8 }} />
            </View>
        </View>
        <SkeletonLoader width="100%" height={60} style={{ marginTop: 16 }} />
    </View>
);

export const ListSkeleton = ({ count = 3, colors }: { count?: number; colors: any }) => (
    <View>
        {Array.from({ length: count }).map((_, i) => (
            <View key={i} style={[styles.listItem, { borderBottomColor: colors.cardBorder }]}>
                <SkeletonLoader width={40} height={40} borderRadius={10} />
                <View style={{ flex: 1, marginLeft: 12 }}>
                    <SkeletonLoader width="70%" height={14} />
                    <SkeletonLoader width="50%" height={12} style={{ marginTop: 6 }} />
                </View>
            </View>
        ))}
    </View>
);

const styles = StyleSheet.create({
    skeleton: {
        backgroundColor: 'rgba(150, 150, 150, 0.2)',
    },
    card: {
        padding: 16,
        borderRadius: 16,
        borderWidth: 1,
        marginBottom: 16,
    },
    cardHeader: {
        flexDirection: 'row',
        alignItems: 'center',
    },
    cardHeaderText: {
        marginLeft: 12,
        flex: 1,
    },
    listItem: {
        flexDirection: 'row',
        alignItems: 'center',
        paddingVertical: 12,
        borderBottomWidth: 1,
    },
});


=======================================================
FILE: components\SmartBunkPlanner.tsx
=======================================================

import { Ionicons } from '@expo/vector-icons';
import * as Haptics from 'expo-haptics';
import React, { useState } from 'react';
import { StyleSheet, Text, View } from 'react-native';
import { Slider } from 'react-native-awesome-slider';
import { Calendar, DateData } from 'react-native-calendars';
import { useSharedValue } from 'react-native-reanimated';

interface SmartBunkPlannerProps {
    currentAttended: number;
    currentTotal: number;
    currentPercentage: number;
    colors: any;
}

// Date state types: 'attend' (green) ‚Üí 'bunk' (red) ‚Üí removed
interface DateState {
    type: 'attend' | 'bunk';
    marking: any;
}

export const SmartBunkPlanner = ({ currentAttended, currentTotal, currentPercentage, colors }: SmartBunkPlannerProps) => {
    const [selectedDates, setSelectedDates] = useState<{ [key: string]: DateState }>({});
    const [classesPerDay, setClassesPerDay] = useState(6);

    // Slider shared values
    const progress = useSharedValue(6);
    const min = useSharedValue(1);
    const max = useSharedValue(7);

    // Generate Sundays for the current and next year
    const getSundays = () => {
        const sundays: { [key: string]: any } = {};
        const today = new Date();
        const start = new Date(today.getFullYear(), 0, 1);
        const end = new Date(today.getFullYear() + 2, 0, 1); // 2 years range

        let current = new Date(start);
        // Find first Sunday
        while (current.getDay() !== 0) {
            current.setDate(current.getDate() + 1);
        }

        while (current < end) {
            const year = current.getFullYear();
            const month = String(current.getMonth() + 1).padStart(2, '0');
            const day = String(current.getDate()).padStart(2, '0');
            const dateStr = `${year}-${month}-${day}`;

            sundays[dateStr] = {
                disabled: true,
                disableTouchEvent: true,
                customStyles: {
                    container: {
                        backgroundColor: colors.cardBorder ? (colors.cardBorder + '40') : 'rgba(150,150,150,0.1)',
                        borderRadius: 8
                    },
                    text: {
                        color: colors.textSecondary,
                        opacity: 0.5
                    }
                }
            };
            current.setDate(current.getDate() + 7);
        }
        return sundays;
    };

    // Memoize sundays
    const [sundays] = useState(getSundays());

    // Cycle: none ‚Üí attend (green) ‚Üí bunk (red) ‚Üí none
    const onDayPress = (day: DateData) => {
        const date = day.dateString;

        // Prevent selecting Sundays
        if (sundays[date]) return;

        Haptics.selectionAsync();
        const newDates = { ...selectedDates };

        if (!newDates[date]) {
            // First tap: Attend (green)
            newDates[date] = {
                type: 'attend',
                marking: {
                    selected: true,
                    selectedColor: colors.success,
                    customStyles: {
                        container: { borderRadius: 20, elevation: 2 }
                    }
                }
            };
        } else if (newDates[date].type === 'attend') {
            // Second tap: Bunk (red)
            newDates[date] = {
                type: 'bunk',
                marking: {
                    selected: true,
                    selectedColor: colors.error || '#FF3B30',
                    customStyles: {
                        container: { borderRadius: 20, elevation: 2 }
                    }
                }
            };
        } else {
            // Third tap: Remove
            delete newDates[date];
        }
        setSelectedDates(newDates);
    };

    // Build calendar markings from state
    const getMarkedDates = () => {
        const markings: { [key: string]: any } = {};
        Object.entries(selectedDates).forEach(([date, state]) => {
            markings[date] = state.marking;
        });
        return { ...sundays, ...markings };
    };

    // Count attend and bunk days separately
    const attendDays = Object.values(selectedDates).filter(d => d.type === 'attend').length;
    const bunkDays = Object.values(selectedDates).filter(d => d.type === 'bunk').length;
    const attendClasses = attendDays * classesPerDay;
    const bunkClasses = bunkDays * classesPerDay;
    const totalClasses = attendClasses + bunkClasses;

    // Calculate combined effect
    // For bunked classes: total increases, attended stays same
    // For attended classes: both total and attended increase
    const futureTotal = currentTotal + totalClasses;
    const futureAttended = currentAttended + attendClasses; // Only attend classes add to attended
    const futurePercentage = futureTotal > 0 ? (futureAttended / futureTotal) * 100 : currentPercentage;
    const percentChange = futurePercentage - currentPercentage;
    const isSafe = futurePercentage >= 75;
    const hasSelections = attendDays > 0 || bunkDays > 0;

    return (
        <View style={styles.container}>
            {/* Compact legend */}
            <View style={{ flexDirection: 'row', alignItems: 'center', justifyContent: 'center', marginBottom: 12, paddingHorizontal: 8 }}>
                <View style={{ width: 14, height: 14, borderRadius: 7, backgroundColor: colors.success, marginRight: 4 }} />
                <Text style={{ color: colors.textSecondary, fontSize: 11, marginRight: 12 }}>Attend</Text>
                <View style={{ width: 14, height: 14, borderRadius: 7, backgroundColor: colors.error, marginRight: 4 }} />
                <Text style={{ color: colors.textSecondary, fontSize: 11, marginRight: 12 }}>Bunk</Text>
                <Text style={{ color: colors.textSecondary, fontSize: 11 }}>Tap to cycle</Text>
            </View>

            <View style={[styles.card, { backgroundColor: colors.card, padding: 16 }]}>
                <View style={{ flexDirection: 'row', alignItems: 'center', marginBottom: 16 }}>
                    <Ionicons name="calendar" size={20} color={colors.primary} style={{ marginRight: 8 }} />
                    <Text style={[styles.cardTitle, { color: colors.text }]}>Plan Your Days</Text>
                </View>

                <Calendar
                    key={colors.text} // Force re-render on theme change
                    onDayPress={onDayPress}
                    markedDates={getMarkedDates()}
                    markingType={'custom'}
                    enableSwipeMonths={true}
                    hideExtraDays={true}
                    theme={{
                        backgroundColor: 'transparent',
                        calendarBackground: 'transparent',
                        textSectionTitleColor: colors.textSecondary,
                        selectedDayBackgroundColor: colors.primary,
                        selectedDayTextColor: '#ffffff',
                        todayTextColor: colors.primary,
                        dayTextColor: colors.text,
                        textDisabledColor: colors.cardBorder,
                        dotColor: colors.primary,
                        selectedDotColor: '#ffffff',
                        arrowColor: colors.primary,
                        disabledArrowColor: colors.cardBorder,
                        monthTextColor: colors.text,
                        indicatorColor: colors.primary,
                        textDayFontWeight: '500',
                        textMonthFontWeight: 'bold',
                        textDayHeaderFontWeight: '600',
                        textDayFontSize: 16,
                        textMonthFontSize: 20,
                        textDayHeaderFontSize: 12,
                        // @ts-ignore
                        'stylesheet.calendar.header': {
                            header: {
                                flexDirection: 'row',
                                justifyContent: 'space-between',
                                paddingLeft: 10,
                                paddingRight: 10,
                                marginTop: 6,
                                alignItems: 'center',
                                marginBottom: 10
                            },
                            monthText: {
                                fontSize: 18,
                                fontWeight: '700',
                                color: colors.text,
                                margin: 10
                            }
                        }
                    }}
                    renderArrow={(direction) => (
                        <View style={{
                            backgroundColor: colors.cardBorder,
                            padding: 8,
                            borderRadius: 12,
                            opacity: 0.5
                        }}>
                            <Ionicons name={direction === 'left' ? "chevron-back" : "chevron-forward"} size={18} color={colors.text} />
                        </View>
                    )}
                    style={{
                        borderRadius: 16,
                        overflow: 'hidden',
                        paddingBottom: 10
                    }}
                />
            </View>

            <View style={[styles.card, { backgroundColor: colors.card, padding: 16 }]}>
                <Text style={{ color: colors.textSecondary, fontSize: 13, fontWeight: '600', marginBottom: 12 }}>CLASSES PER DAY ESTIMATE</Text>

                <View style={{ flexDirection: 'row', justifyContent: 'space-between', marginBottom: 16, alignItems: 'center' }}>
                    <Text style={{ fontSize: 28, fontWeight: 'bold', color: colors.text }}>{classesPerDay}</Text>
                    <Text style={{ color: colors.textSecondary }}>Classes/Day</Text>
                </View>

                <View style={{ height: 40 }}>
                    <Slider
                        style={{ width: '100%', height: 40 }}
                        progress={progress}
                        minimumValue={min}
                        maximumValue={max}
                        step={1}
                        onValueChange={(val) => setClassesPerDay(Math.round(val))}
                        theme={{
                            minimumTrackTintColor: colors.textSecondary,
                            maximumTrackTintColor: colors.cardBorder || '#ccc',
                            bubbleBackgroundColor: '#0000',
                        }}
                        thumbWidth={20}
                        renderBubble={() => null}
                    />
                </View>
            </View>

            {hasSelections && (
                <View style={[styles.resultCard, {
                    backgroundColor: isSafe ? (colors.success + '15') : (colors.error + '15'),
                    borderColor: isSafe ? colors.success : colors.error,
                    borderWidth: 1
                }]}>
                    {/* Selection Summary */}
                    <View style={{ marginBottom: 12 }}>
                        {attendDays > 0 && (
                            <View style={{ flexDirection: 'row', alignItems: 'center', marginBottom: 4 }}>
                                <View style={{ width: 12, height: 12, borderRadius: 6, backgroundColor: colors.success, marginRight: 8 }} />
                                <Text style={{ color: colors.text, fontSize: 14 }}>
                                    Attend: <Text style={{ fontWeight: 'bold' }}>{attendDays} days</Text> ({attendClasses} classes)
                                </Text>
                            </View>
                        )}
                        {bunkDays > 0 && (
                            <View style={{ flexDirection: 'row', alignItems: 'center' }}>
                                <View style={{ width: 12, height: 12, borderRadius: 6, backgroundColor: colors.error, marginRight: 8 }} />
                                <Text style={{ color: colors.text, fontSize: 14 }}>
                                    Bunk: <Text style={{ fontWeight: 'bold' }}>{bunkDays} days</Text> ({bunkClasses} classes)
                                </Text>
                            </View>
                        )}
                    </View>

                    <View style={{ flexDirection: 'row', justifyContent: 'space-between', alignItems: 'center' }}>
                        <View>
                            <Text style={{ color: colors.textSecondary, fontSize: 12 }}>New Percentage</Text>
                            <Text style={{
                                fontSize: 32,
                                fontWeight: 'bold',
                                color: isSafe ? colors.success : colors.error
                            }}>
                                {futurePercentage.toFixed(2)}%
                            </Text>
                        </View>

                        <View style={{ alignItems: 'flex-end' }}>
                            <View style={{ flexDirection: 'row', alignItems: 'center', marginBottom: 4 }}>
                                <Ionicons
                                    name={percentChange >= 0 ? "arrow-up" : "arrow-down"}
                                    size={16}
                                    color={percentChange >= 0 ? colors.success : colors.error}
                                />
                                <Text style={{
                                    color: percentChange >= 0 ? colors.success : colors.error,
                                    fontWeight: 'bold',
                                    fontSize: 16
                                }}>{percentChange >= 0 ? '+' : ''}{percentChange.toFixed(2)}%</Text>
                            </View>
                            <Text style={{ color: colors.textSecondary, fontSize: 12 }}>
                                {percentChange >= 0 ? 'Increase' : 'Drop'}
                            </Text>
                        </View>
                    </View>

                    {!isSafe && (
                        <View style={{ marginTop: 12, flexDirection: 'row', alignItems: 'center' }}>
                            <Ionicons name="warning" size={16} color={colors.error} style={{ marginRight: 6 }} />
                            <Text style={{ color: colors.error, fontSize: 13, fontWeight: '600' }}>Warning: Attendance will fall below 75%!</Text>
                        </View>
                    )}
                    {isSafe && currentPercentage < 75 && futurePercentage >= 75 && (
                        <View style={{ marginTop: 12, flexDirection: 'row', alignItems: 'center' }}>
                            <Ionicons name="checkmark-circle" size={16} color={colors.success} style={{ marginRight: 6 }} />
                            <Text style={{ color: colors.success, fontSize: 13, fontWeight: '600' }}>Great! This will bring you above 75%!</Text>
                        </View>
                    )}
                </View>
            )}


        </View>
    );
};

const styles = StyleSheet.create({
    container: {
        marginTop: 0,
    },
    card: {
        borderRadius: 16,
        marginBottom: 16,
    },
    cardTitle: {
        fontSize: 16,
        fontWeight: 'bold',
    },
    resultCard: {
        padding: 20,
        borderRadius: 16,
        marginBottom: 20
    }
});


=======================================================
FILE: constants\config.ts
=======================================================

export const API_CONFIG = {
    BASE_URL: 'https://www.nrcmec.org',
    ENDPOINTS: {
        LOGIN: '/Student/login.php',
        ATTENDANCE: '/Student/Date_wise_attendance.php',
        FEE_RECEIPT: '/Student/Fee_Receipt',
        RESULTS: 'https://erp.nrcmec.org/StudentLogin/Student/overallMarks.aspx',
    },
    HEADERS: {
        USER_AGENT: 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36',
        CONTENT_TYPE: 'application/x-www-form-urlencoded',
    },
    TIMEOUT: 30000,
};


=======================================================
FILE: constants\theme.ts
=======================================================

/**
 * Below are the colors that are used in the app. The colors are defined in the light and dark mode.
 * There are many other ways to style your app. For example, [Nativewind](https://www.nativewind.dev/), [Tamagui](https://tamagui.dev/), [unistyles](https://reactnativeunistyles.vercel.app), etc.
 */

import { Platform } from 'react-native';

const tintColorLight = '#0a7ea4';
const tintColorDark = '#fff';

export const Colors = {
  light: {
    text: '#11181C',
    textSecondary: '#687076',
    background: '#F2F2F7',
    card: '#FFFFFF',
    cardBorder: '#E5E5EA',
    tint: tintColorLight,
    icon: '#687076',
    tabIconDefault: '#687076',
    tabIconSelected: tintColorLight,
    success: '#34C759',
    successBg: 'rgba(52,199,89,0.15)',
    warning: '#FFD60A',
    warningBg: 'rgba(255,214,10,0.15)',
    error: '#FF453A',
    errorBg: 'rgba(255,69,58,0.15)',
    primary: '#007AFF', // or #4a6cf7
    badge: '#E5E5EA',
    badgeText: '#11181C',
  },
  dark: {
    text: '#ECEDEE',
    textSecondary: '#9BA1A6',
    background: '#000000',
    card: '#1c1c1e',
    cardBorder: 'rgba(255,255,255,0.1)',
    tint: tintColorDark,
    icon: '#9BA1A6',
    tabIconDefault: '#9BA1A6',
    tabIconSelected: tintColorDark,
    success: '#32D74B',
    successBg: 'rgba(50,215,75,0.15)',
    warning: '#FFD60A',
    warningBg: 'rgba(255,214,10,0.15)',
    error: '#FF453A',
    errorBg: 'rgba(255,69,58,0.15)',
    primary: '#0A84FF', // High contrast blue
    badge: '#3a3a3c',
    badgeText: '#fff',
  },
};

export const Fonts = Platform.select({
  ios: {
    /** iOS `UIFontDescriptorSystemDesignDefault` */
    sans: 'system-ui',
    /** iOS `UIFontDescriptorSystemDesignSerif` */
    serif: 'ui-serif',
    /** iOS `UIFontDescriptorSystemDesignRounded` */
    rounded: 'ui-rounded',
    /** iOS `UIFontDescriptorSystemDesignMonospaced` */
    mono: 'ui-monospace',
  },
  default: {
    sans: 'normal',
    serif: 'serif',
    rounded: 'normal',
    mono: 'monospace',
  },
  web: {
    sans: "system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif",
    serif: "Georgia, 'Times New Roman', serif",
    rounded: "'SF Pro Rounded', 'Hiragino Maru Gothic ProN', Meiryo, 'MS PGothic', sans-serif",
    mono: "SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace",
  },
});


=======================================================
FILE: context\ResultsContext.tsx
=======================================================

import React, { createContext, useCallback, useContext, useState } from 'react';
import { ResultsData, ResultsService } from '../services/results';

type ResultsContextType = {
    showResults: () => void;
    hideResults: () => void;
    isVisible: boolean;
    results: ResultsData | null;
    loading: boolean;
    error: string | null;
    setResultsData: (data: ResultsData | null) => void;
    setLoadingState: (loading: boolean) => void;
    setErrorState: (error: string | null) => void;
    initFetch: () => void;
    fetchSignal: number;
};

const ResultsContext = createContext<ResultsContextType>({
    showResults: () => { },
    hideResults: () => { },
    isVisible: false,
    results: null,
    loading: false,
    error: null,
    setResultsData: () => { },
    setLoadingState: () => { },
    setErrorState: () => { },
    initFetch: () => { },
    fetchSignal: 0,
});

export const ResultsProvider: React.FC<{ children: React.ReactNode }> = ({ children }) => {
    const [isVisible, setIsVisible] = useState(false);
    const [results, setResults] = useState<ResultsData | null>(null);
    const [loading, setLoading] = useState(false);
    const [error, setError] = useState<string | null>(null);
    // New: trigger signal for ResultsOverlay to start fetching
    const [fetchSignal, setFetchSignal] = useState(0);

    // Helpers to allow consumers to update state
    const setResultsData = useCallback((data: ResultsData | null) => setResults(data), []);
    const setLoadingState = useCallback((l: boolean) => setLoading(l), []);
    const setErrorState = useCallback((e: string | null) => setError(e), []);

    // Load cache helper
    const loadCache = useCallback(async () => {
        if (!results) {
            const cached = await ResultsService.getCachedResults();
            if (cached) setResults(cached);
        }
    }, [results]);

    const showResults = () => {
        setIsVisible(true);
        loadCache();
    };

    const hideResults = () => setIsVisible(false);

    const initFetch = useCallback(() => {
        setLoading(true);
        setFetchSignal(prev => prev + 1);
    }, []);

    return (
        <ResultsContext.Provider value={{
            showResults,
            hideResults,
            isVisible,
            results,
            loading,
            error,
            setResultsData,
            setLoadingState,
            setErrorState,
            initFetch,
            fetchSignal
        }}>
            {children}
        </ResultsContext.Provider>
    );
};

export const useResults = () => useContext(ResultsContext);


=======================================================
FILE: context\ThemeContext.tsx
=======================================================

import { Colors } from '@/constants/theme';
import * as SecureStore from 'expo-secure-store';
import React, { createContext, useContext, useEffect, useState } from 'react';
import { useColorScheme as useSystemColorScheme } from 'react-native';

type ThemeMode = 'light' | 'dark' | 'system';

interface ThemeContextType {
    themeMode: ThemeMode;
    colors: typeof Colors.light;
    isDark: boolean;
    setThemeMode: (mode: ThemeMode) => Promise<void>;
    toggleTheme: () => Promise<void>;
}

const THEME_KEY = 'user_theme_preference';

const ThemeContext = createContext<ThemeContextType | undefined>(undefined);

export function ThemeProvider({ children }: { children: React.ReactNode }) {
    const systemColorScheme = useSystemColorScheme();
    const [themeMode, setThemeModeState] = useState<ThemeMode>('system');

    // Load saved preference on mount
    useEffect(() => {
        const loadTheme = async () => {
            try {
                const savedTheme = await SecureStore.getItemAsync(THEME_KEY);
                if (savedTheme === 'light' || savedTheme === 'dark' || savedTheme === 'system') {
                    setThemeModeState(savedTheme);
                }
            } catch {
                // Theme loading failed, using default
            }
        };
        loadTheme();
    }, []);

    const setThemeMode = async (mode: ThemeMode) => {
        setThemeModeState(mode);
        await SecureStore.setItemAsync(THEME_KEY, mode);
    };

    const toggleTheme = async () => {
        // If currently system, assume the active invalid; otherwise simple toggle
        const currentActive = themeMode === 'system' ? systemColorScheme : themeMode;
        const newMode = currentActive === 'dark' ? 'light' : 'dark';
        await setThemeMode(newMode);
    };

    const effectiveTheme = themeMode === 'system'
        ? (systemColorScheme === 'dark' ? 'dark' : 'light')
        : themeMode;

    const colors = Colors[effectiveTheme || 'light'];

    return (
        <ThemeContext.Provider value={{
            themeMode,
            colors,
            isDark: effectiveTheme === 'dark',
            setThemeMode,
            toggleTheme
        }}>
            {children}
        </ThemeContext.Provider>
    );
}

export function useTheme() {
    const context = useContext(ThemeContext);
    if (context === undefined) {
        throw new Error('useTheme must be used within a ThemeProvider');
    }
    return context;
}


=======================================================
FILE: eas.json
=======================================================

{
    "cli": {
        "version": ">= 14.0.0"
    },
    "build": {
        "development": {
            "developmentClient": true,
            "distribution": "internal"
        },
        "preview": {
            "distribution": "internal",
            "android": {
                "buildType": "apk"
            }
        },
        "production": {
            "android": {
                "buildType": "app-bundle"
            }
        }
    },
    "submit": {
        "production": {}
    }
}

=======================================================
FILE: expo-env.d.ts
=======================================================

/// <reference types="expo/types" />

// NOTE: This file should not be edited and should be in your git ignore

=======================================================
FILE: hooks\use-color-scheme.ts
=======================================================

export { useColorScheme } from 'react-native';


=======================================================
FILE: hooks\use-color-scheme.web.ts
=======================================================

import { useEffect, useState } from 'react';
import { useColorScheme as useRNColorScheme } from 'react-native';

/**
 * To support static rendering, this value needs to be re-calculated on the client side for web
 */
export function useColorScheme() {
  const [hasHydrated, setHasHydrated] = useState(false);

  useEffect(() => {
    setHasHydrated(true);
  }, []);

  const colorScheme = useRNColorScheme();

  if (hasHydrated) {
    return colorScheme;
  }

  return 'light';
}


=======================================================
FILE: hooks\useLogout.ts
=======================================================

import { useRouter } from 'expo-router';
import { useState } from 'react';
import { AuthService } from '../services/auth';

export const useLogout = () => {
  const [loggingOut, setLoggingOut] = useState(false);
  const router = useRouter();

  const handleLogout = async () => {
    // Safety fallback: if everything hangs, force navigation after 3 seconds
    const forceTimer = setTimeout(() => {
      setLoggingOut(false);
      router.replace('/');
    }, 3000);

    try {
      setLoggingOut(true);

      // Race the logout against a 1.5-second timeout (improved responsiveness)
      const logoutPromise = AuthService.logout()
        .catch(() => { /* AuthService logout error */ });

      const timeoutPromise = new Promise(resolve => setTimeout(resolve, 1500));

      await Promise.race([logoutPromise, timeoutPromise]);

      // Cancel the force timer as we are about to navigate normally
      clearTimeout(forceTimer);

      // Add a small delay to ensure state updates settle before navigation
      setTimeout(() => {
        setLoggingOut(false);
        try {
          if (router.canDismiss()) router.dismissAll();
        } catch {
          // ignore
        }
        router.replace('/login');
      }, 100);

    } catch {
      router.replace('/login');
    }
  };

  return { handleLogout, loggingOut };
};


=======================================================
FILE: package.json
=======================================================

{
  "name": "clgpo",
  "main": "expo-router/entry",
  "version": "1.0.0",
  "scripts": {
    "start": "expo start",
    "android": "expo start --android",
    "ios": "expo start --ios",
    "web": "expo start --web",
    "lint": "expo lint"
  },
  "dependencies": {
    "@expo/vector-icons": "^15.0.3",
    "@react-native-async-storage/async-storage": "2.2.0",
    "@react-navigation/bottom-tabs": "^7.2.0",
    "@react-navigation/elements": "^2.2.5",
    "@react-navigation/native": "^7.0.14",
    "ajv": "^8.17.1",
    "axios": "^1.7.9",
    "expo": "^54.0.33",
    "expo-background-task": "~1.0.10",
    "expo-blur": "~15.0.8",
    "expo-constants": "~18.0.13",
    "expo-font": "~14.0.11",
    "expo-haptics": "~15.0.8",
    "expo-linear-gradient": "~15.0.8",
    "expo-linking": "~8.0.11",
    "expo-local-authentication": "~17.0.8",
    "expo-notifications": "~0.32.16",
    "expo-router": "~6.0.23",
    "expo-secure-store": "~15.0.8",
    "expo-splash-screen": "~31.0.13",
    "expo-status-bar": "~3.0.9",
    "expo-task-manager": "~14.0.9",
    "react": "19.1.0",
    "react-dom": "19.1.0",
    "react-native": "0.81.5",
    "react-native-awesome-slider": "^2.5.3",
    "react-native-calendars": "^1.1307.0",
    "react-native-cheerio": "^1.0.0-rc.4",
    "react-native-gesture-handler": "~2.28.0",
    "react-native-reanimated": "~4.1.1",
    "react-native-safe-area-context": "~5.6.0",
    "react-native-screens": "~4.16.0",
    "react-native-svg": "15.12.1",
    "react-native-web": "^0.21.0",
    "react-native-webview": "13.15.0",
    "react-native-worklets": "0.5.1"
  },
  "devDependencies": {
    "@babel/core": "^7.20.0",
    "@types/cheerio": "^0.22.35",
    "@types/react": "~19.1.10",
    "eslint": "^8.57.0",
    "eslint-config-expo": "~10.0.0",
    "eslint-config-prettier": "^10.1.8",
    "eslint-plugin-prettier": "^5.5.5",
    "typescript": "^5.3.3"
  },
  "private": true
}


=======================================================
FILE: services\analytics.ts
=======================================================

import { DailyAttendance } from './attendance';

export interface TrendPoint {
    date: string; // ISO or display format
    percentage: number;
    totalClasses: number;
}

export const AnalyticsService = {
    /**
     * Calculates the attendance percentage trend over time.
     * Assumes dailyLogs are mixed order, so it sorts them first.
     */
    calculateTrend: (dailyLogs: DailyAttendance[]): TrendPoint[] => {
        // 1. Sort logs chronologically (Oldest first)
        const sortedLogs = [...dailyLogs].sort((a, b) => {
            const [dA, mA, yA] = a.date.split(/[-./\s]/).map(Number);
            const [dB, mB, yB] = b.date.split(/[-./\s]/).map(Number);
            return new Date(yA, mA - 1, dA).getTime() - new Date(yB, mB - 1, dB).getTime();
        });

        let cumulativeAttended = 0;
        let cumulativeTotal = 0;
        const trend: TrendPoint[] = [];

        sortedLogs.forEach((log) => {
            const pCount = log.periods.filter((p) => p === 'P').length;
            const aCount = log.periods.filter((p) => p === 'A').length;
            const dayTotal = pCount + aCount;

            if (dayTotal > 0) {
                cumulativeAttended += pCount;
                cumulativeTotal += dayTotal;

                trend.push({
                    date: log.date,
                    percentage: (cumulativeAttended / cumulativeTotal) * 100,
                    totalClasses: cumulativeTotal
                });
            }
        });

        return trend;
    },

    /**
     * Calculates how many MORE classes to attend to reach target,
     * OR how many one can skip while staying above target.
     */
    calculateProjection: (currentAttended: number, currentTotal: number, targetPercent: number) => {
        const targetDecimal = targetPercent / 100;
        const currentPercent = currentTotal > 0 ? currentAttended / currentTotal : 0;

        if (currentPercent >= targetDecimal) {
            // We are safe. How many can we skip?
            // (A) / (N + x) >= T
            // A / T >= N + x
            // x <= A/T - N
            const margin = Math.floor(currentAttended / targetDecimal - currentTotal);
            return { type: 'safe', count: Math.max(0, margin) };
        } else {
            // We are unsafe. How many to attend?
            // (A + x) / (N + x) >= T
            // A + x >= TN + Tx
            // x(1 - T) >= TN - A
            // x >= (TN - A) / (1 - T)
            const needed = Math.ceil((targetDecimal * currentTotal - currentAttended) / (1 - targetDecimal));
            return { type: 'danger', count: Math.max(0, needed) };
        }
    },

    calculateStreak: (dailyLogs: DailyAttendance[]) => {
        // Sort newest first
        const sortedLogs = [...dailyLogs].sort((a, b) => {
            const [dA, mA, yA] = a.date.split(/[-./\s]/).map(Number);
            const [dB, mB, yB] = b.date.split(/[-./\s]/).map(Number);
            return new Date(yB, mB - 1, dB).getTime() - new Date(yA, mA - 1, dA).getTime();
        });

        let currentStreak = 0;
        for (const log of sortedLogs) {
            const hasAbsent = log.periods.includes('A');
            if (hasAbsent) break;
            currentStreak++;
        }
        return currentStreak;
    },

    estimateRecoveryDate: (currentAttended: number, currentTotal: number, targetPercent: number = 75) => {
        const targetDecimal = targetPercent / 100;
        if (currentTotal > 0 && (currentAttended / currentTotal) >= targetDecimal) return null; // Already safe

        const classesNeeded = Math.ceil((targetDecimal * currentTotal - currentAttended) / (1 - targetDecimal));
        // Assume 6 periods per day on average
        const daysNeeded = Math.ceil(classesNeeded / 6);

        const date = new Date();
        date.setDate(date.getDate() + daysNeeded);
        return date.toLocaleDateString('en-US', { day: 'numeric', month: 'short' });
    },

    /**
     * Predicts percentage if student attends or misses next N classes
     */
    predictFuture: (currentAttended: number, currentTotal: number, attend: number, miss: number) => {
        const newAttended = currentAttended + attend;
        const newTotal = currentTotal + attend + miss;
        return newTotal === 0 ? 0 : (newAttended / newTotal) * 100;
    }
};


=======================================================
FILE: services\api.ts
=======================================================

import axios from 'axios';
import * as SecureStore from 'expo-secure-store';
import { API_CONFIG } from '../constants/config';
import { ConfigService } from './ConfigService';



const COOKIE_KEY = 'auth_cookie';

const api = axios.create({
    baseURL: API_CONFIG.BASE_URL,
    timeout: API_CONFIG.TIMEOUT,
    headers: {
        'User-Agent': API_CONFIG.HEADERS.USER_AGENT,
        'Content-Type': API_CONFIG.HEADERS.CONTENT_TYPE,
    },
});

// Request interceptor to add cookie and dynamic Base URL
api.interceptors.request.use(async (config) => {
    // 1. Dynamic Base URL from Remote Config
    const dynamicConfig = ConfigService.get();
    config.baseURL = dynamicConfig.BASE_URL;

    // 2. Auth Cookie
    const cookie = await SecureStore.getItemAsync(COOKIE_KEY);
    if (cookie) {
        config.headers.Cookie = cookie;
    }
    return config;
});

export const setAuthCookie = async (cookie: string) => {
    await SecureStore.setItemAsync(COOKIE_KEY, cookie);
};

export const getAuthCookie = async () => {
    return await SecureStore.getItemAsync(COOKIE_KEY);
};

export const clearAuthCookie = async () => {
    await SecureStore.deleteItemAsync(COOKIE_KEY);
};

export default api;


=======================================================
FILE: services\attendance.ts
=======================================================

import { API_CONFIG } from '../constants/config';
import { loadData, saveData, STORAGE_KEYS } from '../utils/storage';
import api from './api';
import { AuthService } from './auth';

// eslint-disable-next-line @typescript-eslint/no-require-imports
const cheerio = require('react-native-cheerio');

export interface MonthlyAttendance {
    month: string;
    attended: number;
    total: number;
    percentage: number;
}

export interface AttendanceResponse {
    overallPercentage: number;
    semesterTotal: {
        attended: number;
        total: number;
    };
    months: MonthlyAttendance[];
    isOffline?: boolean;
}

export interface DailyAttendance {
    date: string;
    day: string;
    periods: string[]; // Array of 'P', 'A', or '-' for each period
}

export interface DateWiseResponse {
    days: DailyAttendance[];
    isOffline?: boolean;
}

export const AttendanceService = {
    getAttendance: async (): Promise<AttendanceResponse> => {
        try {
            let response = await api.get(API_CONFIG.ENDPOINTS.ATTENDANCE);
            let html = response.data;

            // Check if session expired
            if (html.includes('login.php') || html.includes('Enter Roll No') || html.includes('type="password"')) {
                const credentials = await AuthService.getCredentials();
                if (!credentials) throw new Error('Not logged in');
                await AuthService.login(credentials.studentId, credentials.pass);
                response = await api.get(API_CONFIG.ENDPOINTS.ATTENDANCE);
                html = response.data;
            }

            const $ = cheerio.load(html);

            const months: MonthlyAttendance[] = [];
            let semesterTotal = { attended: 0, total: 0 };
            let overallPercentage = 0;

            // 1. Parse Summary Table
            let summaryTable = $('.summary-table');
            if (summaryTable.length === 0) {
                summaryTable = $('table').filter((i: number, el: any) => {
                    const text = $(el).text();
                    return text.includes('Month') && text.includes('Classes Attended');
                });
            }

            summaryTable.find('tbody tr').each((i: number, el: any) => {
                const tds = $(el).find('td');
                const firstColText = $(tds[0]).text().trim();

                if (firstColText.includes('Semester Total')) {
                    const attended = parseInt($(tds[1]).text().trim(), 10);
                    const total = parseInt($(tds[2]).text().trim(), 10);
                    const percentStr = $(tds[3]).text().trim().replace('%', '');

                    semesterTotal = { attended, total };
                    overallPercentage = parseFloat(percentStr);
                } else if (firstColText && !firstColText.includes('Month')) {
                    months.push({
                        month: firstColText,
                        attended: parseInt($(tds[1]).text().trim(), 10) || 0,
                        total: parseInt($(tds[2]).text().trim(), 10) || 0,
                        percentage: parseFloat($(tds[3]).text().trim().replace('%', '')) || 0
                    });
                }
            });

            const data = {
                overallPercentage,
                semesterTotal,
                months,
                isOffline: false
            };

            await saveData(STORAGE_KEYS.ATTENDANCE, data);
            return data;

        } catch (error: any) {
            // Try fallback to cache
            const cachedData = await loadData(STORAGE_KEYS.ATTENDANCE);
            if (cachedData) {
                return { ...cachedData, isOffline: true };
            }
            throw error;
        }
    },

    getDateWiseAttendance: async (): Promise<DateWiseResponse> => {
        try {
            let response = await api.get(API_CONFIG.ENDPOINTS.ATTENDANCE);
            let html = response.data;

            if (html.includes('login.php') || html.includes('Enter Roll No') || html.includes('type="password"')) {
                const credentials = await AuthService.getCredentials();
                if (!credentials) throw new Error('Not logged in');
                await AuthService.login(credentials.studentId, credentials.pass);
                response = await api.get(API_CONFIG.ENDPOINTS.ATTENDANCE);
                html = response.data;
            }

            const $ = cheerio.load(html);
            const days: DailyAttendance[] = [];

            // Robust parsing: Scan all tables for date rows
            $('table').each((tIdx: number, table: any) => {
                const rows = $(table).find('tr');
                rows.each((rIdx: number, row: any) => {
                    const tds = $(row).find('td');
                    if (tds.length < 3) return;

                    const col1Text = $(tds[0]).text().trim();
                    // Match date: DD-MM-YYYY or similar
                    const dateMatch = col1Text.match(/(\d{1,2}[-./]\d{1,2}[-./]\d{2,4})/);

                    if (dateMatch) {
                        const dateText = dateMatch[0];

                        let dayText = '';
                        const smallTag = $(tds[0]).find('small');
                        if (smallTag.length > 0) {
                            dayText = smallTag.text().trim();
                        } else {
                            dayText = col1Text.replace(dateText, '').trim();
                        }

                        const periods: string[] = [];
                        // Heuristic for period columns
                        const col1Val = $(tds[1]).text().trim();
                        let startIndex = 1;

                        const commonDays = ['mon', 'tue', 'wed', 'thu', 'fri', 'sat', 'sun'];
                        if (col1Val.length > 2 && commonDays.some(d => col1Val.toLowerCase().includes(d))) {
                            startIndex = 2;
                        } else if (tds.length >= 8) {
                            startIndex = 2; // Fallback for wide tables
                        }

                        for (let p = startIndex; p < tds.length && periods.length < 8; p++) {
                            const cellText = $(tds[p]).text().trim().replace('-', '').trim();
                            const cellClass = ($(tds[p]).attr('class') || '').toLowerCase();

                            let status = '-';
                            if (cellClass.includes('present')) status = 'P';
                            else if (cellClass.includes('absent')) status = 'A';
                            else if (cellClass.includes('not-posted') || !cellText || cellText.toLowerCase() === 'null') status = '-';
                            else if (cellText.length > 0 && cellText.length <= 2) status = cellText;

                            periods.push(status);
                        }

                        while (periods.length < 6) periods.push('-');

                        days.push({
                            date: dateText,
                            day: dayText,
                            periods: periods.slice(0, 6)
                        });
                    }
                });
            });

            const data = { days, isOffline: false };
            await saveData(STORAGE_KEYS.DATE_WISE_ATTENDANCE, data);
            return data;

        } catch (error: any) {
            const cachedData = await loadData(STORAGE_KEYS.DATE_WISE_ATTENDANCE);
            if (cachedData) return { ...cachedData, isOffline: true };
            throw error;
        }
    }
};


=======================================================
FILE: services\auth.ts
=======================================================

import * as LocalAuthentication from 'expo-local-authentication';
import * as SecureStore from 'expo-secure-store';
import { API_CONFIG } from '../constants/config';
import api from './api';

// eslint-disable-next-line @typescript-eslint/no-require-imports
const cheerio = require('react-native-cheerio');

const CREDENTIALS_KEY = 'user_credentials';
const PROFILE_KEY = 'user_profile';

export interface StudentProfile {
    name: string;
    rollNo: string;
    department: string;
    year: string;
    profileImage: string;
}

export const AuthService = {
    login: async (studentId: string, pass: string) => {
        try {
            // Step 1: GET request to initialize session
            await api.get(API_CONFIG.ENDPOINTS.LOGIN);

            // Step 2: POST login credentials
            const formData = new URLSearchParams();
            formData.append('roll_no', studentId);
            formData.append('password', pass);

            const loginResponse = await api.post(API_CONFIG.ENDPOINTS.LOGIN, formData.toString(), {
                maxRedirects: 5,
                validateStatus: (status: number) => status >= 200 && status < 400,
            });

            // Extract and save cookie
            const setCookie = loginResponse.headers['set-cookie'];
            if (setCookie) {
                const cookieStr = Array.isArray(setCookie) ? setCookie.join('; ') : setCookie;
                await SecureStore.setItemAsync('auth_cookie', cookieStr);
            }

            const responseText = loginResponse.data || '';
            const isLoginPage = responseText.includes('login-form') ||
                responseText.includes('Enter your Roll Number') ||
                responseText.includes('Invalid Credentials');

            const isSuccessPage = responseText.includes('Dashboard') ||
                responseText.includes('Welcome') ||
                responseText.includes('class="menu-link"') ||
                responseText.includes('logout');

            if (isSuccessPage && !isLoginPage) {
                // Parse profile info from the response
                const $ = cheerio.load(responseText);

                const name = $('#profileName').text().trim() || 'Student';
                const rollNo = studentId;
                const department = $('#profileDepartment').text().trim() || '';

                // Extract year from the profile popup
                let year = '';
                $('p').each((i: number, el: any) => {
                    const text = $(el).text();
                    if (text.includes('Year:')) {
                        const match = text.match(/Year:\s*(\d+)/);
                        if (match) year = match[1];
                    }
                });

                // Extract profile image
                let profileImage = '';
                const popupImg = $('.popup-img').attr('src') || $('img[alt="Profile"]').attr('src');
                if (popupImg) {
                    profileImage = popupImg.startsWith('http')
                        ? popupImg
                        : `${API_CONFIG.BASE_URL}/Student/${popupImg}`;
                }

                const profile: StudentProfile = {
                    name,
                    rollNo,
                    department,
                    year,
                    profileImage
                };



                // Store credentials and profile
                await SecureStore.setItemAsync(CREDENTIALS_KEY, JSON.stringify({ studentId, pass }));
                await SecureStore.setItemAsync(PROFILE_KEY, JSON.stringify(profile));

                return profile;
            } else if (responseText.includes('Invalid Credentials') || responseText.includes('incorrect')) {
                throw new Error('Invalid credentials. Please check your Roll Number and Password.');
            } else {
                throw new Error('Login failed. Please verify your credentials.');
            }

        } catch (error: any) {
            throw error;
        }
    },

    logout: async () => {
        try {
            await SecureStore.deleteItemAsync(CREDENTIALS_KEY);
            await SecureStore.deleteItemAsync(PROFILE_KEY);
            // Clear auth cookie
            await SecureStore.deleteItemAsync('auth_cookie');
        } catch {
            // Even if delete fails, proceed to let the user "logout" locally
        }
    },

    isLoggedIn: async () => {
        const creds = await SecureStore.getItemAsync(CREDENTIALS_KEY);
        return !!creds;
    },

    getCredentials: async () => {
        const creds = await SecureStore.getItemAsync(CREDENTIALS_KEY);
        return creds ? JSON.parse(creds) : null;
    },

    getProfile: async (): Promise<StudentProfile | null> => {
        const profile = await SecureStore.getItemAsync(PROFILE_KEY);
        return profile ? JSON.parse(profile) : null;
    },

    checkBiometrics: async () => {
        const hasHardware = await LocalAuthentication.hasHardwareAsync();
        const isEnrolled = await LocalAuthentication.isEnrolledAsync();
        return hasHardware && isEnrolled;
    },

    loginWithBiometrics: async () => {
        const result = await LocalAuthentication.authenticateAsync({
            promptMessage: 'Authenticate to continue',
            fallbackLabel: 'Use Passcode',
        });

        if (result.success) {
            const credsStr = await SecureStore.getItemAsync(CREDENTIALS_KEY);
            if (credsStr) {
                const { studentId, pass } = JSON.parse(credsStr);
                return AuthService.login(studentId, pass);
            } else {
                throw new Error('No credentials stored. Please login manually first.');
            }
        } else {
            throw new Error('Biometric authentication failed');
        }
    }
};


=======================================================
FILE: services\BackgroundFetchService.ts
=======================================================

import * as BackgroundTask from 'expo-background-task';
import * as TaskManager from 'expo-task-manager';
import { loadData, STORAGE_KEYS } from '../utils/storage';
import { AttendanceService } from './attendance';
import { NotificationService } from './notification';

import { ResultsService } from './results';

const TASK_NAME = 'BACKGROUND_ATTENDANCE_CHECK';

export const checkAttendanceInBackground = async () => {
    try {
        // --- 1. ATTENDANCE CHECK ---
        const oldAttendance = await loadData(STORAGE_KEYS.ATTENDANCE);
        const newAttendance = await AttendanceService.getAttendance();

        if (newAttendance && oldAttendance) {
            const oldTotal = oldAttendance.semesterTotal?.attended || 0;
            const newTotal = newAttendance.semesterTotal?.attended || 0;

            const oldClasses = oldAttendance.semesterTotal?.total || 0;
            const newClasses = newAttendance.semesterTotal?.total || 0;

            // --- ENHANCED: Period-level change detection ---
            // Compare today's periods with cached data
            const today = new Date().toLocaleDateString('en-GB', { day: '2-digit', month: 'short', year: 'numeric' });

            // Load date-wise attendance separately (different cache)
            const oldDateWise = await loadData(STORAGE_KEYS.DATE_WISE_ATTENDANCE);
            const newDateWise = await AttendanceService.getDateWiseAttendance();

            const oldDaily = oldDateWise?.days || [];
            const newDaily = newDateWise?.days || [];

            const oldToday = oldDaily.find((d: any) => d.date === today);
            const newToday = newDaily.find((d: any) => d.date === today);

            if (newToday && oldToday) {
                const changes: string[] = [];

                newToday.periods.forEach((status: string, idx: number) => {
                    const oldStatus = oldToday.periods[idx] || '-';
                    if (oldStatus === '-' && status !== '-') {
                        const emoji = status === 'P' ? '‚úÖ' : '‚ùå';
                        changes.push(`Period ${idx + 1}: ${status === 'P' ? 'Present' : 'Absent'} ${emoji}`);
                    }
                });

                if (changes.length > 0) {
                    await NotificationService.sendLocalNotification(
                        `Attendance Updated! üìö`,
                        changes.join(', ')
                    );
                    return BackgroundTask.BackgroundTaskResult.Success;
                }
            }
            // --- END ENHANCED ---

            if (newTotal > oldTotal) {
                // Attendance increased!
                const diff = newTotal - oldTotal;
                await NotificationService.sendLocalNotification(
                    'Attendance Up! üöÄ',
                    `You attended ${diff} class${diff > 1 ? 'es' : ''}. New Total: ${newAttendance.overallPercentage}% üéâ`
                );
            } else if (newClasses > oldClasses && newTotal === oldTotal) {
                // Classes happened but didn't attend?
                const diff = newClasses - oldClasses;
                await NotificationService.sendLocalNotification(
                    'Missed a Class? üëÄ',
                    `${diff} class${diff > 1 ? 'es' : ''} marked while you were away. Attendance: ${newAttendance.overallPercentage}%`
                );
            } else {
            }
        } else {
            // First run or no old attendance data, saving baseline.
        }

        // Update Daily Summary 6PM Notification with latest %
        if (newAttendance) {
            await NotificationService.scheduleDailySummary(newAttendance.overallPercentage);
        }

        // --- 2. RESULTS CHECK ---
        // Only run if we have cached results to compare against
        const oldResults = await loadData(STORAGE_KEYS.EXAM_RESULTS);
        if (oldResults) {
            const newResults = await ResultsService.getResults();

            if (newResults && newResults.semesters.length > oldResults.semesters.length) {
                // Find which semesters are new
                const newSemesters = newResults.semesters.filter((ns: any) =>
                    !oldResults.semesters.some((os: any) => os.semester === ns.semester)
                );

                let message = '';
                if (newSemesters.length === 1) {
                    message = `Results for ${newSemesters[0].semester} are out! Check now.`;
                } else if (newSemesters.length > 1) {
                    // If too many (like initial checks), just summary
                    message = `Results for ${newSemesters[0].semester} and ${newSemesters.length - 1} others are out!`;
                } else {
                    message = `New Semester results are out! Check now.`;
                }

                await NotificationService.sendLocalNotification(
                    'SCARY HOURS: New Results Declared! üíÄ',
                    message
                );
                return BackgroundTask.BackgroundTaskResult.Success;
            } else {
            }
        } else {
            // First run or no old results data, saving baseline.
        }

        // --- 3. FEE RECEIPTS CHECK ---
        const oldFees = await loadData(STORAGE_KEYS.FEE_RECEIPTS);
        if (oldFees && oldFees.length > 0) {
            const { FeeService } = await import('./FeeService');

            // Get current academic year
            const years = await FeeService.getAcademicYears();
            const currentYear = years[0] || '2025-26';
            const newFees = await FeeService.getReceipts(currentYear);

            if (newFees && newFees.length > oldFees.length) {
                const diff = newFees.length - oldFees.length;
                const latestReceipt = newFees[0]; // Most recent

                await NotificationService.sendLocalNotification(
                    'New Fee Receipt! üí∞',
                    `${diff} new payment${diff > 1 ? 's' : ''} recorded. Latest: ‚Çπ${latestReceipt?.amount || 'N/A'}`
                );
                return BackgroundTask.BackgroundTaskResult.Success;
            } else {
            }
        } else {
            // First run or no old fee data, saving baseline.
        }

        return BackgroundTask.BackgroundTaskResult.Success;

    } catch {
        return BackgroundTask.BackgroundTaskResult.Failed;
    }
};

TaskManager.defineTask(TASK_NAME, checkAttendanceInBackground);

export const registerBackgroundFetchAsync = async () => {
    try {
        return await BackgroundTask.registerTaskAsync(TASK_NAME, {
            minimumInterval: 15, // 15 minutes (in minutes)
        });
    } catch {
        // Registration may fail in Expo Go
    }
};

export const unregisterBackgroundFetchAsync = async () => {
    return BackgroundTask.unregisterTaskAsync(TASK_NAME);
};


=======================================================
FILE: services\ConfigService.ts
=======================================================

import AsyncStorage from '@react-native-async-storage/async-storage';
import axios from 'axios';
import { API_CONFIG } from '../constants/config';

const CONFIG_CACHE_KEY = 'remote_config_cache';
// Remote config URL - Update with your GitHub repository URL if needed
const REMOTE_CONFIG_URL = 'https://raw.githubusercontent.com/kovilapu-bharat/Clgpo-Config/main/config.json';

export interface RemoteConfig {
    BASE_URL: string;
    ENDPOINTS: {
        LOGIN: string;
        ATTENDANCE: string;
        RESULTS: string;
    };
    TIMEOUT: number;
}

export const ConfigService = {
    // Start with default local config
    currentConfig: { ...API_CONFIG },

    initialize: async () => {
        try {
            // 1. Load from Cache first (fast)
            const cached = await AsyncStorage.getItem(CONFIG_CACHE_KEY);
            if (cached) {
                const parsed = JSON.parse(cached);
                ConfigService.currentConfig = { ...ConfigService.currentConfig, ...parsed };
            }

            // 2. Fetch fresh config in background
            ConfigService.fetchRemoteConfig();
        } catch {
            // Init failed, use defaults
        }
    },

    fetchRemoteConfig: async () => {
        try {
            // fast timeout specifically for config
            const response = await axios.get(REMOTE_CONFIG_URL, { timeout: 5000 });

            if (response.data && response.data.BASE_URL) {
                const newConfig = response.data;
                ConfigService.currentConfig = { ...ConfigService.currentConfig, ...newConfig };

                // Update Cache
                await AsyncStorage.setItem(CONFIG_CACHE_KEY, JSON.stringify(newConfig));
            }
        } catch {
            // Remote fetch failed, using cache/default
        }
    },

    get: () => ConfigService.currentConfig,
};


=======================================================
FILE: services\FeeService.ts
=======================================================

import { API_CONFIG } from '../constants/config';
import api from './api';
import { AuthService } from './auth';
// eslint-disable-next-line @typescript-eslint/no-require-imports
const cheerio = require('react-native-cheerio');

export interface FeeReceipt {
    id: string;
    receiptNo: string;
    date: string;
    amount: string;
    academicYear: string;
    description: string;
    downloadLink?: string;
}

export const FeeService = {
    getAcademicYears: async (): Promise<string[]> => {
        try {
            let response = await api.get(API_CONFIG.ENDPOINTS.FEE_RECEIPT);
            let html = response.data;

            if (html.includes('login.php') || html.includes('Enter Roll No') || html.includes('Student Login Page')) {
                const credentials = await AuthService.getCredentials();
                if (credentials) {
                    await AuthService.login(credentials.studentId, credentials.pass);
                    response = await api.get(API_CONFIG.ENDPOINTS.FEE_RECEIPT);
                    html = response.data;
                }
            }

            const $ = cheerio.load(html);

            const years: string[] = [];
            $('#academic_year option').each((i: number, el: any) => {
                const val = $(el).attr('value');
                if (val && val.trim() !== '') {
                    years.push(val.trim());
                }
            });

            return years;
        } catch {
            // Return defaults if fetch fails
            return ['2025-26', '2024-25'];
        }
    },

    getReceipts: async (year: string): Promise<FeeReceipt[]> => {
        try {

            const params = new URLSearchParams();
            params.append('academic_year', year);

            let response = await api.post(API_CONFIG.ENDPOINTS.FEE_RECEIPT, params, {
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded'
                }
            });

            let html = response.data;

            if (html.includes('login.php') || html.includes('Enter Roll No') || html.includes('Student Login Page')) {
                const credentials = await AuthService.getCredentials();
                if (credentials) {
                    await AuthService.login(credentials.studentId, credentials.pass);
                    response = await api.post(API_CONFIG.ENDPOINTS.FEE_RECEIPT, params, {
                        headers: {
                            'Content-Type': 'application/x-www-form-urlencoded'
                        }
                    });
                    html = response.data;
                }
            }

            const $post = cheerio.load(html);
            const receipts: FeeReceipt[] = [];

            // 3. Parse specific .receipt-item cards
            const receiptItems = $post('.receipt-item');


            receiptItems.each((i: number, el: any) => {
                try {
                    const $el = $post(el);
                    // ... (keep existing logic)
                    const receiptNo = $el.find("strong:contains('Receipt No.:')").next('span').text().trim();
                    const date = $el.find("strong:contains('Date of Payment:')").next('span').text().trim();
                    let amount = $el.find("td:contains('TOTAL')").next('td').text().trim();
                    if (!amount) {
                        amount = $el.find("th:contains('AMOUNT')").parents('table').find('tr:last td:last').text().trim();
                    }
                    const academicYearText = $el.find("td:contains('Academic Year:')").text().trim();
                    const academicYear = academicYearText.replace('Academic Year:', '').trim();
                    const particular = $el.find("table tbody tr").eq(1).find('td').eq(1).text().trim();
                    const description = particular || 'Fee Payment';

                    if (receiptNo) {
                        receipts.push({
                            id: receiptNo,
                            receiptNo: receiptNo,
                            date: date || 'Unknown Date',
                            amount: amount || 'N/A',
                            academicYear: academicYear || year,
                            description: description,
                            downloadLink: undefined
                        });
                    }
                } catch {
                    // Skip malformed receipt items
                }
            });

            if (receipts.length === 0) {
                // No receipts found for selected year
            }

            return receipts;

        } catch (error) {
            throw error;
        }
    }
};


=======================================================
FILE: services\notification.ts
=======================================================

import Constants from 'expo-constants';
import * as Notifications from 'expo-notifications';
import { Platform } from 'react-native';
import { API_CONFIG } from '../constants/config';
import { loadData, saveData, STORAGE_KEYS } from '../utils/storage';
import api from './api';
import { AuthService } from './auth';

// Configure how notifications behave when the app is foregrounded
try {
    Notifications.setNotificationHandler({
        handleNotification: async () => ({
            shouldShowAlert: true,
            shouldPlaySound: true,
            shouldSetBadge: false,
            shouldShowBanner: true,
            shouldShowList: true,
        }),
    });
} catch {
    // Notification handler setup may fail in Expo Go
}

// eslint-disable-next-line @typescript-eslint/no-require-imports
const cheerio = require('react-native-cheerio');

export interface AppNotification {
    id: string; // Use a hash or index as ID
    title: string;
    description: string;
    time: string;
    icon: string;
    isOffline?: boolean;
}

export const NotificationService = {
    getNotifications: async (): Promise<AppNotification[]> => {
        try {
            let response = await api.get(API_CONFIG.ENDPOINTS.ATTENDANCE);
            let html = response.data;

            // Session check
            if (html.includes('login.php')) {
                const credentials = await AuthService.getCredentials();
                if (credentials) {
                    await AuthService.login(credentials.studentId, credentials.pass);
                    response = await api.get(API_CONFIG.ENDPOINTS.ATTENDANCE);
                    html = response.data;
                }
            }

            const $ = cheerio.load(html);
            const notifications: AppNotification[] = [];

            $('.notification-item').each((i: number, el: any) => {
                const title = $(el).find('.notification-message').text().trim();
                const description = $(el).find('.notification-text').text().trim();
                const time = $(el).find('.notification-time').text().trim();
                const icon = $(el).find('.notification-icon').text().trim() || 'üì¢';

                if (title) {
                    notifications.push({
                        id: `notif-${i}`,
                        title,
                        description,
                        time,
                        icon,
                        isOffline: false
                    });
                }
            });



            // Cache
            await saveData(STORAGE_KEYS.NOTIFICATIONS, notifications);

            return notifications;

        } catch {
            const cached = await loadData(STORAGE_KEYS.NOTIFICATIONS);
            if (cached) {
                return cached.map((n: AppNotification) => ({ ...n, isOffline: true }));
            }
            return [];
        }
    },

    registerForPushNotificationsAsync: async () => {
        let token;

        if (Platform.OS === 'android') {
            await Notifications.setNotificationChannelAsync('default', {
                name: 'default',
                importance: Notifications.AndroidImportance.MAX,
                vibrationPattern: [0, 250, 250, 250],
                lightColor: '#FF231F7C',
            });
        }

        const { status: existingStatus } = await Notifications.getPermissionsAsync();
        let finalStatus = existingStatus;

        if (existingStatus !== 'granted') {
            const { status } = await Notifications.requestPermissionsAsync();
            finalStatus = status;
        }

        if (finalStatus !== 'granted') {
            return;
        }

        // Learn more about projectId:
        // https://docs.expo.dev/push-notifications/push-notifications-setup/#configure-projectid
        try {
            // Check if we are running in Expo Go or Build
            const projectId = Constants?.expoConfig?.extra?.eas?.projectId ?? Constants?.easConfig?.projectId;

            if (!projectId) {
                // For development/Expo Go, we can start without it, but real push needs it.
            }

            token = (await Notifications.getExpoPushTokenAsync({
                projectId: projectId,
            })).data;

            return token;

        } catch {
            // Registration may fail in Expo Go
        }
    },

    sendLocalNotification: async (title: string, body: string) => {
        try {
            await Notifications.scheduleNotificationAsync({
                content: {
                    title: title,
                    body: body,
                    sound: 'default',
                },
                trigger: null, // Send immediately
            });
        } catch {
            // Notification scheduling may fail in Expo Go
        }
    },

    getDailyMessage: (percentage: number) => {
        if (percentage >= 90) {
            return {
                title: 'Attendance Star! üåü',
                body: `You're crushing it with ${percentage}% attendance! Keep up the great work! üéì`
            };
        } else if (percentage >= 75) {
            return {
                title: 'Looking Good! ‚úÖ',
                body: `You're safe at ${percentage}%. Stay consistent to keep that green flag flying! üö©`
            };
        } else if (percentage >= 65) {
            return {
                title: 'Caution: Attendance Low ‚ö†Ô∏è',
                body: `You're at ${percentage}%. Try to attend more classes to reach the safe zone! üõ°Ô∏è`
            };
        } else {
            return {
                title: 'Attendance Alert! üö®',
                body: `Critical: You're at ${percentage}%. You need to attend classes immediately to avoid detention! üìâ`
            };
        }
    },

    scheduleDailySummary: async (percentage: number) => {
        try {
            // Cancel existing daily summary to update with new percentage
            const scheduled = await Notifications.getAllScheduledNotificationsAsync();

            // Strategy: Cancel all pending notifications that match our "Daily Summary" title or category
            for (const notif of scheduled) {
                // Check if it matches any of our possible titles or the type
                if (notif.content.data?.type === 'daily_summary' ||
                    notif.content.title === 'Daily Attendance Summary üìä' ||
                    notif.content.title?.includes('Attendance')) {
                    await Notifications.cancelScheduledNotificationAsync(notif.identifier);
                }
            }

            const now = new Date();
            let scheduledTime = new Date();
            scheduledTime.setHours(18, 0, 0, 0); // 6:00 PM

            // If it's already past 6 PM, schedule for tomorrow
            if (now > scheduledTime) {
                scheduledTime.setDate(scheduledTime.getDate() + 1);
            }

            const message = NotificationService.getDailyMessage(percentage);

            await Notifications.scheduleNotificationAsync({
                content: {
                    title: message.title,
                    body: message.body,
                    sound: 'default',
                    data: { type: 'daily_summary' }
                },
                trigger: {
                    type: Notifications.SchedulableTriggerInputTypes.DATE,
                    date: scheduledTime,
                }
            });



        } catch {
            // Scheduling may fail in Expo Go
        }
    }
};


=======================================================
FILE: services\results.ts
=======================================================

import { API_CONFIG } from '../constants/config';
import { loadData, saveData, STORAGE_KEYS } from '../utils/storage';
import api from './api';
import { AuthService } from './auth';

// eslint-disable-next-line @typescript-eslint/no-require-imports
const cheerio = require('react-native-cheerio');

export interface SubjectResult {
    subjectCode: string;
    subjectName: string;
    internal: string;
    external: string;
    total: string;
    result: string; // P or F
    grade: string;  // Letter Grade (O, A+, B, etc.)
    credits: string;
}

export interface SemesterResult {
    semester: string; // e.g. "1-2"
    sgpa: string;
    subjects: SubjectResult[];
    totalCredits?: string;
}

export interface ResultsData {
    cgpa: string;
    semesters: SemesterResult[];
    isOffline: boolean;
}

export const ResultsService = {
    getResults: async (): Promise<ResultsData> => {
        try {
            let response = await api.get(API_CONFIG.ENDPOINTS.RESULTS);
            let html = response.data;

            if (html.includes('login.php') || html.includes('Enter Roll No')) {
                const credentials = await AuthService.getCredentials();
                if (!credentials) throw new Error('Not logged in');
                await AuthService.login(credentials.studentId, credentials.pass);
                response = await api.get(API_CONFIG.ENDPOINTS.RESULTS);
                html = response.data;
            }

            return await ResultsService.parseResults(html);

        } catch (error: any) {
            throw error;
        }
    },

    // Parse HTML content to extract results
    parseResults: async (html: string): Promise<ResultsData> => {
        try {
            const $ = cheerio.load(html);
            const semesters: SemesterResult[] = [];
            let cgpa = 'N/A';



            const allRows = $('tr');
            const headerIndices: number[] = [];

            // 1. Identify all "Header" rows
            allRows.each((i: number, row: any) => {
                const txt = $(row).text().toLowerCase();
                if (txt.includes('s.no') && txt.includes('code') && txt.includes('subject')) {
                    headerIndices.push(i);
                }
            });



            // 2. Process chunks
            for (let k = 0; k < headerIndices.length; k++) {
                const startIdx = headerIndices[k];
                const endIdx = (k < headerIndices.length - 1) ? headerIndices[k + 1] : allRows.length;

                let semesterName = 'Unknown Semester';
                const subjects: SubjectResult[] = [];
                let sgpa = 'N/A';

                for (let i = startIdx + 1; i < endIdx; i++) {
                    const currentRow = $(allRows[i]);
                    const rowText = currentRow.text().trim();
                    const cleanText = rowText.replace(/\s+/g, ' ');

                    // 2a. Detect Semester Name
                    if ((cleanText.toUpperCase().includes('SEM') || cleanText.toUpperCase().includes('YEAR'))) {
                        if (!cleanText.toLowerCase().includes('subject') && !/^\d+\s/.test(cleanText)) {
                            semesterName = rowText.trim();
                            semesterName = semesterName.replace(/(January|February|March|April|May|June|July|August|September|October|November|December)\s*\d{4}/gi, '').trim();
                        }
                    }

                    // 2b. Detect SGPA
                    if (cleanText.toUpperCase().includes('SGPA') || cleanText.toUpperCase().includes('CREDITS OBTAINED')) {
                        const match = cleanText.match(/SGPA\s*[:=\s]*([0-9.]+)/i);
                        if (match) sgpa = match[1];
                    }

                    // 2c. Detect Subject Data
                    const tds = currentRow.find('td');
                    if (tds.length >= 3) {
                        const firstCol = $(tds[0]).text().trim();
                        if (/^\d+$/.test(firstCol)) {
                            const code = $(tds[1]).text().trim();
                            const name = $(tds[2]).text().trim();

                            // Calculate Grade from Ch columns (3 to N)
                            let gradeFound = '-';
                            const gradeCandidates: string[] = [];

                            // Scan for grades
                            for (let c = 3; c < tds.length; c++) {
                                const cellText = $(tds[c]).text().trim();
                                if (/^[OABCDEFPS]$/i.test(cellText) || /^[A-Z]\+?$/.test(cellText) || cellText.toLowerCase() === 'ab') {
                                    gradeCandidates.push(cellText);
                                }
                            }

                            // Status (P/F) logic - Scan last 3 columns to be safe
                            let status = '-';
                            for (let c = tds.length - 1; c >= Math.max(0, tds.length - 4); c--) {
                                const t = $(tds[c]).text().trim();
                                if (t === 'P' || t === 'F') {
                                    status = t;
                                    break;
                                }
                            }

                            // Intelligent Grade Selection
                            if (gradeCandidates.length > 0) {
                                // Prefer letter grades (O, A, B...) over P/F/Status
                                const last = gradeCandidates[gradeCandidates.length - 1];
                                if (last === status && gradeCandidates.length > 1) {
                                    gradeFound = gradeCandidates[gradeCandidates.length - 2];
                                } else {
                                    gradeFound = last;
                                }

                                const bestLetter = gradeCandidates.slice().reverse().find(g => /^[OABCDE]$/i.test(g) || g.includes('+'));
                                if (bestLetter) {
                                    gradeFound = bestLetter;
                                }
                            }

                            // Fallback for status:
                            if (status === '-') {
                                if (gradeFound === 'F' || gradeFound.toLowerCase() === 'ab') status = 'F';
                                else if (gradeFound !== '-') status = 'P';
                            }

                            // Credits
                            let credits = '-';
                            for (let c = tds.length - 1; c >= 3; c--) {
                                const val = $(tds[c]).text().trim();
                                if (/^[0-9]+(\.[0-9]+)?$/.test(val)) {
                                    const num = parseFloat(val);
                                    if (num > 0 && num <= 10) {
                                        credits = val;
                                        break;
                                    }
                                }
                            }

                            subjects.push({
                                subjectCode: code,
                                subjectName: name,
                                internal: '-',
                                external: '-',
                                total: '-',
                                result: status,
                                grade: gradeFound,
                                credits
                            });
                        }
                    }
                }

                if (subjects.length > 0) {
                    if (semesterName === 'Unknown Semester') {
                        semesterName = `Semester ${semesters.length + 1}`;
                    }
                    semesters.push({
                        semester: semesterName,
                        sgpa,
                        subjects
                    });
                }
            }

            // Global CGPA Check
            const bodyText = $('body').text();
            const cgpaMatches = bodyText.matchAll(/CGPA\s*[:=\s]*([0-9.]+)/gi);
            for (const match of cgpaMatches) {
                const val = parseFloat(match[1]);
                if (val <= 10.0) {
                    cgpa = match[1];
                    break;
                }
            }

            const data = {
                cgpa,
                semesters,
                isOffline: false
            };

            await saveData(STORAGE_KEYS.EXAM_RESULTS, data);
            return data;
        } catch (error: any) {
            throw error;
        }
    },

    getCachedResults: async (): Promise<ResultsData | null> => {
        const cached = await loadData(STORAGE_KEYS.EXAM_RESULTS);
        if (cached) {
            return { ...cached, isOffline: true };
        }
        return null;
    }
};


=======================================================
FILE: tsconfig.json
=======================================================

{
  "extends": "expo/tsconfig.base.json",
  "compilerOptions": {
    "strict": true,
    "module": "esnext",
    "paths": {
      "@/*": [
        "./*"
      ]
    }
  },
  "include": [
    "**/*.ts",
    "**/*.tsx",
    ".expo/types/**/*.ts",
    "expo-env.d.ts"
  ]
}

=======================================================
FILE: utils\storage.ts
=======================================================

import AsyncStorage from '@react-native-async-storage/async-storage';

export const STORAGE_KEYS = {
    ATTENDANCE: 'attendance_data',
    DATE_WISE_ATTENDANCE: 'date_wise_attendance',
    NOTIFICATIONS: 'notifications_cache',
    EXAM_RESULTS: 'exam_results_cache',
    FEE_RECEIPTS: 'fee_receipts_cache',
    LAST_UPDATED: 'last_updated_timestamp',
};

export const saveData = async (key: string, value: any) => {
    try {
        const jsonValue = JSON.stringify(value);
        await AsyncStorage.setItem(key, jsonValue);
        return true;
    } catch {
        return false;
    }
};

export const loadData = async (key: string) => {
    try {
        const jsonValue = await AsyncStorage.getItem(key);
        return jsonValue != null ? JSON.parse(jsonValue) : null;
    } catch {
        return null;
    }
};

export const removeData = async (key: string) => {
    try {
        await AsyncStorage.removeItem(key);
        return true;
    } catch {
        return false;
    }
};

export const clearAllData = async () => {
    try {
        const keys = Object.values(STORAGE_KEYS);
        await AsyncStorage.multiRemove(keys);
        return true;
    } catch {
        return false;
    }
};
